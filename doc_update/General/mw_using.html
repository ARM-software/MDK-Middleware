<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MDK-Middleware: Using Middleware</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">MDK-Middleware
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "MDK-Middleware");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">Software Components for MDK-Professional and MDK-Plus</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('mw_using.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Using Middleware</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_src_2using__mw"></a></p>
<h1><a class="anchor" id="DriverInterface"></a>
Driver Interface</h1>
<p>The interface to the microcontroller peripherals is done using drivers complying with the  <script>link_ext('CMSIS-Driver');</script> standard. These drivers are not limited to MDK-Middleware and may be used by other middleware stacks to utilize the peripherals.</p>
<p>For each enabled peripheral of the microcontroller, a control or access struct is provided that is the interface for the middleware. Drivers for most of the communication peripherals are part of a  <script>link_ext('SW-Pack');</script> that provides device support.</p>
<div class="image">
<object type="image/svg+xml" data="mw_driver.svg" style="pointer-events: none;"></object>
<div class="caption">
Drivers are connected to Middleware using configuration files</div></div>
    <p>The drivers are typically configured using the RTE_device.h configuration file. This file maps I/O pins, interrupts and DMA channels to the available microcontroller resources. Silicon vendors may supply their own configuration tools for peripheral access (for example,  <script>link_ext('STM32Cube');</script> or  <script>link_ext('MCUXpresso');</script>).</p>
<p>The access struct of the various drivers is connected to the middleware using the configuration files of each middleware component.</p>
<h1><a class="anchor" id="mw_using_generic_steps"></a>
Generic Steps</h1>
<p>There are a few generic steps that have to be done to include a middleware component in a project:</p>
<ul>
<li><a class="el" href="#add_sw_comp">Add Software Components</a> : Select the required middleware components for your application in your component manager.</li>
<li><a class="el" href="#conf_mw">Configure Middleware</a> : Adjust the parameters of the middleware components in their related configuration files.</li>
<li><a class="el" href="#conf_drivers">Configure Drivers</a> : Configure the peripheral interfaces that connect the middleware components with physical I/O pins of the device.</li>
<li><a class="el" href="#conf_sys_req">Configure System Resources</a> : Configure RTOS, memory, and stack resources to the requirements of the middleware components.</li>
<li><a class="el" href="#implement_feat">Implement Application Features</a> : Use the API functions of the middleware components to implement the application specific behavior. Code templates help you create the related source code.</li>
</ul>
<h2><a class="anchor" id="add_sw_comp"></a>
Add Software Components</h2>
<p>Using the <b>CMSIS Component Manager</b> window, you need to select the required software components for your application. The <b>Validation Output</b> helps you to identify dependencies to other software components and resolves them automatically, whenever possible.</p>
<div class="image">
<img src="manage_rte_window.png" alt=""/>
<div class="caption">
CMSIS Component Manager Window with Validation Errors</div></div>
    <h2><a class="anchor" id="conf_mw"></a>
Configure Middleware</h2>
<p>Every middleware component has specific configuration files that need to be adapted to the needs of the application. Depending on the component, more than one file might need to be adapted. For example, the <b>File System</b> component needs to be configured for the amount of files that can be opened simultaneously.</p>
<p>In addition, you need to set drive specific settings in the <b>FS_Config_<em>Drive</em>_0.h</b> file, such as page and block sizes for Flash memories, general disk sizes for a RAM drive, and the hardware driver number for connecting the drive to the appropriate hardware peripheral driver.</p>
<div class="image">
<img src="file_system_conf.png" alt=""/>
<div class="caption">
File System Configuration Files FS_Config.h and FS_Config_MC_0.h</div></div>
    <h2><a class="anchor" id="conf_drivers"></a>
Configure Drivers</h2>
<p>Usually, the device driver related to a software component and the associated controller in the microcontroller need to be configured as well. For the middleware, this is usually done in the file <b>RTE_Device.h</b>. Here, you can enable or disable the different hardware controllers and you can specify which device pins are used for the different features of a specific device peripheral.</p>
<div class="image">
<img src="rte_device_h.png" alt=""/>
<div class="caption">
RTE_Device.h File for Driver Configuration</div></div>
    <h2><a class="anchor" id="conf_sys_req"></a>
Configure System Resources</h2>
<p>Every software component has resource requirements for stack, heap, and memory. Configuration files such as <b>startup_<em>device</em>.s</b> and  <script>link_ext('RTX-Conf-CM5');</script> file need to be adapted to these requirements. Every middleware component has a section that explains the resource requirements and gives examples on how to calculate the resulting values for adaption of the configuration files. The section <a class="el" href="#mw_using_stack_and_heap">Stack, Heap and RTOS Configuration</a> gives you more information about the background and the configuration files that need to be touched.</p>
<div class="image">
<img src="rtx_startup.png" alt=""/>
<div class="caption">
RTX_Config.h and startup_device.s for System Resource Configuration</div></div>
    <h2><a class="anchor" id="implement_feat"></a>
Implement Application Features</h2>
<p>Finally, the actual application needs to be implemented. For better understanding of the middleware components, take a look at the existing <a class="el" href="index.html#doc_mw">Example projects</a>. They can be used as a starting point for application development. The <a class="el" href="index.html#doc_mw">Reference</a> sections of each middleware component help to understand the API functions for the related components. Various  <script>link_ext('uv4_ca_sourcefiles');</script> are available to help you implementing your application.</p>
<h1><a class="anchor" id="mw_using_stack_and_heap"></a>
Stack, Heap and RTOS Configuration</h1>
<p>Every software component has resource requirements for stack, heap, and memory. Configuration files such as <a class="el" href="#mw_using_startup">startup_device.s</a> and <a class="el" href="#mw_using_rtx_conf">RTX_Config.h</a> need to be adapted to these requirements. Every middleware component has a section that explains the resource requirements and gives examples on how to calculate the resulting values for adaption of the configuration files.</p>
<h2><a class="anchor" id="mw_using_startup"></a>
Configuring Stack using startup_device.s</h2>
<p>The <b>startup_device.s</b> file is provided by the device vendor in a <a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/index.html">Device Family Pack</a>.</p>
<p>The file will be copied into a project automatically after selecting <b>Device:Startup</b> in the <b>Manage Run-Time Environment</b> window. It is used to configure the size of the stack that is used by exceptions and <b>interrupt service routines (ISR)</b> for the current project. The stack size requirements depend on the maximum nesting of exception and ISR execution and therefore on the priority settings of the various interrupt and exception sources. Also, the heap which is used by memory allocation functions is configured in this file.</p>
<p>Most of the middleware components only require additional <b>stack</b> size, whereas the <b>File System</b> component also requires additional <b>heap</b> size. The memory requirements are stated in the <a class="el" href="index.html#mw_using_mw">Resource Requirements</a> section of each middleware component.</p>
<h2><a class="anchor" id="mw_using_rtx_conf"></a>
Configuring CMSIS-RTOS2 using RTX_Config.h</h2>
<p>The stack size in the <b>startup_device.s</b> file configures only the stack space that is used by exceptions and <b>interrupt service routines (ISR)</b>. When using a CMSIS-RTOS2, additional requirements for the RTOS are configured in the  <script>link_ext('RTX-Conf-CM5');</script> file. In general middleware components use statically allocated resources when RTX v5 is used and in that case no change to RTX configuration file is necessary, for details consult Resource Requirements section of related component.</p>
<p>The additional CMSIS-RTOS related requirements are also stated in the <a class="el" href="index.html#mw_using_mw">Resource Requirements</a> section of each middleware component. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
