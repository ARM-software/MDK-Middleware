<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>File System Component: Utility Routines</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">File System Component
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "File System Component");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">MDK Middleware for Devices with Flash File System</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__utility__routines.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Utility Routines</div></div>
</div><!--header-->
<div class="contents">

<p>Utility Routines provide analytical and utility operations on drives.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga75a680af8cbd2e2fae87d99d9ab50e11" id="r_ga75a680af8cbd2e2fae87d99d9ab50e11"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga75a680af8cbd2e2fae87d99d9ab50e11">fchdrive</a> (const char *drive)</td></tr>
<tr class="memdesc:ga75a680af8cbd2e2fae87d99d9ab50e11"><td class="mdescLeft">&#160;</td><td class="mdescRight">Change current drive.  <br /></td></tr>
<tr class="separator:ga75a680af8cbd2e2fae87d99d9ab50e11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabfb453bab959866464dc7ec0f31ce7b9" id="r_gabfb453bab959866464dc7ec0f31ce7b9"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gabfb453bab959866464dc7ec0f31ce7b9">ffree</a> (const char *drive)</td></tr>
<tr class="memdesc:gabfb453bab959866464dc7ec0f31ce7b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find free space on drive.  <br /></td></tr>
<tr class="separator:gabfb453bab959866464dc7ec0f31ce7b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaea20173a589e298b86791f1cc661731b" id="r_gaea20173a589e298b86791f1cc661731b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaea20173a589e298b86791f1cc661731b">fformat</a> (const char *drive, const char *options)</td></tr>
<tr class="memdesc:gaea20173a589e298b86791f1cc661731b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Format drive.  <br /></td></tr>
<tr class="separator:gaea20173a589e298b86791f1cc661731b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga660963ea80d7075eb5a80d075bd42cae" id="r_ga660963ea80d7075eb5a80d075bd42cae"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga660963ea80d7075eb5a80d075bd42cae">fanalyse</a> (const char *drive)</td></tr>
<tr class="memdesc:ga660963ea80d7075eb5a80d075bd42cae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Analyse volume and check for file fragmentation.  <br /></td></tr>
<tr class="separator:ga660963ea80d7075eb5a80d075bd42cae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga363e98771d028aeda0bab22cb7b1bbfa" id="r_ga363e98771d028aeda0bab22cb7b1bbfa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga363e98771d028aeda0bab22cb7b1bbfa">fcheck</a> (const char *drive)</td></tr>
<tr class="memdesc:ga363e98771d028aeda0bab22cb7b1bbfa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Analyse volume and check for allocation errors.  <br /></td></tr>
<tr class="separator:ga363e98771d028aeda0bab22cb7b1bbfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga17ba4e8c1a25e721d583b29aaaee553f" id="r_ga17ba4e8c1a25e721d583b29aaaee553f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga17ba4e8c1a25e721d583b29aaaee553f">fdefrag</a> (const char *drive)</td></tr>
<tr class="memdesc:ga17ba4e8c1a25e721d583b29aaaee553f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defragment Embedded Flash drive.  <br /></td></tr>
<tr class="separator:ga17ba4e8c1a25e721d583b29aaaee553f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad4670afc494105900a5069331b266606" id="r_gad4670afc494105900a5069331b266606"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gad4670afc494105900a5069331b266606">fmedia</a> (const char *drive)</td></tr>
<tr class="memdesc:gad4670afc494105900a5069331b266606"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if media present on removable drive.  <br /></td></tr>
<tr class="separator:gad4670afc494105900a5069331b266606"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa8923f6394ef735392d95d966dca49cb" id="r_gaa8923f6394ef735392d95d966dca49cb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaa8923f6394ef735392d95d966dca49cb">finfo</a> (const char *drive, <a class="el" href="rl__fs_8h.html#structfsDriveInfo">fsDriveInfo</a> *info)</td></tr>
<tr class="memdesc:gaa8923f6394ef735392d95d966dca49cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read drive information.  <br /></td></tr>
<tr class="separator:gaa8923f6394ef735392d95d966dca49cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga78d23872719a6f8d82269622fd322fc3" id="r_ga78d23872719a6f8d82269622fd322fc3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga78d23872719a6f8d82269622fd322fc3">fvol</a> (const char *drive, char *label, uint32_t *serial)</td></tr>
<tr class="memdesc:ga78d23872719a6f8d82269622fd322fc3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read volume label and serial number.  <br /></td></tr>
<tr class="separator:ga78d23872719a6f8d82269622fd322fc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Description</h2>
<p>Utility Routines provide analytical and utility operations on drives. </p>
<p>You can change current drive, print working directory, analyse, format, and defragment drives. Also, reading drive and volume information data is supported.</p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga660963ea80d7075eb5a80d075bd42cae" name="ga660963ea80d7075eb5a80d075bd42cae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga660963ea80d7075eb5a80d075bd42cae">&#9670;&#160;</a></span>fanalyse()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32_t fanalyse </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>drive</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Analyse volume and check for file fragmentation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drive</td><td>a string specifying the <a class="el" href="operation.html#drive">memory or storage device</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>fragmentation factor or execution status<ul>
<li>value &gt;= 0 or &lt;= 255: fragmentation factor</li>
<li>value &lt; 0: error occurred, -value is execution status as defined with <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a> </li>
</ul>
</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function supports EFS drives only.</dd></dl>
<p>The function <b>fanalyse</b> examines the Embedded File System and checks for file fragmentation.</p>
<p>The argument <em class="arg">drive</em> specifies the <a class="el" href="operation.html#drive">Drives, Memory Devices and Drivers</a> to be analysed. The <a class="el" href="operation.html#cur_sys_drive">Current Drive</a> is used if an empty string is provided. A NULL pointer is not allowed and will be rejected.</p>
<p><b>Code Example</b> </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> free_space (<span class="keywordtype">void</span>) {</div>
<div class="line"> </div>
<div class="line">  printf (<span class="stringliteral">&quot;\nFree space before defrag: %d bytes.&quot;</span>, <a class="code hl_function" href="#gabfb453bab959866464dc7ec0f31ce7b9" title="Find free space on drive.">ffree</a>(<span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="#ga660963ea80d7075eb5a80d075bd42cae" title="Analyse volume and check for file fragmentation.">fanalyse</a>(<span class="stringliteral">&quot;&quot;</span>) &gt; 50) {</div>
<div class="line">    <a class="code hl_function" href="#ga17ba4e8c1a25e721d583b29aaaee553f" title="Defragment Embedded Flash drive.">fdefrag</a> (<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  printf (<span class="stringliteral">&quot;\nFree space after defrag: %d bytes.&quot;</span>, <a class="code hl_function" href="#gabfb453bab959866464dc7ec0f31ce7b9" title="Find free space on drive.">ffree</a>(<span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a id="ga75a680af8cbd2e2fae87d99d9ab50e11" name="ga75a680af8cbd2e2fae87d99d9ab50e11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga75a680af8cbd2e2fae87d99d9ab50e11">&#9670;&#160;</a></span>fchdrive()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a> fchdrive </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>drive</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Change current drive. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drive</td><td>a string specifying the <a class="el" href="operation.html#drive">memory or storage device</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution status <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a></dd></dl>
<p>The function <b>fchdrive</b> changes the <a class="el" href="operation.html#cur_sys_drive">Current Drive</a>.</p>
<p>The argument <em class="arg">drive</em> specifies the <a class="el" href="operation.html#drive">Drives, Memory Devices and Drivers</a> to be selected as the <a class="el" href="operation.html#cur_sys_drive">Current Drive</a>. A NULL pointer is not allowed and will be rejected. </p>

</div>
</div>
<a id="ga363e98771d028aeda0bab22cb7b1bbfa" name="ga363e98771d028aeda0bab22cb7b1bbfa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga363e98771d028aeda0bab22cb7b1bbfa">&#9670;&#160;</a></span>fcheck()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a> fcheck </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>drive</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Analyse volume and check for allocation errors. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drive</td><td>a string specifying the <a class="el" href="operation.html#drive">memory or storage device</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution status <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a><ul>
<li>fsOK = Operation successful, no allocation errors.</li>
<li>fsInvalidDrive = Nonexistent drive letter specified.</li>
<li>fsUnsupported = FAT drive was specified.</li>
<li>fsError = Check failed due to allocation errors. </li>
</ul>
</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function supports EFS drives only.</dd></dl>
<p>The function <b>fcheck</b> analyses the consistency of the Embedded File System and determines if it has been initialized.</p>
<p>The argument <em class="arg">drive</em> specifies the <a class="el" href="operation.html#drive">Drives, Memory Devices and Drivers</a> to be checked. The <a class="el" href="operation.html#cur_sys_drive">Current Drive</a> is used if an empty string is provided. A NULL pointer is not allowed and will be rejected.</p>
<p><b>Code Example</b> </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> tst_files (<span class="keywordtype">void</span>) {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="#ga363e98771d028aeda0bab22cb7b1bbfa" title="Analyse volume and check for allocation errors.">fcheck</a> (<span class="stringliteral">&quot;F:&quot;</span>) != <a class="code hl_enumvalue" href="rl__fs_8h.html#ga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8" title="Operation succeeded.">fsOK</a>) {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Embedded File System inconsistent, formatting...\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="#gaea20173a589e298b86791f1cc661731b" title="Format drive.">fformat</a> (<span class="stringliteral">&quot;F:&quot;</span>) != <a class="code hl_enumvalue" href="rl__fs_8h.html#ga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8" title="Operation succeeded.">fsOK</a>) {</div>
<div class="line">      printf (<span class="stringliteral">&quot;Formatting failed.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      printf (<span class="stringliteral">&quot;Format done.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a id="ga17ba4e8c1a25e721d583b29aaaee553f" name="ga17ba4e8c1a25e721d583b29aaaee553f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga17ba4e8c1a25e721d583b29aaaee553f">&#9670;&#160;</a></span>fdefrag()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a> fdefrag </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>drive</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Defragment Embedded Flash drive. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drive</td><td>a string specifying the <a class="el" href="operation.html#drive">memory or storage device</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution status <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a><ul>
<li>fsOK = Operation successful.</li>
<li>fsInvalidDrive = Nonexistent drive letter specified.</li>
<li>fsAccessDenied = Not all files are closed on specified drive or unsupported drive.</li>
<li>fsNoFreeSpace = Not enough space to complete the defragmentation. </li>
</ul>
</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function supports EFS drives only.</dd></dl>
<p>The function <b>fdefrag</b> de-fragments the Embedded File System. Drive is examined for used blocks which are without valid file allocation records. Such blocks are erased and marked as empty. Fragmented files are consolidated. The result of file consolidation is faster file access and increased overall performance.</p>
<p>The argument <em class="arg">drive</em> specifies the <a class="el" href="operation.html#drive">Drives, Memory Devices and Drivers</a> to be de-fragmented. The <a class="el" href="operation.html#cur_sys_drive">Current Drive</a> is used if an empty string is provided. A NULL pointer is not allowed and will be rejected.</p>
<p><b>Code Example</b> </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> free_space (<span class="keywordtype">void</span>)  {</div>
<div class="line"> </div>
<div class="line">  printf (<span class="stringliteral">&quot;\nFree space before defrag: %d bytes.&quot;</span>, <a class="code hl_function" href="#gabfb453bab959866464dc7ec0f31ce7b9" title="Find free space on drive.">ffree</a>(<span class="stringliteral">&quot;F:&quot;</span>));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="#ga660963ea80d7075eb5a80d075bd42cae" title="Analyse volume and check for file fragmentation.">fanalyse</a>(<span class="stringliteral">&quot;F:&quot;</span>) &gt; 50) {</div>
<div class="line">     <a class="code hl_function" href="#ga17ba4e8c1a25e721d583b29aaaee553f" title="Defragment Embedded Flash drive.">fdefrag</a> (<span class="stringliteral">&quot;F:&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  printf (<span class="stringliteral">&quot;\nFree space after defrag: %d bytes.&quot;</span>, <a class="code hl_function" href="#gabfb453bab959866464dc7ec0f31ce7b9" title="Find free space on drive.">ffree</a>(<span class="stringliteral">&quot;F:&quot;</span>));</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a id="gaea20173a589e298b86791f1cc661731b" name="gaea20173a589e298b86791f1cc661731b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaea20173a589e298b86791f1cc661731b">&#9670;&#160;</a></span>fformat()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a> fformat </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>drive</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>options</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Format drive. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drive</td><td>a string specifying the <a class="el" href="operation.html#drive">memory or storage device</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">options</td><td>string specifying formatting options. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution status <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a></dd></dl>
<p>The function <b>fformat</b> formats an EFS or FAT storage media for using a file system. The function closes all open files on the specified <em class="arg">drive</em>. Existing file handles become invalid.</p>
<p>The argument <em class="arg">drive</em> specifies the <a class="el" href="operation.html#drive">Drives, Memory Devices and Drivers</a>. The <a class="el" href="operation.html#cur_sys_drive">Current Drive</a> is used if an empty string is provided. A NULL pointer is not allowed and will be rejected.</p>
<p>The argument <em class="arg">options</em> can be pointer to a string or NULL when formatting options are not used.</p>
<p><b>FAT drive formatting options:</b></p>
<table class="cmtable">
<tr>
<th>Option </th><th>Description  </th></tr>
<tr>
<td>/L label </td><td>Specifies <a class="el" href="operation.html#fat_volume_label">volume label</a>. If /L option is not specified or if label is not given, then volume label will not be written. Terminating character for label can be slash (/) or NUL character. Trailing spaces will be ignored.   </td></tr>
<tr>
<td>/FAT32 </td><td>Formats the media for using the FAT32 file system. FAT32 can be used on media devices with size &gt;= 256MB.   </td></tr>
<tr>
<td>/W </td><td>Clears all data. Erases all available data sectors.   </td></tr>
<tr>
<td>/LL </td><td>Clears all data. Performs low-level formatting first (NAND drive only).   </td></tr>
<tr>
<td>/LLEB </td><td>Clears all data. Performs low-level formatting and erases bad blocks first (NAND drive only). /LLEB has higher priority than /LL in case if both options are specified.   </td></tr>
<tr>
<td>/&lt;other&gt; </td><td>Unknown options are ignored.   </td></tr>
</table>
<p>When formatting option /FAT32 is not used, the media device will be formatted using default, predefined settings. The file system type depends then on media device size and will be chosen as follows:</p><ul>
<li>FAT12 for devices with &lt; 128MB</li>
<li>FAT16 for devices with &gt;= 128MB and &lt;= 2GB</li>
<li>FAT32 for devices with &gt; 2GB</li>
</ul>
<p><b>EFS drive formatting options:</b></p>
<p>There are no special formatting options available for the Embedded File System. Argument <em class="arg">options</em> is ignored.</p>
<dl class="section note"><dt>Note</dt><dd>Before formatting the drive, <a class="el" href="group__system__routines.html#gade92b7c5b374fb1485f2f9faa7259f27">fmount</a> must be called to initialize the memory media and media management layer.</dd></dl>
<p><b>Code Example</b> </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> format_drive (<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="keywordtype">char</span> *opt;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Set formatting options</span></div>
<div class="line">  opt = <span class="stringliteral">&quot;/L SD Card /FAT32&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="#gaea20173a589e298b86791f1cc661731b" title="Format drive.">fformat</a> (<span class="stringliteral">&quot;M:&quot;</span>, opt) != <a class="code hl_enumvalue" href="rl__fs_8h.html#ga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8" title="Operation succeeded.">fsOK</a>) {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Formatting failed!\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Drive formatted using FAT 32 with label SD Card.\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a id="gabfb453bab959866464dc7ec0f31ce7b9" name="gabfb453bab959866464dc7ec0f31ce7b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabfb453bab959866464dc7ec0f31ce7b9">&#9670;&#160;</a></span>ffree()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int64_t ffree </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>drive</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Find free space on drive. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drive</td><td>a string specifying the <a class="el" href="operation.html#drive">memory or storage device</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>free space or execution status<ul>
<li>value &gt;= 0: free space on drive in bytes.</li>
<li>value &lt; 0: error occurred, -value is execution status as defined with <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a></li>
</ul>
</dd></dl>
<p>The function <b>ffree</b> calculates the free space on a device.</p>
<p>The argument <em class="arg">drive</em> specifies the <a class="el" href="operation.html#drive">Drives, Memory Devices and Drivers</a>. The <a class="el" href="operation.html#cur_sys_drive">Current Drive</a> is used if an empty string is provided. A NULL pointer is not allowed and will be rejected.</p>
<p><b>Code Example</b> </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> free_space (<span class="keywordtype">void</span>)  {</div>
<div class="line"> </div>
<div class="line">  printf (<span class="stringliteral">&quot;Flash Drive free: %lld bytes.\n&quot;</span>, <a class="code hl_function" href="#gabfb453bab959866464dc7ec0f31ce7b9" title="Find free space on drive.">ffree</a>(<span class="stringliteral">&quot;F:&quot;</span>));</div>
<div class="line">  printf (<span class="stringliteral">&quot;Ram Drive free: %lld bytes.\n&quot;</span>, <a class="code hl_function" href="#gabfb453bab959866464dc7ec0f31ce7b9" title="Find free space on drive.">ffree</a>(<span class="stringliteral">&quot;R:&quot;</span>));</div>
<div class="line">  printf (<span class="stringliteral">&quot;SD Card Drive 1 free: %lld bytes.\n&quot;</span>, <a class="code hl_function" href="#gabfb453bab959866464dc7ec0f31ce7b9" title="Find free space on drive.">ffree</a>(<span class="stringliteral">&quot;M0:&quot;</span>));</div>
<div class="line">  printf (<span class="stringliteral">&quot;SD Card Drive 2 free: %lld bytes.\n&quot;</span>, <a class="code hl_function" href="#gabfb453bab959866464dc7ec0f31ce7b9" title="Find free space on drive.">ffree</a>(<span class="stringliteral">&quot;M1:&quot;</span>));</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a id="gaa8923f6394ef735392d95d966dca49cb" name="gaa8923f6394ef735392d95d966dca49cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa8923f6394ef735392d95d966dca49cb">&#9670;&#160;</a></span>finfo()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a> finfo </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>drive</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="rl__fs_8h.html#structfsDriveInfo">fsDriveInfo</a> *</td>          <td class="paramname"><span class="paramname"><em>info</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read drive information. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drive</td><td>a string specifying the <a class="el" href="operation.html#drive">memory or storage device</a>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">info</td><td>drive information structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution status <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a><ul>
<li>fsOK = Operation successful.</li>
<li>fsInvalidParameter = Input parameters invalid.</li>
<li>fsInvalidDrive = Nonexistent drive letter specified.</li>
<li>fsAccessDenied = Specified drive is not mounted.</li>
</ul>
</dd></dl>
<p>The function <b>finfo</b> reads general drive informations from the volume and puts them into the <em class="arg">info</em> structure.</p>
<p>The argument <em class="arg">drive</em> specifies the <a class="el" href="operation.html#drive">Drives, Memory Devices and Drivers</a>. The <a class="el" href="operation.html#cur_sys_drive">Current Drive</a> is used if an empty string is provided. A NULL pointer is not allowed and will be rejected. </p>

</div>
</div>
<a id="gad4670afc494105900a5069331b266606" name="gad4670afc494105900a5069331b266606"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad4670afc494105900a5069331b266606">&#9670;&#160;</a></span>fmedia()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a> fmedia </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>drive</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if media present on removable drive. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drive</td><td>a string specifying the <a class="el" href="operation.html#drive">memory or storage device</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution status <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a><ul>
<li>fsOK = Operation successful, media is present.</li>
<li>fsNoMedia = Media not present.</li>
<li>fsUnsupported = Media presence cannot be determined.</li>
<li>fsAccessDenied = Tried to access non-removable drive. </li>
</ul>
</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function supports FAT drives only.</dd></dl>
<p>The function <b>fmedia</b> uses media device interface driver to detect the presence of a removable drive in the system (such as SD/MMC cards or USB Flash drives). In case of SD/MMC cards, it can be used even when card socket does not provide card detection pin, but only after a successful device initialization (i.e. after a successful call of <a class="el" href="group__system__routines.html#gade92b7c5b374fb1485f2f9faa7259f27">fmount</a> or <a class="el" href="group__ioc__interface__routines.html#ga3036c7dbc536ec052c41056245df407e">fs_ioc_device_ctrl</a> using <b>fsDevCtrlCodeControlMedia</b>). In such case, device presence is determined using internal register states.</p>
<p>The argument <em class="arg">drive</em> specifies the <a class="el" href="operation.html#drive">Drives, Memory Devices and Drivers</a>. The <a class="el" href="operation.html#cur_sys_drive">Current Drive</a> is used if an empty string is provided. A NULL pointer is not allowed and will be rejected. </p>

</div>
</div>
<a id="ga78d23872719a6f8d82269622fd322fc3" name="ga78d23872719a6f8d82269622fd322fc3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga78d23872719a6f8d82269622fd322fc3">&#9670;&#160;</a></span>fvol()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a> fvol </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>drive</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>label</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *</td>          <td class="paramname"><span class="paramname"><em>serial</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read volume label and serial number. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">drive</td><td>a string specifying the <a class="el" href="operation.html#drive">memory or storage device</a>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">label</td><td>buffer for storing label as a null terminated string. When volume has no label an empty string is returned. This parameter can be NULL meaning label will not be read. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">serial</td><td>pointer to variable where serial number will be stored. This parameter can be NULL meaning serial number will not be read. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution status <a class="el" href="group__status__error__codes__fs.html#ga326dc89f0e8665e419766e90c691b8d7">fsStatus</a><ul>
<li>fsOK = Operation successful.</li>
<li>fsInvalidDrive = Nonexistent drive letter specified.</li>
<li>fsAccessDenied = Trying to read label and serial from EFS drive.</li>
<li>fsDriverError = Read/write error. </li>
</ul>
</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function supports FAT drives only.</dd></dl>
<p>The function <b>fvol</b> reads the volume label.</p>
<p>The argument <em class="arg">drive</em> specifies the <a class="el" href="operation.html#drive">Drives, Memory Devices and Drivers</a>. The <a class="el" href="operation.html#cur_sys_drive">Current Drive</a> is used if an empty string is provided. A NULL pointer is not allowed and will be rejected.</p>
<p>The argument <em class="arg">label</em> specifies a buffer where the volume label will be stored as a null terminated string. Its size must be at least 12 bytes to prevent buffer overflow. If volume has no label an empty string is returned.</p>
<p>The argument <em class="arg">serial</em> specifies a pointer to a 32-bit variable where the volume serial number will be stored. The serial number is usually written when the volume is formatted and can be used to distinguish between volumes on removable devices.</p>
<p><b>Code Example</b> </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> tst_fvol (<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="keywordtype">char</span> label[12];</div>
<div class="line">  uint32_t ser_num;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="#ga78d23872719a6f8d82269622fd322fc3" title="Read volume label and serial number.">fvol</a>(<span class="stringliteral">&quot;U0:&quot;</span>, label, &amp;ser_num) == <a class="code hl_enumvalue" href="rl__fs_8h.html#ga326dc89f0e8665e419766e90c691b8d7a4456550a7764bbc4805e75946bd5a4c8" title="Operation succeeded.">fsOK</a>) {</div>
<div class="line">    <span class="keywordflow">if</span> (label_buf[0]) {</div>
<div class="line">      printf (<span class="stringliteral">&quot;Volume in drive U0 is %s\n&quot;</span>, label);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      printf (<span class="stringliteral">&quot;Volume in drive U0 has no label.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    printf (<span class="stringliteral">&quot;Volume serial number is %x\n&quot;</span>, ser_num);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Volume access error!\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
