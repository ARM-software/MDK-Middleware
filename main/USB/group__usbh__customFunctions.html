<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>USB Component: Custom Class</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">USB Component
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "USB Component");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">MDK Middleware for USB Device and Host Communication</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__usbh__customFunctions.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Content</a>  </div>
  <div class="headertitle"><div class="title">Custom Class<div class="ingroups"><a class="el" href="group__usbh.html">USB Host</a> &raquo; <a class="el" href="group__usbh__DevClassFunctions.html">Device Class</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>USB Host functions to support Custom Class USB Devices.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
Content</h2></td></tr>
<tr class="memitem:group__usbh__customFunctions__api"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usbh__customFunctions__api.html">User API</a></td></tr>
<tr class="memdesc:group__usbh__customFunctions__api"><td class="mdescLeft">&#160;</td><td class="mdescRight">User API reference of the Custom Class. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__usbh__customFunctions__conf"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usbh__customFunctions__conf.html">Configuration</a></td></tr>
<tr class="memdesc:group__usbh__customFunctions__conf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configuration of the USB Host Custom Class. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Description</h2>
<p>USB Host functions to support Custom Class USB Devices. </p>
<p>The Custom Class in the USB Host Component is used for attaching USB Devices with a specific USB Class to your system. This can either be one of the <a href="https://www.usb.org/defined-class-codes" class="el" target="_blank">standard</a> classes that are not directly supported by the USB Middleware or a <a href="https://www.usb.org/defined-class-codes" class="el" target="_blank">vendor specific</a> class. Using these functions, you can add support for any USB Device class to the system.</p>
<p>Refer to:</p><ul>
<li><a class="el" href="USB_Classes.html#CustomClass">Custom Class</a> for an overview of the Custom Class.</li>
</ul>
<p><b>Software Structure</b> <br  />
 The application starts the USB Host by calling <a class="el" href="group__usbh__coreFunctions__api.html#ga4420c0add78ae79e8e7ce035227ef4c5">USBH_Initialize</a>. The USB Host Core will wait until an USB Custom Class device is attached to the system. As soon as this happens the Core will configure and initialize the device and it will be ready to be used by the application.</p>
<p>The transmit functions <a class="el" href="group__usbh__customFunctions__api.html#gadba45e9c38b4fe791c3e07c602655b7c">USBH_PipeSend</a> and <a class="el" href="group__usbh__customFunctions__api.html#gac1ce81d11d0559993e4e21e09b868afb">USBH_PipeReceive</a> will be called by the user thread directly to communicate with the Custom Class device.</p>
<p>As soon as the Custom Class Device is detached from the system, the callback functions <a class="el" href="group__usbh__customFunctions__api.html#ga29c81dab6422324f2d94282bdcf8b43d">USBH_CustomClass_Unconfigure</a> and <a class="el" href="group__usbh__customFunctions__api.html#ga015780dcf593743470bb79f7ec8f18bd">USBH_CustomClass_Uninitialize</a> signal the removal to the user application.</p>
<div class="mscgraph">
<img src="msc_inline_mscgraph_9.png" alt="msc_inline_mscgraph_9" border="0" usemap="#msc_inline_mscgraph_9.map"/>
<map name="msc_inline_mscgraph_9.map" id="msc_inline_mscgraph_9.map"><area href="group__usbh__coreFunctions__api.html#ga4420c0add78ae79e8e7ce035227ef4c5" shape="rect" coords="56,78,145,91" alt=""/>
<area href="group__usbh__customFunctions__api.html#ga385a67ca676ca94efcf078b637fdf49c" shape="rect" coords="223,180,378,193" alt=""/>
<area href="group__usbh__customFunctions__api.html#gaa31a612e0656e87ea050ad905b8ebe06" shape="rect" coords="220,212,381,225" alt=""/>
<area href="group__usbh__customFunctions__api.html#gadba45e9c38b4fe791c3e07c602655b7c" shape="rect" coords="62,282,139,295" alt=""/>
<area href="group__usbh__customFunctions__api.html#gac1ce81d11d0559993e4e21e09b868afb" shape="rect" coords="53,333,148,346" alt=""/>
<area href="group__usbh__customFunctions__api.html#ga015780dcf593743470bb79f7ec8f18bd" shape="rect" coords="214,403,387,416" alt=""/>
<area href="group__usbh__customFunctions__api.html#ga29c81dab6422324f2d94282bdcf8b43d" shape="rect" coords="217,435,384,448" alt=""/>
<area href="group__usbh__coreFunctions__api.html#gaf98f4e13ff57a8bf1c49cd46a8034d3f" shape="rect" coords="50,467,151,480" alt=""/>
</map>
</div>
<h2><a class="anchor" id="autotoc_md107"></a>
Implementation</h2>
<p>To <a class="el" href="USB_Host.html#Create_a_USB_Host_Application">create an USB Host</a> with support for the Custom class:</p><ul>
<li>Select <b>USB:Host:Custom Class</b> in the <a class="el" href="USB_Device.html#RTE_Software_Component_Selection">RTE Component Selection</a>.</li>
<li>Configure the number of custom class devices allowed in the system in the file <a class="el" href="group__usbh__customFunctions__conf.html">USBH_Config_CustomClass.h</a>.</li>
<li>Add the related <b>user code template</b> file (<a class="el" href="group__usbh__customFunctions.html#USBH_Cust_UCT">USBH_User_CustomClass.c</a>) to your project.</li>
<li>Implement the application specific behavior in <a class="el" href="group__usbh__customFunctions.html#USBH_Cust_UCT">USBH_User_CustomClass.c</a>.</li>
</ul>
<p><b>User</b> <b>Code</b> <b>Templates</b> </p>
<p>There are two user code templates available that show how to create support for a Custom Class device:</p><ol type="1">
<li><a class="el" href="group__usbh__customFunctions.html#USBH_Cust_UCT">USBH_User_CustomClass.c</a> shows in general how to use the Custom Class functions.</li>
<li><a class="el" href="group__usbh__customFunctions.html#USBH_PL2303_UCT">USBH_PL2303.c</a> is an actual implementation of the Custom Class functions to add support for Prolific's <a href="https://www.prolific.com.tw/US/index.aspx" class="el" target="_blank">PL2303</a> UART to serial RS232 adapter.</li>
</ol>
<p><a class="anchor" id="USBH_Cust_UCT"></a><b>User Code Template USBH_User_CustomClass.c</b> <br  />
 The following source code can be used to implement support for a Custom USB Device Class in the user application.</p>
<div class="fragment"><div class="line"><span class="comment">/*------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> * MDK Middleware - Component ::USB:Host:Custom Class</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2004-2020 Arm Limited (or its affiliates). All rights reserved.</span></div>
<div class="line"><span class="comment"> *------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> * Name:    USBH_User_CustomClass.c</span></div>
<div class="line"><span class="comment"> * Purpose: USB Host (USBH) - Custom Class User template</span></div>
<div class="line"><span class="comment"> * Rev.:    V6.3.2</span></div>
<div class="line"><span class="comment"> *----------------------------------------------------------------------------*/</span></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * USBH_User_CustomClass.c is a code template for the Custom Class driver</span></div>
<div class="line"><span class="comment"> * implementation on the USB Host stack.</span></div>
<div class="line"><span class="comment"> * This implementation supports only one instance.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The template implements 4 callback functions called by the USB Host core</span></div>
<div class="line"><span class="comment"> * when device is connected or disconnected, these are:</span></div>
<div class="line"><span class="comment"> *   USBH_CustomClass_Configure</span></div>
<div class="line"><span class="comment"> *   USBH_CustomClass_Unconfigure</span></div>
<div class="line"><span class="comment"> *   USBH_CustomClass_Initialize</span></div>
<div class="line"><span class="comment"> *   USBH_CustomClass_Uninitialize</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * First to enable USB Host Controller (if not already enabled) call:</span></div>
<div class="line"><span class="comment"> *   USBH_Initialize (ctrl_num);</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * \addtogroup usbh_custom_classFunctions</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">//! [code_USBH_User_CustomClass]</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rl__usb_8h.html">rl_usb.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Interface class, subclass and protocol of the device that is supported</span></div>
<div class="line"><span class="preprocessor">#define CUSTOM_CLASS_IF_CLASS           USB_DEVICE_CLASS_VENDOR_SPECIFIC</span></div>
<div class="line"><span class="preprocessor">#define CUSTOM_CLASS_IF_SUBCLASS        0</span></div>
<div class="line"><span class="preprocessor">#define CUSTOM_CLASS_IF_PROTOCOL        0</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">extern</span></div>
<div class="line">uint8_t    USBH_CC_Device;</div>
<div class="line">uint8_t    USBH_CC_Device = 0U;         <span class="comment">// Device used for USB transfers</span></div>
<div class="line"><span class="keyword">extern</span> </div>
<div class="line"><a class="code hl_typedef" href="group__usbh__data__types.html#ga98c1a0cd2cf7e047d714fd23dfba5e53">USBH_PIPE_HANDLE</a> USBH_CC_PipeHandle[8];</div>
<div class="line"><a class="code hl_typedef" href="group__usbh__data__types.html#ga98c1a0cd2cf7e047d714fd23dfba5e53">USBH_PIPE_HANDLE</a> USBH_CC_PipeHandle[8]; <span class="comment">// Pipe Handles</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/************************** Class Driver Functions ****************************/</span></div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">/// \brief Analyze device configuration and configure resources</span></div>
<div class="line"><span class="comment">/// \param[in]     device               index of USB Device.</span></div>
<div class="line"><span class="comment">/// \param[in]     ptr_dev_desc         pointer to device descriptor.</span></div>
<div class="line"><span class="comment">/// \param[in]     ptr_cfg_desc         pointer to configuration descriptor.</span></div>
<div class="line"><span class="comment">/// \return                             index of configured custom class device instance or configuration failed :</span></div>
<div class="line"><span class="comment">///                                       - value &lt;= 127 : index of configured custom class device instance</span></div>
<div class="line"><span class="comment">///                                       - value 255 :    configuration failed</span></div>
<div class="line"><span class="comment"></span>uint8_t <a class="code hl_function" href="group__usbh__customFunctions__api.html#ga385a67ca676ca94efcf078b637fdf49c" title="Callback function called when custom class device is connected and needs to configure resources used ...">USBH_CustomClass_Configure</a> (uint8_t device, <span class="keyword">const</span> <a class="code hl_struct" href="group__usbh__data__types.html#structUSB__DEVICE__DESCRIPTOR" title="USB Device Descriptor structure.">USB_DEVICE_DESCRIPTOR</a> *ptr_dev_desc, <span class="keyword">const</span> <a class="code hl_struct" href="group__usbh__data__types.html#structUSB__CONFIGURATION__DESCRIPTOR" title="USB Configuration Descriptor structure.">USB_CONFIGURATION_DESCRIPTOR</a> *ptr_cfg_desc) {</div>
<div class="line">  USB_INTERFACE_DESCRIPTOR *ptr_if_desc;</div>
<div class="line">  USB_ENDPOINT_DESCRIPTOR  *ptr_ep_desc;</div>
<div class="line">  <a class="code hl_typedef" href="group__usbh__data__types.html#ga98c1a0cd2cf7e047d714fd23dfba5e53">USBH_PIPE_HANDLE</a>          pipe_hndl;</div>
<div class="line">  uint8_t                   num, i;</div>
<div class="line"> </div>
<div class="line">  (void)ptr_dev_desc;</div>
<div class="line"> </div>
<div class="line">  USBH_CC_Device = device;              <span class="comment">// Store device</span></div>
<div class="line">  <span class="keywordflow">for</span> (i = 0U; i &lt; 8U; i++) {           <span class="comment">// Clear all pipe handles</span></div>
<div class="line">    USBH_CC_PipeHandle[i] = 0U;</div>
<div class="line">  }</div>
<div class="line">  ptr_if_desc = (USB_INTERFACE_DESCRIPTOR *)((uint32_t)ptr_cfg_desc + ptr_cfg_desc-&gt;<a class="code hl_variable" href="group__usbh__data__types.html#a1deca1f1d6e5815b290e6e1015bce5b8" title="Size of this descriptor in bytes.">bLength</a>);</div>
<div class="line">  num = ptr_if_desc-&gt;bNumEndpoints;     <span class="comment">// Number of endpoints</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Check if this is the supported device (VID, PID)</span></div>
<div class="line">  <span class="comment">// Vendor ID value:  ptr_dev_desc-&gt;idVendor</span></div>
<div class="line">  <span class="comment">// Product ID value: ptr_dev_desc-&gt;idProduct</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (ptr_if_desc-&gt;bInterfaceClass) {</div>
<div class="line">    <span class="keywordflow">case</span> CUSTOM_CLASS_IF_CLASS:                 <span class="comment">// Interface class</span></div>
<div class="line">      <span class="keywordflow">switch</span> (ptr_if_desc-&gt;bInterfaceSubClass) {</div>
<div class="line">        <span class="keywordflow">case</span> CUSTOM_CLASS_IF_SUBCLASS:          <span class="comment">// Interface subclass</span></div>
<div class="line">          <span class="keywordflow">switch</span> (ptr_if_desc-&gt;bInterfaceProtocol) {</div>
<div class="line">            <span class="keywordflow">case</span> CUSTOM_CLASS_IF_PROTOCOL:      <span class="comment">// Interface protocol</span></div>
<div class="line">              <span class="comment">// Create Pipes</span></div>
<div class="line">              ptr_ep_desc = (USB_ENDPOINT_DESCRIPTOR *)((uint32_t)ptr_if_desc + ptr_if_desc-&gt;bLength);</div>
<div class="line">              i           = 0U;</div>
<div class="line">              <span class="keywordflow">while</span> (num-- != 0U) {</div>
<div class="line">                pipe_hndl = <a class="code hl_function" href="group__usbh__customFunctions__api.html#gae9f6b49b88dca85534d8addcc7fbf049" title="Create Pipe.">USBH_PipeCreate</a> (device, ptr_ep_desc-&gt;bEndpointAddress, ptr_ep_desc-&gt;bmAttributes &amp; USB_ENDPOINT_TYPE_MASK, ptr_ep_desc-&gt;wMaxPacketSize &amp; 0x7FFU, ptr_ep_desc-&gt;bInterval);</div>
<div class="line">                <span class="keywordflow">if</span> (pipe_hndl == 0U) {</div>
<div class="line">                  <span class="comment">// If creation of pipe has failed delete previously created pipes</span></div>
<div class="line">                  <span class="keywordflow">for</span> (i = 0U; i &lt; 8U; i++) {</div>
<div class="line">                    <span class="keywordflow">if</span> (USBH_CC_PipeHandle[i] != 0U) {</div>
<div class="line">                      (void)<a class="code hl_function" href="group__usbh__customFunctions__api.html#gaeda9f9604ab830e01372bc922d55047c" title="Delete Pipe.">USBH_PipeDelete</a> (USBH_CC_PipeHandle[i]);</div>
<div class="line">                      USBH_CC_PipeHandle[i] = 0U;</div>
<div class="line">                    }</div>
<div class="line">                  }</div>
<div class="line">                  <span class="keywordflow">return</span> 255U;</div>
<div class="line">                }</div>
<div class="line">                USBH_CC_PipeHandle[i++] = pipe_hndl;</div>
<div class="line">                ptr_ep_desc++;</div>
<div class="line">              }</div>
<div class="line">              <span class="keywordflow">return</span> 0U;                <span class="comment">// Device connected and configured</span></div>
<div class="line">                                        <span class="comment">// Only single instance supported</span></div>
<div class="line">                                        <span class="comment">// so it&#39;s instance index is 0</span></div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 255U;                          <span class="comment">// Device not handled</span></div>
<div class="line">}</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">/// \brief De-configure resources</span></div>
<div class="line"><span class="comment">/// \param[in]     instance             index of custom class device instance.</span></div>
<div class="line"><span class="comment">/// \return                             status code that indicates the execution status of the function as defined with usbStatus.</span></div>
<div class="line"><span class="comment"></span><a class="code hl_enumeration" href="group__status__error__codes__usb.html#ga8196235c97e113f17993c7b4baff5f8f" title="Status code values returned by USB library functions.">usbStatus</a> <a class="code hl_function" href="group__usbh__customFunctions__api.html#ga29c81dab6422324f2d94282bdcf8b43d" title="Callback function called when custom class device is disconnected and needs to de-configure resources...">USBH_CustomClass_Unconfigure</a> (uint8_t instance) {</div>
<div class="line">  uint8_t i;</div>
<div class="line"> </div>
<div class="line">  (void)instance;</div>
<div class="line"> </div>
<div class="line">  USBH_CC_Device = 0U;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (i = 0U; i &lt; 8U; i++) {</div>
<div class="line">    <span class="keywordflow">if</span> (USBH_CC_PipeHandle[i] != 0U) {</div>
<div class="line">      (void)<a class="code hl_function" href="group__usbh__customFunctions__api.html#gaeda9f9604ab830e01372bc922d55047c" title="Delete Pipe.">USBH_PipeDelete</a> (USBH_CC_PipeHandle[i]);</div>
<div class="line">      USBH_CC_PipeHandle[i] = 0U;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>;</div>
<div class="line">}</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">/// \brief Initialize Custom Class Device instance</span></div>
<div class="line"><span class="comment">/// \param[in]     instance             index of custom class device instance.</span></div>
<div class="line"><span class="comment">/// \return                             status code that indicates the execution status of the function as defined with usbStatus.</span></div>
<div class="line"><span class="comment"></span><a class="code hl_enumeration" href="group__status__error__codes__usb.html#ga8196235c97e113f17993c7b4baff5f8f" title="Status code values returned by USB library functions.">usbStatus</a> <a class="code hl_function" href="group__usbh__customFunctions__api.html#gaa31a612e0656e87ea050ad905b8ebe06" title="Callback function called when custom class device is connected and needs to initialize custom class d...">USBH_CustomClass_Initialize</a> (uint8_t instance) {</div>
<div class="line">  (void)instance;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//  Add code for initializing device</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>;</div>
<div class="line">}</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">/// \brief De-initialize Custom Class Device instance</span></div>
<div class="line"><span class="comment">/// \param[in]     instance             index of custom class device instance.</span></div>
<div class="line"><span class="comment">/// \return                             status code that indicates the execution status of the function as defined with usbStatus.</span></div>
<div class="line"><span class="comment"></span><a class="code hl_enumeration" href="group__status__error__codes__usb.html#ga8196235c97e113f17993c7b4baff5f8f" title="Status code values returned by USB library functions.">usbStatus</a> <a class="code hl_function" href="group__usbh__customFunctions__api.html#ga015780dcf593743470bb79f7ec8f18bd" title="Callback function called when custom class device is disconnected and needs to de-initialize custom c...">USBH_CustomClass_Uninitialize</a> (uint8_t instance) {</div>
<div class="line">  (void)instance;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Add code for de-initializing device</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>;</div>
<div class="line">}</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">//! [code_USBH_User_CustomClass]</span></div>
</div><!-- fragment --><p><a class="anchor" id="USBH_PL2303_UCT"></a><b>User Code Template USBH_PL2303.c</b> <br  />
 The following source code implements support for Prolific's <a href="https://www.prolific.com.tw/US/index.aspx" class="el" target="_blank">PL2303</a> UART to serial RS232 adapter using the Custom Class functions.</p>
<div class="fragment"><div class="line"><span class="comment">/*------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> * MDK Middleware - Component ::USB:Host:Custom Class</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2004-2024 Arm Limited (or its affiliates). All rights reserved.</span></div>
<div class="line"><span class="comment"> *------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> * Name:    USBH_PL2303.c</span></div>
<div class="line"><span class="comment"> * Purpose: USB Host (USBH) - Custom Class - Prolific PL2303 USB to serial</span></div>
<div class="line"><span class="comment"> *          RS232 adapter driver</span></div>
<div class="line"><span class="comment"> * Rev.:    V6.3.3</span></div>
<div class="line"><span class="comment"> *----------------------------------------------------------------------------*/</span></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * USBH_PL2303.c is a Prolific PL2303 USB to serial RS232 adapter driver</span></div>
<div class="line"><span class="comment"> * for USB Host stack implemented as USB Host Custom Class driver.</span></div>
<div class="line"><span class="comment"> * Prolific PL2303 USB to serial RS232 adapter is similar to the CDC device</span></div>
<div class="line"><span class="comment"> * but using vendor specific class device with interface containing</span></div>
<div class="line"><span class="comment"> * 1 Bulk IN, 1 Bulk OUT and 1 Interrupt IN Endpoints.</span></div>
<div class="line"><span class="comment"> * This implementation supports only one instance.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The template implements 4 callback functions called by the USB Host core</span></div>
<div class="line"><span class="comment"> * when device is connected or disconnected, these are:</span></div>
<div class="line"><span class="comment"> *   USBH_CustomClass_Configure</span></div>
<div class="line"><span class="comment"> *   USBH_CustomClass_Unconfigure</span></div>
<div class="line"><span class="comment"> *   USBH_CustomClass_Initialize</span></div>
<div class="line"><span class="comment"> *   USBH_CustomClass_Uninitialize</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * First to enable USB Host Controller (if not already enabled) call:</span></div>
<div class="line"><span class="comment"> *   USBH_Initialize (ctrl_num);</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rl__usb_8h.html">rl_usb.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Interface class, subclass and protocol of the device that is supported</span></div>
<div class="line"><span class="preprocessor">#define CUSTOM_CLASS_IF_CLASS           USB_DEVICE_CLASS_VENDOR_SPECIFIC</span></div>
<div class="line"><span class="preprocessor">#define CUSTOM_CLASS_IF_SUBCLASS        0</span></div>
<div class="line"><span class="preprocessor">#define CUSTOM_CLASS_IF_PROTOCOL        0</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">extern</span></div>
<div class="line">uint8_t    USBH_CC_Device;</div>
<div class="line">uint8_t    USBH_CC_Device = 0U;         <span class="comment">// Device used for USB transfers</span></div>
<div class="line"><span class="keyword">extern</span> </div>
<div class="line"><a class="code hl_typedef" href="group__usbh__data__types.html#ga98c1a0cd2cf7e047d714fd23dfba5e53">USBH_PIPE_HANDLE</a> USBH_CC_PipeHandle[8];</div>
<div class="line"><a class="code hl_typedef" href="group__usbh__data__types.html#ga98c1a0cd2cf7e047d714fd23dfba5e53">USBH_PIPE_HANDLE</a> USBH_CC_PipeHandle[8]; <span class="comment">// Pipe Handles</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/************************** Class Driver Functions ****************************/</span></div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">/// \brief Analyze device configuration and configure resources</span></div>
<div class="line"><span class="comment">/// \param[in]     device               index of USB Device.</span></div>
<div class="line"><span class="comment">/// \param[in]     ptr_dev_desc         pointer to device descriptor.</span></div>
<div class="line"><span class="comment">/// \param[in]     ptr_cfg_desc         pointer to configuration descriptor.</span></div>
<div class="line"><span class="comment">/// \return                             index of configured custom class device instance or configuration failed :</span></div>
<div class="line"><span class="comment">///                                       - value &lt;= 127 : index of configured custom class device instance</span></div>
<div class="line"><span class="comment">///                                       - value 255 :    configuration failed</span></div>
<div class="line"><span class="comment"></span>uint8_t <a class="code hl_function" href="group__usbh__customFunctions__api.html#ga385a67ca676ca94efcf078b637fdf49c" title="Callback function called when custom class device is connected and needs to configure resources used ...">USBH_CustomClass_Configure</a> (uint8_t device, <span class="keyword">const</span> <a class="code hl_struct" href="group__usbh__data__types.html#structUSB__DEVICE__DESCRIPTOR" title="USB Device Descriptor structure.">USB_DEVICE_DESCRIPTOR</a> *ptr_dev_desc, <span class="keyword">const</span> <a class="code hl_struct" href="group__usbh__data__types.html#structUSB__CONFIGURATION__DESCRIPTOR" title="USB Configuration Descriptor structure.">USB_CONFIGURATION_DESCRIPTOR</a> *ptr_cfg_desc) {</div>
<div class="line">  USB_INTERFACE_DESCRIPTOR *ptr_if_desc;</div>
<div class="line">  USB_ENDPOINT_DESCRIPTOR  *ptr_ep_desc;</div>
<div class="line">  <a class="code hl_typedef" href="group__usbh__data__types.html#ga98c1a0cd2cf7e047d714fd23dfba5e53">USBH_PIPE_HANDLE</a>          pipe_hndl;</div>
<div class="line">  uint8_t                   num, i;</div>
<div class="line"> </div>
<div class="line">  USBH_CC_Device = device;              <span class="comment">// Store device</span></div>
<div class="line">  <span class="keywordflow">for</span> (i = 0U; i &lt; 8U; i++) {           <span class="comment">// Clear all pipe handles</span></div>
<div class="line">    USBH_CC_PipeHandle[i] = 0U;</div>
<div class="line">  }</div>
<div class="line">  ptr_if_desc = (USB_INTERFACE_DESCRIPTOR *)((uint32_t)ptr_cfg_desc + ptr_cfg_desc-&gt;<a class="code hl_variable" href="group__usbh__data__types.html#a1deca1f1d6e5815b290e6e1015bce5b8" title="Size of this descriptor in bytes.">bLength</a>);</div>
<div class="line">  num = ptr_if_desc-&gt;bNumEndpoints;     <span class="comment">// Number of endpoints</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Supported device: - Prolific PL2303 (VID = 0x067B, PID = 0x2303)</span></div>
<div class="line">  <span class="keywordflow">if</span> ((ptr_dev_desc-&gt;<a class="code hl_variable" href="group__usbh__data__types.html#ab393e07556e3858fed36ed2e260d4b4c" title="Vendor ID (assigned by the USB-IF)">idVendor</a> != 0x067BU) || (ptr_dev_desc-&gt;<a class="code hl_variable" href="group__usbh__data__types.html#a2cf29745398a958349d784b1911c6b2b" title="Product ID (assigned by the manufacturer)">idProduct</a> != 0x2303U)) {</div>
<div class="line">    <span class="keywordflow">return</span> 255U;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (ptr_if_desc-&gt;bInterfaceClass) {</div>
<div class="line">    <span class="keywordflow">case</span> CUSTOM_CLASS_IF_CLASS:                 <span class="comment">// Interface class</span></div>
<div class="line">      <span class="keywordflow">switch</span> (ptr_if_desc-&gt;bInterfaceSubClass) {</div>
<div class="line">        <span class="keywordflow">case</span> CUSTOM_CLASS_IF_SUBCLASS:          <span class="comment">// Interface subclass</span></div>
<div class="line">          <span class="keywordflow">switch</span> (ptr_if_desc-&gt;bInterfaceProtocol) {</div>
<div class="line">            <span class="keywordflow">case</span> CUSTOM_CLASS_IF_PROTOCOL:      <span class="comment">// Interface protocol</span></div>
<div class="line">              <span class="comment">// Create Pipes</span></div>
<div class="line">              ptr_ep_desc = (USB_ENDPOINT_DESCRIPTOR *)((uint32_t)ptr_if_desc + ptr_if_desc-&gt;bLength);</div>
<div class="line">              i           = 0U;</div>
<div class="line">              <span class="keywordflow">while</span> (num-- != 0U) {</div>
<div class="line">                pipe_hndl = <a class="code hl_function" href="group__usbh__customFunctions__api.html#gae9f6b49b88dca85534d8addcc7fbf049" title="Create Pipe.">USBH_PipeCreate</a> (device, ptr_ep_desc-&gt;bEndpointAddress, ptr_ep_desc-&gt;bmAttributes &amp; USB_ENDPOINT_TYPE_MASK, ptr_ep_desc-&gt;wMaxPacketSize &amp; 0x7FFU, ptr_ep_desc-&gt;bInterval);</div>
<div class="line">                <span class="keywordflow">if</span> (pipe_hndl == 0U) {</div>
<div class="line">                  <span class="comment">// If creation of pipe has failed delete previously created pipes</span></div>
<div class="line">                  <span class="keywordflow">for</span> (i = 0U; i &lt; 8U; i++) {</div>
<div class="line">                    <span class="keywordflow">if</span> (USBH_CC_PipeHandle[i] != 0U) {</div>
<div class="line">                      (void)<a class="code hl_function" href="group__usbh__customFunctions__api.html#gaeda9f9604ab830e01372bc922d55047c" title="Delete Pipe.">USBH_PipeDelete</a> (USBH_CC_PipeHandle[i]);</div>
<div class="line">                      USBH_CC_PipeHandle[i] = 0U;</div>
<div class="line">                    }</div>
<div class="line">                  }</div>
<div class="line">                  <span class="keywordflow">return</span> 255U;</div>
<div class="line">                }</div>
<div class="line">                USBH_CC_PipeHandle[i++] = pipe_hndl;</div>
<div class="line">                ptr_ep_desc++;</div>
<div class="line">              }</div>
<div class="line">              <span class="keywordflow">return</span> 0U;                <span class="comment">// Device connected and configured</span></div>
<div class="line">                                        <span class="comment">// Only single instance supported</span></div>
<div class="line">                                        <span class="comment">// so it&#39;s instance index is 0</span></div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 255U;                          <span class="comment">// Device not handled</span></div>
<div class="line">}</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">/// \brief De-configure resources</span></div>
<div class="line"><span class="comment">/// \param[in]     instance             index of custom class device instance.</span></div>
<div class="line"><span class="comment">/// \return                             status code that indicates the execution status of the function as defined with usbStatus.</span></div>
<div class="line"><span class="comment"></span><a class="code hl_enumeration" href="group__status__error__codes__usb.html#ga8196235c97e113f17993c7b4baff5f8f" title="Status code values returned by USB library functions.">usbStatus</a> <a class="code hl_function" href="group__usbh__customFunctions__api.html#ga29c81dab6422324f2d94282bdcf8b43d" title="Callback function called when custom class device is disconnected and needs to de-configure resources...">USBH_CustomClass_Unconfigure</a> (uint8_t instance) {</div>
<div class="line">  uint8_t i;</div>
<div class="line"> </div>
<div class="line">  (void)instance;                       <span class="comment">// Only single instance is supported</span></div>
<div class="line"> </div>
<div class="line">  USBH_CC_Device = 0U;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (i = 0U; i &lt; 8U; i++) {</div>
<div class="line">    <span class="keywordflow">if</span> (USBH_CC_PipeHandle[i] != 0U) {</div>
<div class="line">      (void)<a class="code hl_function" href="group__usbh__customFunctions__api.html#gaeda9f9604ab830e01372bc922d55047c" title="Delete Pipe.">USBH_PipeDelete</a> (USBH_CC_PipeHandle[i]);</div>
<div class="line">      USBH_CC_PipeHandle[i] = 0U;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>;</div>
<div class="line">}</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">/// \brief Initialize Custom Class Device instance</span></div>
<div class="line"><span class="comment">/// \param[in]     instance             index of custom class device instance.</span></div>
<div class="line"><span class="comment">/// \return                             status code that indicates the execution status of the function as defined with usbStatus.</span></div>
<div class="line"><span class="comment"></span><a class="code hl_enumeration" href="group__status__error__codes__usb.html#ga8196235c97e113f17993c7b4baff5f8f" title="Status code values returned by USB library functions.">usbStatus</a> <a class="code hl_function" href="group__usbh__customFunctions__api.html#gaa31a612e0656e87ea050ad905b8ebe06" title="Callback function called when custom class device is connected and needs to initialize custom class d...">USBH_CustomClass_Initialize</a> (uint8_t instance) {</div>
<div class="line">  <a class="code hl_struct" href="group__usbd__data__types.html#structUSB__SETUP__PACKET" title="USB Setup Packet structure.">USB_SETUP_PACKET</a> setup_packet;</div>
<div class="line">  uint32_t         br;</div>
<div class="line">  uint8_t          buf[8];</div>
<div class="line"> </div>
<div class="line">  (void)instance;                       <span class="comment">// Only single instance is supported</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Custom PL2303 initialization</span></div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#af7ad4865d238e6994874ea0f56963db0" title="Characteristics of request.">bmRequestType</a>.Dir      = USB_REQUEST_DEVICE_TO_HOST;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#af7ad4865d238e6994874ea0f56963db0" title="Characteristics of request.">bmRequestType</a>.Type     = USB_REQUEST_VENDOR;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#af7ad4865d238e6994874ea0f56963db0" title="Characteristics of request.">bmRequestType</a>.Recipient= USB_REQUEST_TO_DEVICE;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a1e7be110861bd4ff75c86d5214f31543" title="Specific request.">bRequest</a>               = 1U;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a7383d0165ad8eab48aa239c005199121" title="Value according to request.">wValue</a>                 = 0x8484U;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#adc578ce35d89d52deba61ee6f312f177" title="Index or Offset according to request.">wIndex</a>                 = 0U;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a496c03443b177fd2e6c93616064d2934" title="Number of bytes to transfer if there is a Data stage.">wLength</a>                = 1U;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__usbh__customFunctions__api.html#ga2b0c9f2e4d76ce263a95962edd13cc7c" title="Do a Control Transfer on Default Pipe.">USBH_ControlTransfer</a> (USBH_CC_Device, &amp;setup_packet, buf,  1U) != <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>) { <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8fa605117e84b100032def244dfc1bf6c38" title="Custom device Class (Class) error (no device or device produced error)">usbClassErrorCustom</a>; }</div>
<div class="line"> </div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#af7ad4865d238e6994874ea0f56963db0" title="Characteristics of request.">bmRequestType</a>.Dir      = USB_REQUEST_HOST_TO_DEVICE;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a7383d0165ad8eab48aa239c005199121" title="Value according to request.">wValue</a>                 = 0x0404U;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__usbh__customFunctions__api.html#ga2b0c9f2e4d76ce263a95962edd13cc7c" title="Do a Control Transfer on Default Pipe.">USBH_ControlTransfer</a> (USBH_CC_Device, &amp;setup_packet, buf,  1U) != <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>) { <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8fa605117e84b100032def244dfc1bf6c38" title="Custom device Class (Class) error (no device or device produced error)">usbClassErrorCustom</a>; }</div>
<div class="line"> </div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#af7ad4865d238e6994874ea0f56963db0" title="Characteristics of request.">bmRequestType</a>.Dir      = USB_REQUEST_DEVICE_TO_HOST;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a7383d0165ad8eab48aa239c005199121" title="Value according to request.">wValue</a>                 = 0x8484U;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__usbh__customFunctions__api.html#ga2b0c9f2e4d76ce263a95962edd13cc7c" title="Do a Control Transfer on Default Pipe.">USBH_ControlTransfer</a> (USBH_CC_Device, &amp;setup_packet, buf,  1U) != <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>) { <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8fa605117e84b100032def244dfc1bf6c38" title="Custom device Class (Class) error (no device or device produced error)">usbClassErrorCustom</a>; }</div>
<div class="line"> </div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a7383d0165ad8eab48aa239c005199121" title="Value according to request.">wValue</a>                 = 0x8383U;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__usbh__customFunctions__api.html#ga2b0c9f2e4d76ce263a95962edd13cc7c" title="Do a Control Transfer on Default Pipe.">USBH_ControlTransfer</a> (USBH_CC_Device, &amp;setup_packet, buf,  1U) != <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>) { <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8fa605117e84b100032def244dfc1bf6c38" title="Custom device Class (Class) error (no device or device produced error)">usbClassErrorCustom</a>; }</div>
<div class="line"> </div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a7383d0165ad8eab48aa239c005199121" title="Value according to request.">wValue</a>                 = 0x8484U;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__usbh__customFunctions__api.html#ga2b0c9f2e4d76ce263a95962edd13cc7c" title="Do a Control Transfer on Default Pipe.">USBH_ControlTransfer</a> (USBH_CC_Device, &amp;setup_packet, buf,  1U) != <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>) { <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8fa605117e84b100032def244dfc1bf6c38" title="Custom device Class (Class) error (no device or device produced error)">usbClassErrorCustom</a>; }</div>
<div class="line"> </div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#af7ad4865d238e6994874ea0f56963db0" title="Characteristics of request.">bmRequestType</a>.Dir      = USB_REQUEST_HOST_TO_DEVICE;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a7383d0165ad8eab48aa239c005199121" title="Value according to request.">wValue</a>                 = 0x0404U;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#adc578ce35d89d52deba61ee6f312f177" title="Index or Offset according to request.">wIndex</a>                 = 1U;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a496c03443b177fd2e6c93616064d2934" title="Number of bytes to transfer if there is a Data stage.">wLength</a>                = 0U;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__usbh__customFunctions__api.html#ga2b0c9f2e4d76ce263a95962edd13cc7c" title="Do a Control Transfer on Default Pipe.">USBH_ControlTransfer</a> (USBH_CC_Device, &amp;setup_packet, NULL, 0U) != <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>) { <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8fa605117e84b100032def244dfc1bf6c38" title="Custom device Class (Class) error (no device or device produced error)">usbClassErrorCustom</a>; }</div>
<div class="line"> </div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#af7ad4865d238e6994874ea0f56963db0" title="Characteristics of request.">bmRequestType</a>.Dir      = USB_REQUEST_DEVICE_TO_HOST;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a7383d0165ad8eab48aa239c005199121" title="Value according to request.">wValue</a>                 = 0x8484U;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#adc578ce35d89d52deba61ee6f312f177" title="Index or Offset according to request.">wIndex</a>                 = 0U;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a496c03443b177fd2e6c93616064d2934" title="Number of bytes to transfer if there is a Data stage.">wLength</a>                = 1U;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__usbh__customFunctions__api.html#ga2b0c9f2e4d76ce263a95962edd13cc7c" title="Do a Control Transfer on Default Pipe.">USBH_ControlTransfer</a> (USBH_CC_Device, &amp;setup_packet, buf,  1U) != <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>) { <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8fa605117e84b100032def244dfc1bf6c38" title="Custom device Class (Class) error (no device or device produced error)">usbClassErrorCustom</a>; }</div>
<div class="line"> </div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a7383d0165ad8eab48aa239c005199121" title="Value according to request.">wValue</a>                 = 0x8383U;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__usbh__customFunctions__api.html#ga2b0c9f2e4d76ce263a95962edd13cc7c" title="Do a Control Transfer on Default Pipe.">USBH_ControlTransfer</a> (USBH_CC_Device, &amp;setup_packet, buf,  1U) != <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>) { <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8fa605117e84b100032def244dfc1bf6c38" title="Custom device Class (Class) error (no device or device produced error)">usbClassErrorCustom</a>; }</div>
<div class="line"> </div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#af7ad4865d238e6994874ea0f56963db0" title="Characteristics of request.">bmRequestType</a>.Dir      = USB_REQUEST_HOST_TO_DEVICE;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a7383d0165ad8eab48aa239c005199121" title="Value according to request.">wValue</a>                 = 0U;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#adc578ce35d89d52deba61ee6f312f177" title="Index or Offset according to request.">wIndex</a>                 = 1U;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a496c03443b177fd2e6c93616064d2934" title="Number of bytes to transfer if there is a Data stage.">wLength</a>                = 0U;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__usbh__customFunctions__api.html#ga2b0c9f2e4d76ce263a95962edd13cc7c" title="Do a Control Transfer on Default Pipe.">USBH_ControlTransfer</a> (USBH_CC_Device, &amp;setup_packet, NULL, 0U) != <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>) { <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8fa605117e84b100032def244dfc1bf6c38" title="Custom device Class (Class) error (no device or device produced error)">usbClassErrorCustom</a>; }</div>
<div class="line"> </div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a7383d0165ad8eab48aa239c005199121" title="Value according to request.">wValue</a>                 = 1U;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#adc578ce35d89d52deba61ee6f312f177" title="Index or Offset according to request.">wIndex</a>                 = 0U;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__usbh__customFunctions__api.html#ga2b0c9f2e4d76ce263a95962edd13cc7c" title="Do a Control Transfer on Default Pipe.">USBH_ControlTransfer</a> (USBH_CC_Device, &amp;setup_packet, NULL, 0U) != <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>) { <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8fa605117e84b100032def244dfc1bf6c38" title="Custom device Class (Class) error (no device or device produced error)">usbClassErrorCustom</a>; }</div>
<div class="line"> </div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a7383d0165ad8eab48aa239c005199121" title="Value according to request.">wValue</a>                 = 2U;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#adc578ce35d89d52deba61ee6f312f177" title="Index or Offset according to request.">wIndex</a>                 = 0x44U;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__usbh__customFunctions__api.html#ga2b0c9f2e4d76ce263a95962edd13cc7c" title="Do a Control Transfer on Default Pipe.">USBH_ControlTransfer</a> (USBH_CC_Device, &amp;setup_packet, NULL, 0U) != <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>) { <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8fa605117e84b100032def244dfc1bf6c38" title="Custom device Class (Class) error (no device or device produced error)">usbClassErrorCustom</a>; }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Initial CDC SetLineCoding request: Set 9600 baud, 8 data bits, 1 stop bit, no parity</span></div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#af7ad4865d238e6994874ea0f56963db0" title="Characteristics of request.">bmRequestType</a>.Dir      = USB_REQUEST_HOST_TO_DEVICE;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#af7ad4865d238e6994874ea0f56963db0" title="Characteristics of request.">bmRequestType</a>.Type     = USB_REQUEST_CLASS;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#af7ad4865d238e6994874ea0f56963db0" title="Characteristics of request.">bmRequestType</a>.Recipient= USB_REQUEST_TO_INTERFACE;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a1e7be110861bd4ff75c86d5214f31543" title="Specific request.">bRequest</a>               = 0x20U;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a7383d0165ad8eab48aa239c005199121" title="Value according to request.">wValue</a>                 = 0U;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#adc578ce35d89d52deba61ee6f312f177" title="Index or Offset according to request.">wIndex</a>                 = 0U;</div>
<div class="line">  setup_packet.<a class="code hl_variable" href="group__usbd__data__types.html#a496c03443b177fd2e6c93616064d2934" title="Number of bytes to transfer if there is a Data stage.">wLength</a>                = 7U;</div>
<div class="line">  br                                  = 9600U;          <span class="comment">// Data terminal rate in bits per second = 9600 baud</span></div>
<div class="line">  buf[0]                              = (uint8_t)( br        &amp; 0xFFU);</div>
<div class="line">  buf[1]                              = (uint8_t)((br &gt;&gt;  8) &amp; 0xFFU);</div>
<div class="line">  buf[2]                              = (uint8_t)((br &gt;&gt; 16) &amp; 0xFFU);</div>
<div class="line">  buf[3]                              = (uint8_t)((br &gt;&gt; 24) &amp; 0xFFU);</div>
<div class="line">  buf[4]                              = 0U;            <span class="comment">// Number of stop bits = 1</span></div>
<div class="line">  buf[5]                              = 0U;            <span class="comment">// Parity bit type = None</span></div>
<div class="line">  buf[6]                              = 8U;            <span class="comment">// Number of data bits = 8</span></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__usbh__customFunctions__api.html#ga2b0c9f2e4d76ce263a95962edd13cc7c" title="Do a Control Transfer on Default Pipe.">USBH_ControlTransfer</a> (USBH_CC_Device, &amp;setup_packet, buf, 7U) != <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>) { <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8fa605117e84b100032def244dfc1bf6c38" title="Custom device Class (Class) error (no device or device produced error)">usbClassErrorCustom</a>; }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>;</div>
<div class="line">}</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">/// \brief De-initialize Custom Class Device instance</span></div>
<div class="line"><span class="comment">/// \param[in]     instance             index of custom class device instance.</span></div>
<div class="line"><span class="comment">/// \return                             status code that indicates the execution status of the function as defined with usbStatus.</span></div>
<div class="line"><span class="comment"></span><a class="code hl_enumeration" href="group__status__error__codes__usb.html#ga8196235c97e113f17993c7b4baff5f8f" title="Status code values returned by USB library functions.">usbStatus</a> <a class="code hl_function" href="group__usbh__customFunctions__api.html#ga015780dcf593743470bb79f7ec8f18bd" title="Callback function called when custom class device is disconnected and needs to de-initialize custom c...">USBH_CustomClass_Uninitialize</a> (uint8_t instance) {</div>
<div class="line"> </div>
<div class="line">  (void)instance;                       <span class="comment">// Only single instance is supported</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="rl__usb_8h.html#ga8196235c97e113f17993c7b4baff5f8facfe6cb72ed8e7b8e95a38cbf95418dbf" title="Function completed with no error.">usbOK</a>;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
