<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>USB Component: USB Host</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">USB Component
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "USB Component");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">MDK Middleware for USB Device and Host Communication</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('USB_Host.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">USB Host </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This chapter describes the software structure of the USB Host Component and explains its use for creating an USB Host application.</p>
<p>The USB Host Component simplifies software development of microcontroller systems that allow to connect USB Devices. The attributes of the USB Host Component are:</p>
<ul>
<li>Complies with the USB 2.0 specification.</li>
<li>Support for <a class="el" href="HID.html">HID</a>, <a class="el" href="MSC.html">MSC</a>, <a class="el" href="CDC.html">CDC</a>, and <a class="el" href="CustomClass.html">Custom</a> USB Device Classes to be connected to the USB Host.</li>
<li>Support for <a class="el" href="USB_Endpoints.html#USB_Control_Transfers">control</a>, <a class="el" href="USB_Endpoints.html#USB_Interrupt_Transfers">interrupt</a> and <a class="el" href="USB_Endpoints.html#USB_Bulk_Transfers">bulk</a> transfer types.</li>
</ul>
<h1><a class="anchor" id="usbh_rte_components"></a>
RTE Components</h1>
<p>The following picture shows the relationships of the RTE Components with the microcontroller's USB Host peripheral (USB Controller). RTE Components provide configuration files and user code templates. <b>Configuration files</b> configure the RTE Components, hardware interfaces, memory resources and USB Host parameters. <b>User code templates</b> provide the skeleton for implementing support for different USB Device classes.</p>
<div class="image">
<img src="usb_host_blocks_config_files.png" alt=""/>
<div class="caption">
USB Host Structure</div></div>
<h1><a class="anchor" id="Create_a_USB_Host_Application"></a>
Create an Application</h1>
<p>The steps to create a microcontroller application that functions as an USB Host are:</p><ol type="1">
<li>Select <a class="el" href="USB_Host.html#RTE_Software_Component_Selection_USBH">RTE Components</a> that are required for your application.</li>
<li><a class="el" href="USB_Host.html#USB_Driver_Configuration_USBH">Enable and configure the USB Host Driver</a>.</li>
<li>Configure the <a class="el" href="USB_Host.html#USB_Host_Configuration_USBH">USB Host</a> that connects the USB Middleware to the microcontroller USB peripheral.</li>
<li>Configure the <a class="el" href="USB_Host.html#usbh_system_resources">System Resources</a> according to the USB Host component's <a class="el" href="usb_resource_requirements.html#usbh_res_req">Resource Requirements</a>.</li>
<li>Configure the parameters of the attached <a class="el" href="USB_Host.html#USB_Device_Class_Configuration_USBH">USB Devices</a>.</li>
<li>Implement the <a class="el" href="USB_Host.html#USBH_User_Code_Implementation">Application Code</a> using code templates that are provided to support various USB Device Classes.</li>
<li><a class="el" href="USB_Host.html#usbh_debugging">Debug</a> you application using the built-in mechanisms of the USB Component.</li>
</ol>
<h2><a class="anchor" id="RTE_Software_Component_Selection_USBH"></a>
RTE Component Selection</h2>
<p>The RTE Component selection is done in a few steps:</p>
<ol type="1">
<li>From the USB Component:<ul>
<li>Select <b>USB:CORE</b> that provides the basic functionality required for USB communication.</li>
<li>Set <b>USB:Host</b> to '1'. This creates one USB Host for communication with attached USB Devices.</li>
<li>Select the desired support for USB Classes (HID/MSC/CDC/Custom Class). For example, select <b>USB:Host:HID</b> to support HID Class Devices only.</li>
</ul>
</li>
<li>From the Drivers Component:<ul>
<li>Select an appropriate USB Host driver suitable for your application.</li>
</ul>
</li>
<li>From the Device Component:<ul>
<li>Additional device specific drivers may be required according to the validation output.</li>
</ul>
</li>
<li>From the CMSIS Component:<ul>
<li>Select the <b>CMSIS:CORE</b> to provide the core interface to the processor.</li>
<li>Select a suitable <b>CMSIS:RTOS2</b> that is a required for the application.</li>
</ul>
</li>
</ol>
<div class="image">
<img src="USBH_RTE.png" alt="" width="90%"/>
<div class="caption">
RTE Component Selection </div></div>
<h2><a class="anchor" id="USB_Driver_Configuration_USBH"></a>
USB Driver and Controller</h2>
<p>The USB Host Driver and the USB Controller of the microcontroller need to be correctly configured. In particular this means:</p>
<ul>
<li>The USB Host Driver selected under the Drivers Component is typically configured with a driver specific configuration header file. Some microcontrollers may require settings that related to a physical layer interface <b></b>(PHY), the USB <b>VBUS</b> power and <b>Overcurrent</b> protection.</li>
<li>The USB Controller of the microcontroller needs typically specific clock settings. Consult the user's guide of the microcontroller to understand the requirements. Alternatively you may copy the setup of an USB Host example that is provided for various evaluation boards.</li>
</ul>
<h2><a class="anchor" id="USB_Host_Configuration_USBH"></a>
USB Host Configuration</h2>
<p>The <b>USBH_Config_<em>n</em>.h</b> file contains additional settings for the specific USB Host:</p><ul>
<li>The <b>Driver_USBH#</b> is set according to the selected USB Controller. For device with single USB Host Controller it will typically be '0'.</li>
<li><b>Power Consumption</b> can be configured according to hardware capability of the USB Host Controller.</li>
<li><b>Maximum Pipes</b> can be specified according to expected USB Device classes that are expected to be used by the USB Host.</li>
<li><b>Memory Pool</b> parameters can be configured that are necessary for USB Host operation. This memory pool can also be located to specific memory via the linker script.</li>
</ul>
<p>Refer to <a class="el" href="group__usbh__coreFunctions__conf.html">Configuration</a> for a detailed list of all available settings.</p>
<h2><a class="anchor" id="usbh_system_resources"></a>
System Resource Configuration</h2>
<p>For proper operation, the USB Host Component requires some system configuration settings. The requirements are:</p><ul>
<li>Additional <b>main stack size</b> of <b>512 bytes</b>.</li>
<li>The USB Host Component uses CMSIS-RTOS2 threads. In case <b>RTX v5</b> is used <b>no changes to RTX settings</b> are necessary as all resources are allocated statically.</li>
</ul>
<p>For more information, check the USB Host component's <a class="el" href="usb_resource_requirements.html#usbh_res_req">Resource Requirements</a> section.</p>
<h2><a class="anchor" id="USB_Device_Class_Configuration_USBH"></a>
Configuration of Attachable USB Devices</h2>
<p>In the <b>USBH_Config_HID.h</b>, <b>USBH_Config_MSC.h</b>, <b>USBH_Config_CDC.h</b>, or <b>USBH_Config_CustomClass.h</b> you can specify the number of concurrent USB Devices that the USB Host will support. This has an impact on the amount of memory that will be reserved in your application for the attachment of USB Devices. The <a class="el" href="USB_Host_Tutorial.html">Examples</a> shows how to configure an USB Host to interact with different HID, MSC or CDC peripheral devices.</p>
<h2><a class="anchor" id="USBH_User_Code_Implementation"></a>
User Code Implementation</h2>
<p> <script>link_ext('uv4_ca_sourcefiles');</script> files provide function templates to support various USB Device Classes on the USB Host. The available functions are explained in the <a class="el" href="group__usbh__DevClassFunctions.html">Reference</a> section of the USB Host Component. These routines can be adapted to the needs of the microcontroller application, in case different then default functionality is needed.</p>
<p>The following templates are available for the USB Host component: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Template Name   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USBH_MSC.c   </td><td class="markdownTableBodyNone">Required functions to support MSC devices. The template can be found <a class="el" href="group__usbh__mscFunctions.html#USBH_MSC_UCT">here</a>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USBH_PL2303.c   </td><td class="markdownTableBodyNone">Required functions to support the <a href="https://www.prolific.com.tw/US/index.aspx" class="el" target="_blank">Prolific PL2303</a> USB to serial RS232 adapter. The template can be found <a class="el" href="group__usbh__customFunctions.html#USBH_PL2303_UCT">here</a>.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USBH_User_CustomClass.c   </td><td class="markdownTableBodyNone">Required functions to support any USB Device class. The template can be found <a class="el" href="group__usbh__customFunctions.html#USBH_Cust_UCT">here</a>.   </td></tr>
</table>
<h2><a class="anchor" id="usbh_debugging"></a>
Debugging</h2>
<p>USB Host Component is distributed in a source form and it allows direct code debug. Also debug events are available (via Event Recorder) which provide non-intrusive debugging during runtime.</p>
<p><b>USB_Debug.h</b> configuration file is used to configure the level of debug events.</p>
<p>The <a class="el" href="group__usbh__evr.html">USB Host:Debug Events</a> describes the events implemented in the USB Device Component.</p>
<p><a class="anchor" id="usbHostEvrSupport"></a></p>
<h2><a class="anchor" id="autotoc_md2"></a>
Event Recorder Support</h2>
<p> <script>link_ext('Event-Recorder-About');</script> is a powerful tool that provides visibility to the dynamic execution of the program.</p>
<p>The USB Host Component generates <a class="el" href="group__usbh__evr.html">a broad set of Debug Events</a> for the Event Recorder and implements required infrastructure to interface with it.</p>
<p>To use the Event Recorder it is required to create an image with event generation support. The necessary steps are:</p><ol type="1">
<li> <script>link_ext('Event-Recorder-Enable');</script>: in the RTE management dialog enable the software component <b>CMSIS-View:Event Recorder</b>.</li>
<li>Ensure that Event Recorder is initialized preferably by  <script>link_ext('RTX5-Event-Recorder-Config');</script> if CMSIS-RTOS2 RTX v5 is used, or alternatively by calling the function  <script>link_ext('Event-Recorder-Initialize-Func');</script> in the application code.</li>
<li><a class="el" href="USB_Host.html#usbHostEvrConfig">Event Recorder Configuration</a>: if necessary, adjust default Event Recorder configuration.</li>
<li>Build the application code, download it to the target hardware and start debug session.</li>
</ol>
<p>Now, when the USB Host generates event information, it can be viewed in the  <script>link_ext('uv4-Event-Recorder');</script>.</p>
<p><a class="anchor" id="usbHostEvrConfig"></a></p>
<h2><a class="anchor" id="autotoc_md3"></a>
Event Recorder Configuration</h2>
<p>This section describes the configuration settings for the Event Recorder; refer to <a class="el" href="USB_Host.html#usbHostEvrSupport">Event Recorder Support</a> for more information.</p>
<p><b>USB Event Generation Configuration</b></p>
<p>Selecting the <b>USB:CORE</b> will add the file <code>USB_Debug.h</code> to your project. Use this file to set the event generation configuration for USB core, drivers, and device classes separately. The file is common for USB Device and Host components.</p>
<div class="image">
<img src="USBH_USB_Debug_h.png" alt=""/>
<div class="caption">
USB_Debug.h file for event generation configuration</div></div>
<p>The following settings are available for event generation configuration of each module:</p><ul>
<li><b>Off</b> means no events will be generated by the module</li>
<li><b>Errors</b> means only error events will be generated by the module</li>
<li><b>Errors + API</b> means error and API call events will be generated by the module</li>
<li><b>All</b> means all available events will be generated by the module. Besides error and API call events, this contains operation and detailed events.</li>
</ul>
<p><b>Event IDs</b></p>
<p>The USB Host component uses the following event IDs: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Component   </th><th class="markdownTableHeadNone">Event ID    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USBH_Core   </td><td class="markdownTableBodyNone">0xB0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USBH_Driver   </td><td class="markdownTableBodyNone">0xB1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USBH_CC   </td><td class="markdownTableBodyNone">0xB2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USBH_CDC   </td><td class="markdownTableBodyNone">0xB3    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USBH_HID   </td><td class="markdownTableBodyNone">0xB4    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USBH_MSC   </td><td class="markdownTableBodyNone">0xB5   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
