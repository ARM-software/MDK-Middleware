<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>USB Component: Create an Application</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">USB Component
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "USB Component");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">MDK Middleware for USB Device and Host Communication</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('usbd_create_app.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Create an Application </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_src_usbd_create_app"></a> The steps to create a microcontroller application that uses USB communication with an USB Device controller are:</p>
<ol type="1">
<li>Select <a class="el" href="usbd_create_app.html#RTE_Software_Component_Selection">RTE Components</a> along with the USB Device Classes that are required for your application.</li>
<li><a class="el" href="usbd_create_app.html#USB_Driver_Configuration">Enable and configure the USB Device Driver</a>.</li>
<li>Configure the <a class="el" href="usbd_create_app.html#USB_Device_Configuration">USB Device</a> that connects the USB Middleware to the microcontroller USB peripheral.</li>
<li>Configure <a class="el" href="usbd_create_app.html#USB_Device_Class_Configuration">USB Device Class Configuration and USB Endpoint Settings</a> for each selected USB Device Class and instance.</li>
<li>Configure the <a class="el" href="usbd_create_app.html#usbd_system_resources">System Resources</a> according to the USB Device component's <a class="el" href="resource_requirements.html#usbd_res_req">Resource Requirements</a>.</li>
<li>Implement the <a class="el" href="usbd_create_app.html#User_Code_Implementation">Application Code</a> using code templates that are provided for the USB Device Classes.</li>
<li>If required by your application, you can <a class="el" href="usbd_create_app.html#Overriding_Descriptors">change the default USB Device descriptors</a>.</li>
<li><a class="el" href="usbd_create_app.html#usbd_debugging">Debug</a> you application using the built-in mechanisms of the USB Component.</li>
</ol>
<p>For interfacing to an USB Host computer, standard USB Device Classes drivers can be used. This may require additional software development for the USB Host application. An exemplary application for interfacing to an USB HID Device is explained <a class="el" href="usbd_pc_utilities.html#hid_client_app">here</a>.</p>
<h1><a class="anchor" id="RTE_Software_Component_Selection"></a>
RTE Component Selection</h1>
<p>Only a few steps are necessary to complete the RTE Component selection:</p>
<ol type="1">
<li>From the <b>USB</b> group:<ul>
<li>Select <b>USB:CORE</b> component that provides the basic functionality required for USB communication.</li>
<li>Set <b>USB:Device</b> component instances to '1'. This creates one USB Device for communication with the USB Host.</li>
<li>Select the desired USB Classes (HID/MSC/CDC/Custom Class) components. For example, set <b>USB:Device:HID</b> component instances to '1' to create a single HID Class Device. If you select more than one class or multiple instances of the same class on the same device, you will create a <b>Composite USB Device</b>.</li>
</ul>
</li>
<li>From the <b>CMSIS Driver</b> group:<ul>
<li>Select an appropriate <b>USB Device driver</b> component suitable for your microcontroller.</li>
</ul>
</li>
<li>From the <b>Device</b> group:<ul>
<li>Select the target <b>microcontroller device</b> component.</li>
<li>Additional device specific driver components may be required according to the validation output.</li>
</ul>
</li>
<li>From the <b>CMSIS</b> group:<ul>
<li>Select the <b>CMSIS:CORE</b> component to provide the core interface to the processor.</li>
<li>Select a suitable <b>CMSIS:RTOS2</b> component that is required by the application.</li>
</ul>
</li>
</ol>
<div> <img src="rteusbx.png" alt="" style="text-align:left;" class="inline"/> <div class="caption" style="text-align:center;">RTE Component Selection</div> </div><dl class="section note"><dt>Note</dt><dd><ul>
<li>Most microcontrollers have only one USB Controller implemented in hardware and only one driver <b>Driver_USBD0</b> is available. In this case, only one <b>USB:Device</b> component can be selected to generate <b>USB Device 0</b>.</li>
<li>On a single <b>USB Device 0</b> an USB Composite Device may be implemented that combines multiple USB Device Classes.</li>
<li>When a microcontroller implements multiple USB Controllers an additional <b>USB Device 1</b> can be generated by setting <b>USB:Device</b> component instances to '2'.</li>
</ul>
</dd></dl>
<h1><a class="anchor" id="USB_Driver_Configuration"></a>
USB Driver and Controller</h1>
<p>The USB Device Driver and the USB Controller of the microcontroller need to be correctly configured. In particular this means:</p>
<ul>
<li>The USB Device Driver selected under the Drivers group is typically configured with a driver specific configuration header file. Some microcontrollers may require settings that are related to a physical layer interface (<b>PHY</b>). The picture below shows two possible variants. Either, the USB PHY is integrated into the controller, or an external chip is used for providing the USB signal lines:</li>
</ul>
<div class="image">
<img src="usb_phy.png" alt=""/>
<div class="caption">
USB Controller and PHY Setups</div></div>
    <ul>
<li>The USB Controller of the microcontroller typically needs specific clock settings. Consult the user's guide of the microcontroller to understand the requirements. Alternatively you may copy the setup of a similar USB Device configuration provided for various evaluation boards (BSP).</li>
</ul>
<h1><a class="anchor" id="USB_Device_Configuration"></a>
USB Device Configuration</h1>
<p>The configuration file <b>USBD_Config_n.h</b> contains a number of important settings for the specific USB Device.</p>
<ul>
<li>The <b>Driver_USBD#</b> number is set according to the selected USB Controller. This specifies which driver will be used for the USB Device determining the pin-out as well. For devices with single USB Device Controller it will typically be '0'.</li>
<li><b>High-Speed</b> may be selected if supported by the USB Controller.</li>
<li>The <b>Vendor ID</b> (VID) needs to be set to a private Vendor ID. The default Vendor ID is owned by Keil and must not be used for actual products. Please visit <a href="https://www.usb.org/getting-vendor-id">USB-IF</a> for more information on how to apply for a valid Vendor ID.</li>
<li>Every device variant needs an unique <b>Product ID</b>. Together with the <b>Vendor ID</b>, it is used by the Host computer's operating system to find a driver for your device.</li>
<li>The <b>Device Release Number</b> will be shown in Windows and Linux systems as "Firmware Revision". The number will be interpreted as "binary coded decimal", meaning that 0x0101 will be shown as firmware revision 1.01.</li>
<li>The <b>Manufacturer</b>, <b>Product</b> and the <b>Serial Number String</b> can be set to identify the USB Device from the USB Host.</li>
</ul>
<p>Refer to <a class="el" href="group__usbd__coreFunctions__conf.html">USB Core Configuration</a> for more configuration options of the USB Device.</p>
<dl class="section note"><dt>Note</dt><dd>You can configure the USB Device at run-time using the functions from the <a class="el" href="group__usbd__coreFunctions__api.html">USB Device Core API</a>. The section <a class="el" href="group__usbd__coreFunctions.html">USB Device Core</a> explains the details. Implement the run-time specific behavior with the user code template <a class="el" href="group__usbd__coreFunctions.html#USBD_User_Device_UCT">USBD_User_Device_n.c</a>.</dd></dl>
<h1><a class="anchor" id="USB_Device_Class_Configuration"></a>
USB Device Class Configuration and USB Endpoint Settings</h1>
<p>The USB Device Class Parameters and Endpoint Settings are configured in separate files for each USB Device Class and separately for each instance. The configuration files contain Device Class specific Endpoint Settings.</p>
<ul>
<li><b>USBD_Config_ADC_n.h</b> configuration for Audio Device Class (ADC).</li>
<li><b>USBD_Config_CDC_n.h</b> configuration for Communication Device Class (CDC).</li>
<li><b>USBD_Config_HID_n.h</b> configuration for Human Interface Device Class (HID).</li>
<li><b>USBD_Config_MSC_n.h</b> configuration for Mass Storage Device Class (MSC).</li>
<li><b>USBD_Config_CustomClass_n.h</b> configuration for Custom Class.</li>
</ul>
<p>Each <a class="el" href="USB_Concepts.html#USB_Endpoints">USB Endpoint</a> can only be used once on the same USB Device. It has to be made sure that the different USB Device Classes or multiple instances of the same USB Device Class use different Endpoints. The default configuration supports applications that use a single USB Device Class. The remaining parameters are specific settings that configure parameters for USB communication speed and the USB Device Class.</p>
<h1><a class="anchor" id="usbd_system_resources"></a>
System Resource Configuration</h1>
<p>For proper operation, the USB Device Component requires some system configuration settings. The requirements are:</p>
<ul>
<li>Additional <b>main stack size</b> of <b>512 bytes</b>.</li>
<li>The USB Device Component uses CMSIS-RTOS2 threads. In case <b>RTX v5</b> is used <b>no changes to RTX settings</b> are necessary as all resources are allocated statically.</li>
</ul>
<p>For more information, check the USB Device component's <a class="el" href="resource_requirements.html#usbd_res_req">Resource Requirements</a> section.</p>
<h1><a class="anchor" id="User_Code_Implementation"></a>
User Code Implementation</h1>
<p> <script>link_ext('uv4_ca_sourcefiles');</script> files provide function templates used to implement USB Device Class functionality. The available functions are explained in the <a class="el" href="group__usbd__DevClassFunctions.html">Reference</a> section of the USB Component. These routines can be adapted to the needs of the microcontroller application, in case that functionality different then default is needed.</p>
<p>The following templates are available for the USB Device component:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Template Name   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="group__usbd__adcFunctions.html#USBD_User_ADC_UCT">USBD_User_ADC_n.c</a>   </td><td class="markdownTableBodyNone">Functions for an ADC device.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="group__usbd__cdcFunctions__acm.html#USBD_User_CDC_ACM_UCT">USBD_User_CDC_ACM_n.c</a>   </td><td class="markdownTableBodyNone">Functions for a CDC (ACM) device.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="group__usbd__cdcFunctions__acm.html#USBD_User_CDC_ACM_RNDIS_VETH_UCT">USBD_User_CDC_ACM_RNDIS_VETH_n.c</a>   </td><td class="markdownTableBodyNone">Functions for a CDC (ACM) RNDIS virtual Ethernet device.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="group__usbd__cdcFunctions__acm.html#USBD_User_CDC_ACM_RNDIS_ETH_UCT">USBD_User_CDC_ACM_RNDIS_ETH_n.c</a>   </td><td class="markdownTableBodyNone">Functions for a CDC (ACM) RNDIS and Ethernet bridge device (Ethernet-over-USB).    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="group__usbd__cdcFunctions__acm.html#USBD_User_CDC_ACM_UART_UCT">USBD_User_CDC_ACM_UART_n.c</a>   </td><td class="markdownTableBodyNone">Functions for a CDC (ACM) device demonstrating a USB &lt;-&gt; UART bridge.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="group__usbd__cdcFunctions__ncm.html#USBD_User_CDC_NCM_UCT">USBD_User_CDC_NCM_n.c</a>   </td><td class="markdownTableBodyNone">Functions for a CDC (NCM) device.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="group__usbd__cdcFunctions__ncm.html#USBD_User_CDC_NCM_ETH_UCT">USBD_User_CDC_NCM_ETH_n.c</a>   </td><td class="markdownTableBodyNone">Functions for a CDC (NCM) device (Ethernet-over-USB).    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="group__usbd__classFunctions.html#USBD_User_Cust_UCT">USBD_User_CustomClass_n.c</a>   </td><td class="markdownTableBodyNone">Functions for a device supporting a custom USB Device class.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="group__usbd__coreFunctions.html#USBD_User_Device_UCT">USBD_User_Device_n.c</a>   </td><td class="markdownTableBodyNone">Functions for specific Control Endpoint 0 requests handling.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="group__usbd__coreFunctions.html#USBD_User_Device_SerNum_UCT">USBD_User_SerNum_n.c</a>   </td><td class="markdownTableBodyNone">Example for specific Control Endpoint 0 requests handling: Changing the serial number of the USB Device.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="group__usbd__hidFunctions.html#USBD_User_HID_UCT">USBD_User_HID_n.c</a>   </td><td class="markdownTableBodyNone">Functions for a HID device.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="group__usbd__hidFunctions.html#USBD_User_HID_Mouse_UCT">USBD_User_HID_Mouse_n.c</a>   </td><td class="markdownTableBodyNone">Example for a HID device acting as a mouse input device.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="group__usbd__mscFunctions.html#USBD_User_MSC_UCT">USBD_User_MSC_n.c</a>   </td><td class="markdownTableBodyNone">Functions for a mass storage device.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="group__usbd__mscFunctions.html#USBD_MSC_UCT">USBD_MSC_n.c</a>   </td><td class="markdownTableBodyNone">Shows how to get access to storage media either from the application/File System or from the USB host.   </td></tr>
</table>
<h1><a class="anchor" id="Overriding_Descriptors"></a>
Changing Default USB Descriptors</h1>
<p>If there are different requirements regarding the <a class="el" href="USB_Concepts.html#USB_Descriptors">USB Descriptors</a>, the USB Component allows that. A user can change any or all of the default USB descriptors. Default descriptors are the ones that library creates based on <a class="el" href="usbd_create_app.html#USB_Device_Configuration">Device</a> and <a class="el" href="usbd_create_app.html#USB_Device_Class_Configuration">Classes</a> configuration file settings and are located in the code memory.</p>
<p>The descriptors can be changed in two of the following ways:</p>
<h2><a class="anchor" id="autotoc_md0"></a>
Static change</h2>
<p>Static change of descriptors can be done to replace default descriptors if they will not change at run-time. The descriptors can be easily overridden by user code by creating descriptors with the same name.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">USB Device Descriptor   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>const uint8_t usbdn_ep0_descriptor[]</code>   </td><td class="markdownTableBodyNone">Control Endpoint 0 descriptor.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>const uint8_t usbdn_device_descriptor[]</code>   </td><td class="markdownTableBodyNone">USB Device descriptor.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>const uint8_t usbdn_config_descriptor_fs[]</code>   </td><td class="markdownTableBodyNone">Configuration descriptor for low/full-speed.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>const uint8_t usbdn_config_descriptor_hs[]</code>   </td><td class="markdownTableBodyNone">Configuration descriptor for high-speed.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>const uint8_t usbdn_device_qualifier_fs[]</code>   </td><td class="markdownTableBodyNone">Device qualifier for low/full-speed.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>const uint8_t usbdn_device_qualifier_hs[]</code>   </td><td class="markdownTableBodyNone">Device qualifier for high-speed.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>const uint8_t usbdn_other_speed_config_descriptor_fs[]</code>   </td><td class="markdownTableBodyNone">Other speed configuration descriptor for low/full-speed.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>const uint8_t usbdn_other_speed_config_descriptor_hs[]</code>   </td><td class="markdownTableBodyNone">Other speed configuration descriptor for high-speed.   </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd><code>n</code> in <code>usbdn_</code> represents the USB Device instance. So for the USB Device 0 instance, you have to use <code>usbd0_...</code></dd>
<dd>
Only the String descriptors cannot be replaced this way.</dd></dl>
<p><b>Code Example</b></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rl__usb_8h.html">rl_usb.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Statically change USB Device 0 Device Descriptor</span></div>
<div class="line"><span class="keyword">const</span> uint8_t <a class="code hl_variable" href="rl__usb_8h.html#a1f6574fc211662ba2464641b93a7545b">usbd0_device_descriptor</a>[] = { </div>
<div class="line">  18U,         <span class="comment">// bLength = 18 bytes</span></div>
<div class="line">  1U,          <span class="comment">// bDescriptorType = 1 = Device Descriptor Type</span></div>
<div class="line">  0U,2U,       <span class="comment">// bcdUSB = 2.00 (little-endian)</span></div>
<div class="line">  0U,          <span class="comment">// bDeviceClass = 0 = Defined in interface</span></div>
<div class="line">  0U,          <span class="comment">// bDeviceSubClass = 0 = Defined in interface</span></div>
<div class="line">  0U,          <span class="comment">// bDeviceProtocol = 0 = Defined in interface</span></div>
<div class="line">  64U,         <span class="comment">// bMaxPacketSize = 64</span></div>
<div class="line">  0x51U,0xC2U, <span class="comment">// idVendor = 0xC251 (little-endian)</span></div>
<div class="line">  0x34U,0x12U, <span class="comment">// idProduct = 0x1234 (little-endian)</span></div>
<div class="line">  0U,1U,       <span class="comment">// bcdDevice = 1.00 (little-endian)</span></div>
<div class="line">  0U,          <span class="comment">// iManufacturer = 0 = No Manufacturer string</span></div>
<div class="line">  0U,          <span class="comment">// iProduct = 0 = No Product string</span></div>
<div class="line">  0U,          <span class="comment">// iSerialNumber = 0 = No Serial Number string</span></div>
<div class="line">  1U           <span class="comment">// bNumConfigurations = 1 = 1 configuration</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1"></a>
Dynamic change</h2>
<p>Dynamic change of descriptors can be used to change descriptors at run-time. The <code>struct <a class="el" href="group__usbd__data__types.html#structusbd__desc__t" title="USB Device Descriptors structure.">usbd_desc_t</a></code> contains the required information. It is stored in RAM and contains pointers to the USB descriptors. If you change the pointers in the structure to point to the externally created ones, you effectively change the descriptors.</p>
<p>The structure <code>usbdn_desc</code> (n indicating the USB Device instance number) contains the pointers to the descriptors. The following code example shows how to override the device descriptor for the <b>USB Device 0</b> (<code>usbd0_desc</code>):</p>
<p><b>Code Example</b></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rl__usb_8h.html">rl_usb.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Dynamically change USB Device 0 Device Descriptor</span></div>
<div class="line"><span class="keyword">const</span> uint8_t dev0_device_descriptor[] = { </div>
<div class="line">  18U,         <span class="comment">// bLength = 18 bytes</span></div>
<div class="line">  1U,          <span class="comment">// bDescriptorType = 1 = Device Descriptor Type</span></div>
<div class="line">  0U,2U,       <span class="comment">// bcdUSB = 2.00 (little-endian)</span></div>
<div class="line">  0U,          <span class="comment">// bDeviceClass = 0 = Defined in interface</span></div>
<div class="line">  0U,          <span class="comment">// bDeviceSubClass = 0 = Defined in interface</span></div>
<div class="line">  0U,          <span class="comment">// bDeviceProtocol = 0 = Defined in interface</span></div>
<div class="line">  64U,         <span class="comment">// bMaxPacketSize = 64</span></div>
<div class="line">  0x51U,0xC2U, <span class="comment">// idVendor = 0xC251 (little-endian)</span></div>
<div class="line">  0x34U,0x12U, <span class="comment">// idProduct = 0x1234 (little-endian)</span></div>
<div class="line">  0U,1U,       <span class="comment">// bcdDevice = 1.00 (little-endian)</span></div>
<div class="line">  0U,          <span class="comment">// iManufacturer = 0 = No Manufacturer string</span></div>
<div class="line">  0U,          <span class="comment">// iProduct = 0 = No Product string</span></div>
<div class="line">  0U,          <span class="comment">// iSerialNumber = 0 = No Serial Number string</span></div>
<div class="line">  1U           <span class="comment">// bNumConfigurations = 1 = 1 configuration</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>) {</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line">  <a class="code hl_variable" href="rl__usb_8h.html#a583aaa36a7338c8a01042772ba4e922b">usbd0_desc</a>.<a class="code hl_variable" href="group__usbd__data__types.html#a6e7af2b72d956bff4b2e91b2ba82cc10" title="Pointer to Device Descriptor.">device_descriptor</a> = dev0_device_descriptor;</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>For just changing the serial number string use the <a class="el" href="group__usbd__coreFunctions__api.html#ga3ccf0ff5b34716f104e3891158b5c6d6">USBD_SetSerialNumber</a> function.</dd>
<dd>
For non high-speed capable device following descriptors are not important:<ul>
<li><a class="el" href="USB_Concepts.html#USB_Device_Qualifier_Descriptor">Device Qualifier Descriptor</a> for high-speed</li>
<li><a class="el" href="USB_Concepts.html#USB_Configuration_Descriptor">Configuration Descriptor</a> for high-speed</li>
<li>Other speed <a class="el" href="USB_Concepts.html#USB_Configuration_Descriptor">Configuration Descriptor</a> for low/full-speed</li>
<li>Other speed <a class="el" href="USB_Concepts.html#USB_Configuration_Descriptor">Configuration Descriptor</a> high-speed</li>
</ul>
</dd></dl>
<h1><a class="anchor" id="usbd_debugging"></a>
Debugging</h1>
<p>USB Device Component is distributed in a source form and it allows direct code debug. However, with breakpoint stopping the program execution the USB Device will usually malfunction as USB Host will not be able to properly enumerate the device or communicate with it thus causing communication timeouts and failures. For such usage case a non-intrusive debug via the debug events is also provided (via Event Recorder).</p>
<p><code>USB_Debug.h</code> configuration file is used to configure the level of debug events.</p>
<p>The <a class="el" href="group__usbd__evr.html">USB Device:Debug Events</a> describes the events implemented in the USB Device Component.</p>
<h2><a class="anchor" id="usbDevEvr"></a>
Event Recorder</h2>
<p> <script>link_ext('Event-Recorder-About');</script> is a powerful tool that provides visibility to the dynamic execution of the program.</p>
<p>The USB Device Component generates a broad set of <a class="el" href="group__usbd__evr.html">Debug Events</a> for the Event Recorder and implements required infrastructure to interface with it.</p>
<p>To use the Event Recorder it is required to create an image with event generation support. The necessary steps are:</p>
<ol type="1">
<li> <script>link_ext('Event-Recorder-Enable');</script>: in the RTE management dialog enable the software component <b>CMSIS-View:Event Recorder</b>.</li>
<li>Ensure that Event Recorder is initialized preferably by  <script>link_ext('RTX5-Event-Recorder-Config');</script> if CMSIS-RTOS2 RTX v5 is used, or alternatively by calling the function  <script>link_ext('Event-Recorder-Initialize-Func');</script> in the application code.</li>
<li><a class="el" href="usbd_create_app.html#usbDevEvrConfig">Event Recorder Configuration</a>: if necessary, adjust default Event Recorder configuration.</li>
<li>In <code>USB_Debug.h</code> enable USB Device event generation and configure event filters.</li>
<li>Build the application code, download it to the target hardware and start a debug session.</li>
</ol>
<p>Now, when the USB Device generates event information, it can be viewed in the  <script>link_ext('uv4-Event-Recorder');</script>.</p>
<h3><a class="anchor" id="usbDevEvrConfig"></a>
Configuration</h3>
<p>This section describes the configuration settings for the Event Recorder.</p>
<p><b>USB Event Generation Configuration</b></p>
<p>Selecting the <b>USB:CORE</b> will add the file <code>USB_Debug.h</code> to your project. Use this file to set the event generation configuration for USB core, drivers, and device classes separately. The file is common for USB Device and Host components.</p>
<div class="image">
<img src="USBD_USB_Debug_h.png" alt=""/>
<div class="caption">
USB_Debug.h file for event generation configuration</div></div>
    <p>The following settings are available for event generation configuration of each module:</p>
<ul>
<li><b>Off</b> means no events will be generated by the module</li>
<li><b>Errors</b> means only error events will be generated by the module</li>
<li><b>Errors + API</b> means error and API call events will be generated by the module</li>
<li><b>All</b> means all available events will be generated by the module. Besides error and API call events, this contains operation and detailed events.</li>
</ul>
<h3><a class="anchor" id="autotoc_md2"></a>
Event IDs</h3>
<p>The USB Device component uses the following event IDs:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Component   </th><th class="markdownTableHeadNone">Event ID    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USBD_Core   </td><td class="markdownTableBodyNone">0xA0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USBD_Driver   </td><td class="markdownTableBodyNone">0xA1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USBD_CC   </td><td class="markdownTableBodyNone">0xA2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USBD_ADC   </td><td class="markdownTableBodyNone">0xA3    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USBD_CDC   </td><td class="markdownTableBodyNone">0xA4    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USBD_HID   </td><td class="markdownTableBodyNone">0xA5    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USBD_MSC   </td><td class="markdownTableBodyNone">0xA6   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
