<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>USB Component: Custom USB Device (WinUSB_Echo)</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">USB Component
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "USB Component");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">MDK Middleware for USB Device and Host Communication</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dev_cc_tutorial.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Custom USB Device (WinUSB_Echo) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Using the custom USB class, you can implement any USB device that is not covered by the other classes available in the MDK Middleware. An example is available for various development boards that is implementing a custom class to work with the Windows USB (WinUSB), a generic driver for USB devices for Microsoft Windows. The example demonstrates a WinUSB device that contains Bulk IN and Bulk OUT endpoints. All data that the device receives on the Bulk OUT endpoint is echoed back on the Bulk IN endpoint.</p>
<p>The following picture shows an exemplary connection of the development board and the Windows USB host computer. Using the USB connection and WinUSB_Test.exe ("install_dir\ARM\PACK\Keil\Middleware\x.y.z\Utilities\WinUSB_Test" folder (where "install_dir" refers to the installation directory of Arm Keil MDK, default "C:\Keil_v5") and x &gt;= 7, y &gt;= 5, z &gt;= 0), you can initiate . For more information, refer to <a class="el" href="usb_sw_utilities.html#winusb_app">WinUSB Test</a>.</p>
<div class="image">
<img src="cc_dev_example_setup.png" alt=""/>
<div class="caption">
Hardware setup for WinUSB Custom Class example</div></div>
<p>The <b>Abstract.txt</b> file contained in the <b>Documentation</b> group of the <b>Project</b> window gives you more information on the general setup.</p>
<h1><a class="anchor" id="autotoc_md26"></a>
Build the "WinUSB_Echo" Project</h1>
<p>Open the example project in MDK. The µVision <b>Project</b> window should display a similar project structure:</p>
<div class="image">
<img src="usb_cc_example_proj_window.png" alt=""/>
<div class="caption">
Typical project structure of WinUSB_Test example</div></div>
<h2><a class="anchor" id="autotoc_md27"></a>
Source Files</h2>
<ul>
<li><b>main.c</b> contains the main C function that initializes the hardware.</li>
<li><b>WinUSB_Echo.c</b> contains the app_main C function that initializes USB Device Component.</li>
<li>The files <b>USBD_User_CustomClass_0.c/USBD_User_CustomClass_1.c</b> are adapted code templates that implement all necessary functions. Refer to <a class="el" href="group__usbd__classFunctions.html">Custom Class</a> for details about these template functions.</li>
</ul>
<p>If you are using RTOS other than CMSIS-RTOS2 RTX5 for your project please make sure to satisfy <a class="el" href="usb_resource_requirements.html#usbd_res_req">USB Device Resource Requirements</a>.</p>
<p>You may now build and download the example project to the evaluation board using the µVision commands:</p><ul>
<li><b>Project</b> --&gt; <b> Build target (F7) </b></li>
<li><b>Flash</b> --&gt; <b> Download (F8) </b></li>
</ul>
<p>After these steps, the project should start executing on your evaluation kit. In case of errors, refer to the Evaluation Board User's Guide for configuration information.</p>
<h1><a class="anchor" id="autotoc_md28"></a>
Using the "WinUSB_Echo" Project</h1>
<h2><a class="anchor" id="autotoc_md29"></a>
Hardware Setup</h2>
<p>The setup of the evaluation board hardware is described in the <b>Abstract.txt</b> file.</p><ul>
<li>Verify all jumper settings on the target hardware.</li>
<li>Use a USB cable to connect your development board to the host PC and power up your board.</li>
<li>If you connect the device to a PC running Windows 8 or later, the device driver will be installed automatically. On Windows 7, you need to select a driver file that can be found in the project folder. For more information, refer to the <b>Abstract.txt</b> file in the µVision project.</li>
</ul>
<h2><a class="anchor" id="autotoc_md30"></a>
PC Software</h2>
<p>The example can be tested on a Windows PC using the WinUSB_Test.exe utility provided with MDK Middleware. The program runs stand-alone without installation. Simply run "install_dir\\ARM\PACK\Keil\MDK-Middleware\x.y.z\Utilities\WinUSB_Test\Release\WinUSB_Test.exe" application (where x &gt;= 7, y &gt;= 5, z &gt;= 0):</p>
<div class="image">
<img src="WinUSB_Test_application.png" alt=""/>
</div>
<p><b>Device</b> <b>Selection</b> </p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Configuration Option   </th><th class="markdownTableHeadNone">Selection    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GIUD   </td><td class="markdownTableBodyNone">The GUID that is used in Windows to access the device. For this example, the GIUD is fixed. To create your own GIUD, refer to the <b>Abstract.txt</b> file.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Device   </td><td class="markdownTableBodyNone">Select the device that you have attached to the PC (VID should be C251).   </td></tr>
</table>
<p><b>Control</b> <b>Transfer</b> </p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Configuration Option   </th><th class="markdownTableHeadNone">Selection    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Setup Packet   </td><td class="markdownTableBodyNone">Normally, leave open. Will be filled automatically from the next options.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Direction   </td><td class="markdownTableBodyNone">Specify the communication direction. If you want to read for example the device descriptor from the device, use Device-to-Host.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://www.beyondlogic.org/usbnutshell/usb6.shtml" target="_blank">Type</a>   </td><td class="markdownTableBodyNone">Type of the control request (standard/class/vendor).    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://www.beyondlogic.org/usbnutshell/usb6.shtml" target="_blank">Recipient</a>   </td><td class="markdownTableBodyNone">Recipient of the control transfer message (device/interface/endpoint/other).    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://www.beyondlogic.org/usbnutshell/usb6.shtml" target="_blank">bRequest</a>   </td><td class="markdownTableBodyNone">Specify the setup packet request being made.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://www.beyondlogic.org/usbnutshell/usb6.shtml" target="_blank">wValue</a>   </td><td class="markdownTableBodyNone">Specify the wValue of the request.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://www.beyondlogic.org/usbnutshell/usb6.shtml" target="_blank">wIndex</a>   </td><td class="markdownTableBodyNone">Specify the wIndex of the request.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://www.beyondlogic.org/usbnutshell/usb6.shtml" target="_blank">wLength</a>   </td><td class="markdownTableBodyNone">Specify the wLength of the request.   </td></tr>
</table>
<p><b>Data</b> <b>Phase</b> </p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Configuration Option   </th><th class="markdownTableHeadNone">Selection    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Data (aa bb cc ..)   </td><td class="markdownTableBodyNone">Shows the transmitted data    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Transfer button   </td><td class="markdownTableBodyNone">Start the data transfer    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">File   </td><td class="markdownTableBodyNone">Select a file for transfer or for saving transferred data    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Transfer to/from File button   </td><td class="markdownTableBodyNone">Start the data transfer to/from file   </td></tr>
</table>
<p><b>Bulk/Interrupt</b> <b>Transfer</b> </p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Configuration Option   </th><th class="markdownTableHeadNone">Selection    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Interface   </td><td class="markdownTableBodyNone">Select USB interface number    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">IN Transfer Endpoint   </td><td class="markdownTableBodyNone">Select IN endpoint to be used for bulk/interrupt transfer    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Number of bytes to receive   </td><td class="markdownTableBodyNone">Specify the number of bytes to be received    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Data (aa bb cc ..)   </td><td class="markdownTableBodyNone">Shows the received data    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Start Reception button   </td><td class="markdownTableBodyNone">Start listening on the specified endpoint    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">File   </td><td class="markdownTableBodyNone">Select a file for saving received data    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Start Reception to File button   </td><td class="markdownTableBodyNone">Start listening on the specified endpoint and save data to file    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OUT Transfer Endpoint   </td><td class="markdownTableBodyNone">Select OUT endpoint to be used for bulk/interrupt transfer    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Data (aa bb cc ..)   </td><td class="markdownTableBodyNone">Enter the data to be transmitted    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Start Transmission button   </td><td class="markdownTableBodyNone">Start sending data on the specified endpoint    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">File   </td><td class="markdownTableBodyNone">Select a file for data to be transmitted    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Start Transmission from File button   </td><td class="markdownTableBodyNone">Start sending data from the specified file on the OUT endpoint   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md31"></a>
Examples</h2>
<p><b>Control</b> <b>Transfer</b> </p>
<p>To setup the control endpoint and to read out the device descriptor of the device, enter the following:</p><ul>
<li>Direction: Device-to-Host</li>
<li>bRequest: 06</li>
<li>wValue: 0100</li>
<li>wIndex 0000</li>
<li>wLength: 0012</li>
</ul>
<p>After pressing the <b>Transfer</b> button, you see the response in the Data window:</p>
<div class="image">
<img src="WinUSB_Test_control_transfer.png" alt=""/>
</div>
<p><b>Bulk</b> <b>Transfer</b> </p>
<p>To loop data from the device to the PC and back, enter the following:</p><ul>
<li>Interface: 0</li>
<li>IN Transfer Endpoint: 1</li>
<li>Press Start Reception to Buffer</li>
<li>OUT Transfer Endpoint: 1</li>
<li>Enter some data in the right-hand Data window, for example AA BB CC</li>
<li>Press Start Transmission from Buffer</li>
</ul>
<p>You now see the same data in the left-hand Data window:</p>
<div class="image">
<img src="WinUSB_Test_bulk_transfer.png" alt=""/>
</div>
<p><b>About Host PC driver for Microsoft Windows</b></p>
<p>The example folder contains two files relevant for driver installation on the Microsoft Windows:</p><ul>
<li>Driver setup information file (xxx-winusb_echo.inf) which is used to create a digitally signed driver catalog file (xxx-winusb_echo.cat)</li>
<li>Digitally signed driver catalog file (xxx-winusb_echo.cat)</li>
</ul>
<p>The driver files are provided as an example, the driver setup information file should be adapted and digitally signed driver catalog file should be created from adapted driver setup information file.</p>
<p>Driver setup information file should be adapted in the following way:</p><ul>
<li><b>c251</b> in Vendor ID <b>VID_c251</b> entries should be changed to the vendor ID number assigned to your company by the USB organization (c251 Vendor ID is reserved for Keil Software and should not be used)</li>
<li><b>xxxx</b> in Product ID <b>PID_xxxx</b> entries should be changed to the product ID as assigned by your company</li>
<li><b>[DeviceList.xxx]</b> sections should be changed if device is a composite device in the following way:<br  />
 instead of entries like: <div class="fragment"><div class="line">%DeviceName0% = USB_Install, USB\VID_xxxx&amp;PID_yyyy </div>
</div><!-- fragment --> entries describing each custom class instance should be added like: <div class="fragment"><div class="line">%DeviceName0% = USB_Install, USB\VID_xxxx&amp;PID_yyyy&amp;MI_00 </div>
</div><!-- fragment --> where two digit number after MI_ describes the starting interface of a custom class instance</li>
<li><b>[Strings]</b> section should be changed as desired</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Vendor ID and Product ID are configured in the USBD_Config_n.h configuration file of the embedded application. </dd>
<dd>
For producing digitally signed driver catalog file please refer to Microsoft Windows documentation. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
