<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>USB Component: Create an Application</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">USB Component
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "USB Component");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">MDK Middleware for USB Device and Host Communication</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('usbh_create_app.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Create an Application </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_src_usbh_create_app"></a> The steps to create a microcontroller application that functions as an USB Host are:</p>
<ol type="1">
<li>Select <a class="el" href="usbh_create_app.html#RTE_Software_Component_Selection_USBH">RTE Components</a> that are required for your application.</li>
<li><a class="el" href="usbh_create_app.html#USB_Driver_Configuration_USBH">Enable and configure the USB Host Driver</a>.</li>
<li>Configure the <a class="el" href="usbh_create_app.html#USB_Host_Configuration_USBH">USB Host</a> that connects the USB Middleware to the microcontroller USB peripheral.</li>
<li>Configure the <a class="el" href="usbh_create_app.html#usbh_system_resources">System Resources</a> according to the USB Host component's <a class="el" href="resource_requirements.html#usbh_res_req">Resource Requirements</a>.</li>
<li>Configure the parameters of the attached <a class="el" href="usbh_create_app.html#USB_Device_Class_Configuration_USBH">USB Devices</a>.</li>
<li>Implement the <a class="el" href="usbh_create_app.html#USBH_User_Code_Implementation">Application Code</a> using code templates that are provided to support various USB Device Classes.</li>
<li><a class="el" href="usbh_create_app.html#usbh_debugging">Debug</a> you application using the built-in mechanisms of the USB Component.</li>
</ol>
<h1><a class="anchor" id="RTE_Software_Component_Selection_USBH"></a>
RTE Component Selection</h1>
<p>Only a few steps are necessary to complete the RTE Component selection:</p>
<ol type="1">
<li>From the <b>USB</b> group:<ul>
<li>Select <b>USB:CORE</b> component that provides the basic functionality required for USB communication.</li>
<li>Set <b>USB:Host</b> component instances to '1'. This creates one USB Host for communication with the attached USB Devices.</li>
<li>Select the desired USB Classes (HID/MSC/CDC/Custom Class) components. For example, select <b>USB:Host:HID</b> to support HID Class Devices only.</li>
</ul>
</li>
<li>From the <b>CMSIS Driver</b> group:<ul>
<li>Select an appropriate <b>USB Host driver</b> component suitable for your microcontroller.</li>
</ul>
</li>
<li>From the <b>Device</b> group:<ul>
<li>Select the target <b>microcontroller device</b> component.</li>
<li>Additional device specific driver components may be required according to the validation output.</li>
</ul>
</li>
<li>From the <b>CMSIS</b> group:<ul>
<li>Select the <b>CMSIS:CORE</b> component to provide the core interface to the processor.</li>
<li>Select a suitable <b>CMSIS:RTOS2</b> component that is required by the application.</li>
</ul>
</li>
</ol>
<div> <img src="USBH_RTE.png" alt="" style="text-align:left;" class="inline"/> <div class="caption" style="text-align:center;">RTE Component Selection</div> </div><h1><a class="anchor" id="USB_Driver_Configuration_USBH"></a>
USB Driver and Controller</h1>
<p>The USB Host Driver and the USB Controller of the microcontroller need to be correctly configured. In particular this means:</p>
<ul>
<li>The USB Host Driver selected under the Drivers Component is typically configured with a driver specific configuration header file. Some microcontrollers may require settings that related to a physical layer interface (<b>PHY</b>), the USB <b>VBUS</b> power and <b>Overcurrent</b> protection.</li>
<li>The USB Controller of the microcontroller needs typically specific clock settings. Consult the user's guide of the microcontroller to understand the requirements. Alternatively you may copy the setup of a similar USB Host configuration provided for various evaluation boards (BSP).</li>
</ul>
<h1><a class="anchor" id="USB_Host_Configuration_USBH"></a>
USB Host Configuration</h1>
<p>The <b>USBH_Config_n.h</b> file contains additional settings for the specific USB Host:</p>
<ul>
<li>The <b>Driver_USBH#</b> is set according to the selected USB Controller. For device with single USB Host Controller it will typically be '0'.</li>
<li><b>Port Power Delivery</b> can be configured according to hardware capability of the USB Host Controller.</li>
<li><b>Maximum Pipes</b> can be specified according to expected USB Device classes that are expected to be used by the USB Host.</li>
<li><b>Memory Pool</b> parameters can be configured that are necessary for USB Host operation. This memory pool can also be located to specific memory via the linker script.</li>
</ul>
<p>Refer to <a class="el" href="group__usbh__coreFunctions__conf.html">Configuration</a> for a detailed list of all available settings.</p>
<h1><a class="anchor" id="usbh_system_resources"></a>
System Resource Configuration</h1>
<p>For proper operation, the USB Host Component requires some system configuration settings. The requirements are:</p>
<ul>
<li>Additional <b>main stack size</b> of <b>512 bytes</b>.</li>
<li>The USB Host Component uses CMSIS-RTOS2 threads. In case <b>RTX v5</b> is used <b>no changes to RTX settings</b> are necessary as all resources are allocated statically.</li>
</ul>
<p>For more information, check the USB Host component's <a class="el" href="resource_requirements.html#usbh_res_req">Resource Requirements</a> section.</p>
<h1><a class="anchor" id="USB_Device_Class_Configuration_USBH"></a>
Configuration of Attachable USB Devices</h1>
<p>In the <code>USBH_Config_HID.h</code>, <code>USBH_Config_MSC.h</code>, <code>USBH_Config_CDC.h</code>, or <code>USBH_Config_CustomClass.h</code> you can specify the number of concurrent USB Devices that the USB Host will support. This has an impact on the amount of memory that will be reserved in your application for the attachment of USB Devices. The <a class="el" href="usbh_examples.html">Examples</a> shows how to configure an USB Host to interact with different HID, MSC or CDC peripheral devices.</p>
<h1><a class="anchor" id="USBH_User_Code_Implementation"></a>
User Code Implementation</h1>
<p> <script>link_ext('uv4_ca_sourcefiles');</script> files provide function templates to support various USB Device Classes on the USB Host. The available functions are explained in the <a class="el" href="group__usbh__DevClassFunctions.html">Reference</a> section of the USB Host Component. These routines can be adapted to the needs of the microcontroller application, in case different then default functionality is needed.</p>
<p>The following templates are available for the USB Host component:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Template Name   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USBH_MSC.c   </td><td class="markdownTableBodyNone">Required functions to support MSC devices. The template can be found <a class="el" href="group__usbh__mscFunctions.html#USBH_MSC_UCT">here</a>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USBH_PL2303.c   </td><td class="markdownTableBodyNone">Required functions to support the <a href="https://www.prolific.com.tw/US/index.aspx">Prolific PL2303</a> USB to serial RS232 adapter. The template can be found <a class="el" href="group__usbh__customFunctions.html#USBH_PL2303_UCT">here</a>.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USBH_User_CustomClass.c   </td><td class="markdownTableBodyNone">Required functions to support any USB Device class. The template can be found <a class="el" href="group__usbh__customFunctions.html#USBH_Cust_UCT">here</a>.   </td></tr>
</table>
<h1><a class="anchor" id="usbh_debugging"></a>
Debugging</h1>
<p>USB Host Component is distributed in a source form and it allows direct code debug. Also debug events are available (via Event Recorder) which provide non-intrusive debugging during run-time.</p>
<p><code>USB_Debug.h</code> configuration file is used to configure the level of debug events.</p>
<p>The <a class="el" href="group__usbh__evr.html">USB Host:Debug Events</a> describes the events implemented in the USB Device Component.</p>
<h2><a class="anchor" id="usbHostEvrSupport"></a>
Event Recorder Support</h2>
<p> <script>link_ext('Event-Recorder-About');</script> is a powerful tool that provides visibility to the dynamic execution of the program.</p>
<p>The USB Host Component generates a broad set of <a class="el" href="group__usbh__evr.html">Debug Events</a> for the Event Recorder and implements required infrastructure to interface with it.</p>
<p>To use the Event Recorder it is required to create an image with event generation support. The necessary steps are:</p>
<ol type="1">
<li> <script>link_ext('Event-Recorder-Enable');</script>: in the RTE management dialog enable the software component <b>CMSIS-View:Event Recorder</b>.</li>
<li>Ensure that Event Recorder is initialized preferably by  <script>link_ext('RTX5-Event-Recorder-Config');</script> if CMSIS-RTOS2 RTX v5 is used, or alternatively by calling the function  <script>link_ext('Event-Recorder-Initialize-Func');</script> in the application code.</li>
<li><a class="el" href="usbh_create_app.html#usbHostEvrConfig">Event Recorder Configuration</a>: if necessary, adjust default Event Recorder configuration.</li>
<li><a class="el" href="usbh_create_app.html#usbHostDbgConfig">Configure Event Generation</a> in the <code>USB_Debug.h</code> configuration file.</li>
<li>Build the application code, download it to the target hardware and start debug session.</li>
</ol>
<p>Now, when the USB Host generates event information, it can be viewed in the  <script>link_ext('uv4-Event-Recorder');</script>.</p>
<h2><a class="anchor" id="usbHostEvrConfig"></a>
Event Recorder Configuration</h2>
<p>This section describes the configuration settings for the Event Recorder; refer to  <script>link_ext('RTX5-Event-Recorder-Config');</script> for more information.</p>
<h3><a class="anchor" id="usbHostDbgConfig"></a>
USB Event Generation Configuration</h3>
<p>Selecting the <b>USB:CORE</b> will add the file <code>USB_Debug.h</code> to your project. Use this file to set the event generation configuration for USB core, drivers, and device classes separately. The file is common for USB Device and Host components.</p>
<div class="image">
<img src="USBH_USB_Debug_h.png" alt=""/>
<div class="caption">
USB_Debug.h file for event generation configuration</div></div>
    <p>The following settings are available for event generation configuration of each module:</p>
<ul>
<li><b>Off</b> means no events will be generated by the module</li>
<li><b>Errors</b> means only error events will be generated by the module</li>
<li><b>Errors + API</b> means error and API call events will be generated by the module</li>
<li><b>All</b> means all available events will be generated by the module. Besides error and API call events, this contains operation and detailed events.</li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
Event IDs</h2>
<p>The USB Host component uses the following event IDs:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Component   </th><th class="markdownTableHeadNone">Event ID    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USBH_Core   </td><td class="markdownTableBodyNone">0xB0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USBH_Driver   </td><td class="markdownTableBodyNone">0xB1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USBH_CC   </td><td class="markdownTableBodyNone">0xB2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USBH_CDC   </td><td class="markdownTableBodyNone">0xB3    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USBH_HID   </td><td class="markdownTableBodyNone">0xB4    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USBH_MSC   </td><td class="markdownTableBodyNone">0xB5   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
