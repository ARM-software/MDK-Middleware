<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>File System Component: Theory of Operation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">File System Component
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "File System Component");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">MDK Middleware for Devices with Flash File System</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('fs_operation.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Theory of Operation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The File System Component provides functions to create, save, read, and modify files. The Retarget Interface of the C/C++ compiler run-time library allows the usage of ANSI C standard file I/O functions. The File System Component is designed for Cortex-M processor-based devices and requires an CMSIS-RTOS compliant real-time operating system for thread-safe operation.</p>
<p>The File System Component consists of two different file systems, placed on top of different layers, depending on the media type:</p><ul>
<li><a class="el" href="fat_fs.html">FAT File System</a> (using FAT12, FAT16, or FAT32) is used for <a class="el" href="fs_create_app.html#mc_usage">memory card</a> devices, <a class="el" href="fs_create_app.html#usb_usage">USB Memory sticks</a>, <a class="el" href="fs_create_app.html#nand_usage">NAND Flash</a> devices, and <a class="el" href="fs_create_app.html#ram_usage">RAM disks</a>. FAT is a standard file system used on many computers.</li>
<li><a class="el" href="emb_fs.html">Embedded File System (EFS)</a> is optimized for <a class="el" href="fs_create_app.html#nor_usage">NOR Flash</a> memory devices.</li>
<li><a class="el" href="journaling_fat.html">Journaling for the FAT File System</a> is an extension to the <a class="el" href="fat_fs.html">FAT File System</a> that helps to keep the file system consistent in an embedded system.</li>
<li>The <a class="el" href="mc_control_layer.html">Memory Card Control Layer</a> is used to control SDxC/MMC/eMMC memory devices.</li>
<li>The <a class="el" href="nand_flash_TL.html">NAND Flash Translation Layer</a> provides means of wear leveling, bad block management, and error correction on <a class="el" href="fs_create_app.html#nand_usage">NAND Flash</a> devices.</li>
</ul>
<h1><a class="anchor" id="fs_usage"></a>
Using the File System</h1>
<p>The File System Component integrates with the Standard C/C++ Library and requires a CMSIS-RTOS2 compliant RTOS. It cannot be used with the Standard C/C++ Library that does not provide the (retarget) hooks for I/O file handling.</p>
<p>The following picture shows the File System's structure from a developer's perspective.</p>
<div class="image">
<img src="fs_structure.png" alt=""/>
<div class="caption">
File System Component Structure</div></div>
<ul>
<li><b>System, File Management</b>: functions that manage the File System and provide operation to format a drive and manage files and directories.</li>
<li><b>Standard File I/O</b>: functions to perform input and output operations on files, such as read, write, and seek.</li>
<li><b>ARM Standard Run-Time Library</b>: is the ARM Compiler standard C library with functions to manage file.</li>
<li><b>FS_Config.c</b>: configuration file for general characteristics of the file system.</li>
<li><b>FS_Config_<em>xxx_n</em>.h</b>: configuration file for the characteristics of each drive or media(MC, NAND, NOR, RAM, or USB memory sticks).</li>
<li><b>File System Core</b>: handles low-level input and output file operations (some are re-targeted to use the ARM Standard Run-Time Library). Depending on configuration settings, it uses the appropriate file system (FAT or EFS) and implements the NAND Flash Translation Layer.</li>
<li><b>IOC - FAT Media API</b>: are I/O Control Interface Routines for the FAT file system to access physical sectors.</li>
<li><b>FAT, EFS Media</b>: the FAT file system supports Memory Cards (MC), NAND Flash, and USB memory sticks, and RAM disks. The Embedded File System (EFS) supports NOR Flash devices.</li>
<li><b>Drivers</b> The File System Core accesses the drives via CMSIS-Drivers that are typically part of the Device Family Pack. Every drive uses dedicated driver.</li>
</ul>
<p>The configuration steps and files that are needed to create applications for the different devices are explained here:</p><ul>
<li><a class="el" href="fs_create_app.html#nor_usage">NOR Flash Drive</a></li>
<li><a class="el" href="fs_create_app.html#ram_usage">RAM Disk Drive</a></li>
<li><a class="el" href="fs_create_app.html#mc_usage">Memory Card Drive</a></li>
<li><a class="el" href="fs_create_app.html#usb_usage">USB Flash Drive</a></li>
<li><a class="el" href="fs_create_app.html#nand_usage">NAND Flash Drive</a></li>
</ul>
<h1><a class="anchor" id="drive"></a>
Drives, Memory Devices and Drivers</h1>
<p>The File System Component supports various memory and storage devices that are assigned to a <b>drive</b>.</p>
<div class="image">
<img src="fs_types.png" alt=""/>
<div class="caption">
File System Component: Media types and Drives</div></div>
<p>All available drives are defined with the <a class="el" href="fs_create_app.html#fs_RTE_Software_Component_Selection">RTE Component Selection</a>. A drive is passed as string to <a class="el" href="group__system__routines.html">System Routines</a> and may be part of a filename. The system allows you to configure a current drive that is used when no drive is specified as part of the filename.</p>
<p>The file system type is automatically chosen depending on the drive type (which correlates to a certain memory device). Some drives may use different interfaces that will be covered by appropriate CMSIS-Drivers. The following table shows the relationship between drive - memory device - and driver/interface:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Drive   </th><th class="markdownTableHeadCenter">File System   </th><th class="markdownTableHeadLeft">Drive Type   </th><th class="markdownTableHeadNone">CMSIS-Driver/Interface    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">"F:" or "F0:"   </td><td class="markdownTableBodyCenter"><a class="el" href="emb_fs.html">EFS</a>   </td><td class="markdownTableBodyLeft">NOR Flash drive 0   </td><td class="markdownTableBodyNone"> <script>link_ext('Flash-API');</script> (Memory Bus or  <script>link_ext('SPI-API');</script>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">"F1:"   </td><td class="markdownTableBodyCenter"><a class="el" href="emb_fs.html">EFS</a>   </td><td class="markdownTableBodyLeft">NOR Flash drive 1   </td><td class="markdownTableBodyNone"> <script>link_ext('Flash-API');</script> (Memory Bus or  <script>link_ext('SPI-API');</script>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">"R:" or "R0:"   </td><td class="markdownTableBodyCenter"><a class="el" href="fat_fs.html">FAT</a>   </td><td class="markdownTableBodyLeft">RAM drive   </td><td class="markdownTableBodyNone">N/A    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">"M:" or "M0:"   </td><td class="markdownTableBodyCenter"><a class="el" href="fat_fs.html">FAT</a>   </td><td class="markdownTableBodyLeft">Memory Card drive 0   </td><td class="markdownTableBodyNone"> <script>link_ext('MCI-API');</script> or  <script>link_ext('SPI-API');</script>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">"M1:"   </td><td class="markdownTableBodyCenter"><a class="el" href="fat_fs.html">FAT</a>   </td><td class="markdownTableBodyLeft">Memory Card drive 1   </td><td class="markdownTableBodyNone"> <script>link_ext('MCI-API');</script> or  <script>link_ext('SPI-API');</script>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">"U:" or "U0:"   </td><td class="markdownTableBodyCenter"><a class="el" href="fat_fs.html">FAT</a>   </td><td class="markdownTableBodyLeft">USB Memory Stick drive 0   </td><td class="markdownTableBodyNone"> <script>link_ext('USB-API');</script>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">"U1:"   </td><td class="markdownTableBodyCenter"><a class="el" href="fat_fs.html">FAT</a>   </td><td class="markdownTableBodyLeft">USB Memory Stick drive 1   </td><td class="markdownTableBodyNone"> <script>link_ext('USB-API');</script>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">"N:" or "N0:"   </td><td class="markdownTableBodyCenter"><a class="el" href="fat_fs.html">FAT</a>   </td><td class="markdownTableBodyLeft">NAND Flash drive 0   </td><td class="markdownTableBodyNone"> <script>link_ext('NAND-API');</script> (Memory Bus)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">"N1:"   </td><td class="markdownTableBodyCenter"><a class="el" href="fat_fs.html">FAT</a>   </td><td class="markdownTableBodyLeft">NAND Flash drive 1   </td><td class="markdownTableBodyNone"> <script>link_ext('NAND-API');</script> (Memory Bus)   </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>NOR Flash is typically connected over Memory Bus or SPI. For using a NOR Flash drive, a Flash driver is required which encapsulates either the Memory Bus interface or SPI (in which case an SPI driver required in addition).</li>
<li>The Middleware Component contains example drivers for Flash devices that can be used to implement other device drivers if required. The examples are: AM29x800BB/<a href="https://media-www.micron.com/-/media/client/global/documents/products/data-sheet/nor-flash/parallel/m29w/m29w640f.pdf" target="_blank">M29W640FB</a> (Flash with 16-bit memory bus interface), <a href="https://www.infineon.com/dgdl/Infineon-S29GL064N_S29GL032N_64_Mbit_32_Mbit_3_V_Page_Mode_MirrorBit_Flash-DataSheet-v03_00-EN.pdf?fileId=8ac78c8c7d0d8da4017d0ed556fd548b" target="_blank">S29GL064Nx2</a> (Flash with 32-bit memory bus interface), and <a href="https://datasheet.octopart.com/AT45DB642D-CNU-Atmel-datasheet-9652374.pdf" target="_blank">AT45DB642D</a> (Flash with SPI interface using an SPI driver).</li>
<li>Other drives (memory card, USB memory device, NAND Flash) require appropriate CMSIS-Driver for the microcontroller device. If no suitable CMSIS-Driver is available for your selected device, you may create the required Flash interface driver. Refer to the  <script>link_ext('CMSIS-Driver-Ref');</script> for details.</li>
<li>Currently, using NAND Flash devices with SPI interface (Serial NAND) <em>is</em> <em>not</em> <em>supported</em>.</li>
</ul>
</dd></dl>
<p><a class="anchor" id="cur_sys_drive"></a></p>
<h2><a class="anchor" id="autotoc_md3"></a>
Current Drive</h2>
<p>The <b>Current Drive</b> defines the drive used when the filename itself does not specify the drive or when functions that expect a drive are called with an empty ("") string.</p>
<p>If there is only one drive enabled in the system then it automatically becomes the "Current Drive". Alternatively, when there are multiple drives enabled, the one with the drive letter that is first in alphabetical order is set as the "Current Drive". The <a class="el" href="fs_operation.html#cur_sys_drive">Current Drive</a> can be changed during run-time using the function <a class="el" href="group__utility__routines.html#ga75a680af8cbd2e2fae87d99d9ab50e11">fchdrive</a>.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Define FS_INITIAL_CDRIVE can be used to define initial current drive at build time.</li>
<li>Set FS_INITIAL_CDRIVE to one of the following values: 0(F0), 1(F1), 2(M0), 3(M1), 4(N0), 5(N1), 6(R0), 9(R1), 7(U0), 8(U1) </li>
</ul>
</dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
