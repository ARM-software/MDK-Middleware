<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MDK-Middleware: Working with Examples</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">MDK-Middleware
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "MDK-Middleware");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">Software Components for MDK-Professional and MDK-Plus</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('working_with_examples.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Working with Examples </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_src_work_with_examples"></a> The MDK-Middleware examples are implemented as <a href="https://github.com/Open-CMSIS-Pack/cmsis-toolbox/blob/main/docs/ReferenceApplications.md">CMSIS-Toolbox Reference Applications</a> that use <a href="https://arm-software.github.io/CMSIS_6/latest/Driver/index.html">CMSIS-Driver</a> interfaces. These Reference Applications are hardware agnostic and need to be extended with a compatible <a href="https://github.com/Open-CMSIS-Pack/cmsis-toolbox/blob/main/docs/ReferenceApplications.md#board-layer">board layer</a> to run on a specific hardware target.</p>
<p>Several <a href="https://www.keil.arm.com/packs/">Board Support Packs (BSP)</a> contain board layers that support the MDK-Middleware components. Refer to the <em>Overview</em> page of the pack to check the <em>Provided connection API Interface</em> of the layers. When such a board layer is not available, it is possible to <a href="https://github.com/Open-CMSIS-Pack/cmsis-toolbox/blob/main/docs/ReferenceApplications.md#structure">create a compatible board layer</a>.</p>
<h1><a class="anchor" id="autotoc_md0"></a>
Available examples</h1>
<p>The examples are provided as part of the MDK-Middleware pack and maintained as part of its GitHub repository, see <a class="el" href="index.html#mw_access">Access to MDK-Middleware</a>.</p>
<p>For detailed list of available examples and their detailed description, see the <b>Examples</b> section in the component documentation.</p>
<ul>
<li><a href="../FileSystem/examples.html"><b>File System examples</b></a></li>
<li><a href="../Network/examples.html"><b>Network examples</b></a></li>
<li><a href="../USB/usbd_examples.html"><b>USB Device examples</b></a></li>
<li><a href="../USB/usbh_examples.html"><b>USB Host examples</b></a></li>
</ul>
<p>This chapter gives a generic overview on how to access, configure and build an MDK-Middleware example project for your target hardware.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Using VS Code</h1>
<p>This section explains how to use MDK-Middleware with the <a href="https://marketplace.visualstudio.com/items?itemName=Arm.cmsis-csolution">Arm CMSIS Solution</a> for VS Code. This extension is for example part of <a href="https://www.keil.arm.com/">Keil Studio</a>.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Explore MDK-Middleware Examples</h2>
<p>An MDK-Middleware reference example can be selected in the <a href="https://developer.arm.com/documentation/108029/latest/Arm-CMSIS-Solution-extension/Create-a-solution">Create a new solution</a> dialog for boards with layers in the BSP.</p>
<div class="image">
<img src="SelectReferenceApplication.png" alt=""/>
<div class="caption">
Select Reference Application</div></div>
    <p>Once the <em>csolution project</em> is loaded the VS Code IDE presents you with a dialog that lets you select a compatible software layer and a compiler toolchain that is available on your computer.</p>
<div class="image">
<img src="ConfigureSolution.png" alt=""/>
<div class="caption">
Configure Solution</div></div>
    <blockquote class="doxtable">
<p>&zwj;<b>Notes:</b></p>
<ul>
<li>The <b>Add Software Layer</b> dialog only appears when the BSP contains a board layer with compatible API Interfaces (see next section).</li>
<li>ST board layers are configured for the Arm Compiler (AC6) using CubeMX. However it is easy to reconfigure for different compilers. The steps are provided in the BSP overview. </li>
</ul>
</blockquote>
<h2><a class="anchor" id="autotoc_md3"></a>
API Interfaces</h2>
<p>The MDK Middleware reference applications are hardware agnostic but require API Interfaces that are expressed using the <em>csolution project</em> <a href="https://github.com/Open-CMSIS-Pack/cmsis-toolbox/blob/main/docs/YML-Input-Format.md#connections">connections:</a> node. The various reference applications consume the following API Interfaces. These <a href="https://github.com/Open-CMSIS-Pack/cmsis-toolbox/blob/main/docs/ReferenceApplications.md#connections">interfaces should be provided by the board layer</a> that is part of the Board Support Pack (BSP).</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Consumed API Interface   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>File System</b>   </td><td class="markdownTableBodyLeft">.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">CMSIS_MCI   </td><td class="markdownTableBodyLeft"><a href="https://arm-software.github.io/CMSIS_6/latest/Driver/group__mci__interface__gr.html">CMSIS-Driver MCI</a> Interface to memory.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">STDIN, STDOUT   </td><td class="markdownTableBodyLeft">Standard I/O for user input/output via UART.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>Network</b>   </td><td class="markdownTableBodyLeft">.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CMSIS_Ethernet   </td><td class="markdownTableBodyLeft"><a href="https://arm-software.github.io/CMSIS_6/latest/Driver/group__eth__interface__gr.html">CMSIS-Driver Ethernet</a> MAC/PHY Interface.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">CMSIS_VIO   </td><td class="markdownTableBodyLeft"><a href="https://arm-software.github.io/CMSIS_6/latest/Driver/group__vio__interface__gr.html">CMSIS-Driver VIO</a> connected to LEDs and button    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">STDOUT   </td><td class="markdownTableBodyLeft">Standard I/O connected for printf messages.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>USB Device</b>   </td><td class="markdownTableBodyLeft">.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CMSIS_USB_Device   </td><td class="markdownTableBodyLeft"><a href="https://arm-software.github.io/CMSIS_6/latest/Driver/group__usbd__interface__gr.html">CMSIS-Driver USB Device</a> Interface.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">CMSIS_VIO   </td><td class="markdownTableBodyLeft"><a href="https://arm-software.github.io/CMSIS_6/latest/Driver/group__vio__interface__gr.html">CMSIS-Driver VIO</a> connected to LEDs and button    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CMSIS_USART   </td><td class="markdownTableBodyLeft"><a href="https://arm-software.github.io/CMSIS_6/latest/Driver/group__usart__interface__gr.html">CMSIS-Driver USART</a> for VirtualCOM project.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>USB Host</b>   </td><td class="markdownTableBodyLeft">.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CMSIS_USB_Host   </td><td class="markdownTableBodyLeft"><a href="https://arm-software.github.io/CMSIS_6/latest/Driver/group__usbh__interface__gr.html">CMSIS-Driver USB Host</a> Interface.   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md4"></a>
Compile for Board</h2>
<p>The MDK-Middleware Reference Applications are typically bundles of several similar projects. Use the command <code>CMSIS:Manage Solution Settings</code> to choose a one project that you want to explore.</p>
<div class="image">
<img src="SelectProject.png" alt=""/>
<div class="caption">
Select Project</div></div>
    <h2><a class="anchor" id="autotoc_md5"></a>
Compile for Custom Hardware</h2>
<p>The steps to add a custom hardware configuration are:</p>
<ul>
<li><p class="startli">Open the <code>*.csolution.yml</code> file and add a new <code>target-type</code>.</p>
<div class="fragment"><div class="line">target-types:</div>
<div class="line">- type: MyHardware</div>
<div class="line">  device: STM32U535CBTx</div>
<div class="line">  variables:</div>
<div class="line">    - Board-Layer: $SolutionDir()$\MyHardware\Board.clayer.yml</div>
</div><!-- fragment --></li>
<li>Add a board layer that implements the API interfaces described above.</li>
</ul>
<blockquote class="doxtable">
<p>&zwj;<b>Note:</b></p>
<ul>
<li>You may copy an existing board layer as starting point. But typically these board layers support a range of reference applications and contain driver API interfaces that may be removed. </li>
</ul>
</blockquote>
<h2><a class="anchor" id="autotoc_md6"></a>
Using uVision for Debug</h2>
<p>The <a href="https://developer.arm.com/documentation/101407/0541/Debugging">uVision Debugger</a> offers advanced debug features such as Event Recorder and Component Viewer to analyze the MDK-Middleware.</p>
<p>To call uVision with the <em>csolution project</em> that you are using in VS Code, add to the file <code>.vscode\tasks.json</code> the following task. The <code>command:</code> is the path to the uVision executable on your computer.</p>
<div class="fragment"><div class="line">&quot;tasks&quot;: [</div>
<div class="line">    {</div>
<div class="line">        &quot;label&quot;: &quot;Start uVision&quot;,</div>
<div class="line">        &quot;type&quot;: &quot;process&quot;,</div>
<div class="line">        &quot;command&quot;: &quot;C:\\Keil_v5\\UV4\\UV4.exe&quot;,</div>
<div class="line">        &quot;args&quot;: [</div>
<div class="line">            &quot;${command:cmsis-csolution.getSolutionPath}&quot;</div>
<div class="line">        ],</div>
<div class="line">        &quot;problemMatcher&quot;: []</div>
<div class="line">    }</div>
<div class="line">]</div>
</div><!-- fragment --><p>Use the VS Code menu command <b>Terminal - Run Task...</b> to Start uVision. uVision can directly load <em>csolution projects</em>. After you have configured the debugger for your target system you may use the <a href="https://developer.arm.com/documentation/101407/0541/Debugging/Debug-Windows-and-Dialogs">Debug Windows and Dialogs</a> to validate your application.</p>
<p>Refer to <a href="https://developer.arm.com/documentation/kan320/latest/">Application Note 320: Using Event Recorder for debugging a network performance issue</a> for an tutorial on how to analyze MDK Middleware issues.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Using uVision IDE</h1>
<p>The <a href="https://www.keil.arm.com/mdk-community/">uVision v5.41</a> IDE or higher allows to directly work with <em>csolution projects</em>. Source code can be modified, build commands can be executed, and after configuration the <a href="https://developer.arm.com/documentation/101407/0541/Debugging">uVision Debugger</a> can be used. Adding files or software components is possible by modifying the <em>csolution project yml files</em>. It is not directly supported with a user interface.</p>
<div class="image">
<img src="Use-uVision.png" alt=""/>
<div class="caption">
Import csolution project in uVision</div></div>
    <h2><a class="anchor" id="autotoc_md8"></a>
Create a native uVision Project</h2>
<p>As uVision IDE is easy-to-use and powerful many developers want to use this IDE for productive software development. Once configured with a compatible board layer, the Reference Applications can be recreated as clean, native uVision project using these steps.</p>
<ol type="1">
<li>Create a new folder and copy the source files of the reference application and the software layer. It it recommended to keep the folder structure. In this new folder create a new uVision project and select the target device.</li>
<li>Add source files and software components listed in the <code>cproject.yml</code> and <code>clayer.yml</code> using the uVision dialogs.</li>
<li>Copy the existing configuration files to the RTE directory of the new uVision project.</li>
<li>Configure tool settings using the uVision options dialogs and add linker script.</li>
</ol>
<p>These steps are described in more detail below.</p>
<p>Once the new project is created, it may be expanded with additional software components or modified to custom hardware as shown in the picture below. Note that uVision projects have no dependency on specify hardware boards.</p>
<div class="image">
<img src="Create-uVision-Project.png" alt=""/>
<div class="caption">
Create new project in uVision</div></div>
    <h3><a class="anchor" id="autotoc_md9"></a>
Create new Project Folder</h3>
<p>Reference Applications contain typically a collection of projects. In a bespoke uVision project, most likely only a subset is required. Choose the example that to want to start from, then create a new folder and copy the source files from the Reference Application. Below this is exemplified on USB Device HID.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft"><em>csolution project</em>   </th><th class="markdownTableHeadLeft">copy to new uVision project folder   </th><th class="markdownTableHeadLeft">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>./HID</code>   </td><td class="markdownTableBodyLeft"><code>&lt;MyFolder&gt;/HID</code>   </td><td class="markdownTableBodyLeft">Only copy content from root.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>./Board/&lt;board&gt;</code>   </td><td class="markdownTableBodyLeft"><code>&lt;MyFolder&gt;/Board/&lt;board&gt;</code>   </td><td class="markdownTableBodyLeft">Only copy source files (<code>*.c</code> and <code>*.h</code>).   </td></tr>
</table>
<p>From the uVision menu use <em>Project - New uVision Project...</em> dialog to select the device that you are using.</p>
<h3><a class="anchor" id="autotoc_md10"></a>
Add Source Files and Components</h3>
<p>The <code>cproject.yml</code> and <code>clayer.yml</code> contains a list of source files and components that should be added to the new uVision project.</p>
<ul>
<li>Add source files: In the uVision Project Window, click on a file group and <em>Add Existing Files to Group</em>. Feel free to add more file groups to structure your project.</li>
<li>Add components: From the uVision menu use <em>Project - Manage - Run Time Environment...</em> and select the components.</li>
</ul>
<blockquote class="doxtable">
<p>&zwj;<b>Note:</b></p>
<ul>
<li>Do not start a generator such as CubeMX as the configuration is copied in the next step. </li>
</ul>
</blockquote>
<h3><a class="anchor" id="autotoc_md11"></a>
Copy Config Files</h3>
<p>The RTE configuration files and generator files (for CubeMX or MCUXpresso Config) are fully compatible with uVision. However the folder structure is different.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft"><em>csolution project</em>   </th><th class="markdownTableHeadLeft">copy to new uVision project folder   </th><th class="markdownTableHeadLeft">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>./HID/RTE</code>   </td><td class="markdownTableBodyLeft"><code>&lt;MyFolder&gt;/RTE</code>   </td><td class="markdownTableBodyLeft">Only copy component folders; exclude folders that start with <code>_</code> .    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>./Board/RTE</code>   </td><td class="markdownTableBodyLeft"><code>&lt;MyFolder&gt;/RTE</code>   </td><td class="markdownTableBodyLeft">Only copy component folders; exclude folders that start with <code>_</code> .    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>./Board/&lt;board&gt;</code>   </td><td class="markdownTableBodyLeft"><code>&lt;MyFolder&gt;/STM32CubeMX/&lt;target&gt;</code>   </td><td class="markdownTableBodyLeft">Rename the <code>*.cgen.yml</code> file.   </td></tr>
</table>
<blockquote class="doxtable">
<p>&zwj;<b>Note:</b></p>
<ul>
<li>The <code>*.cgen.yml</code> file has a different name that is derived from your project name, i.e. <code>&lt;MyProject&gt;.cgen.yml</code>. </li>
</ul>
</blockquote>
<h3><a class="anchor" id="autotoc_md12"></a>
Configure Tool Settings</h3>
<p>The settings of the <em>csolution project</em> are in the <code>*.yml</code> files. Adjust these settings in uVision using the tabs of the <em>Options</em> dialog:</p>
<ul>
<li><em>Target</em>: verify that hardware settings are correctly reflected, i.e. <code>Software Model: TrustZone Off</code>.</li>
<li><em>C/C++ (AC6)</em>: Adjust Language / Code Generation as the default settings of the CMSIS-Toolbox differ.<ul>
<li>Typical settings: Optimization: <code>-O1</code> (for Debug), <code>-O3</code> (for Release), Warnings: <code>AC5-like</code>, Language C: <code>C11</code>.</li>
<li>Defines that are in the <em>csolution project</em> should be reflected. Typically there is a define of <code>CMSIS_target_header</code> in the <code>Board.clayer.yml</code> that also requires an include path.</li>
</ul>
</li>
</ul>
<div class="image">
<img src="Options-C.png" alt=""/>
<div class="caption">
Typical Compiler Options Settings</div></div>
    <ul>
<li><em>Linker</em>: Configure Scatter File and adjust warnings.<ul>
<li>The native uVision project manager does not offer the same <a href="https://github.com/Open-CMSIS-Pack/cmsis-toolbox/blob/main/docs/build-overview.md#linker-script-management">linker script management</a>. Copy therefore the preprocessor output of the CMSIS-Toolbox, typically the file <code>.\tmp\1\ac6_linker_script.sct</code> to <code>&lt;MyFolder&gt;/Board/&lt;board&gt;</code>.</li>
<li>In <code>cdefault.yml</code> there may be some linker controls that should be reflected in this dialog, for example <code>--diag_suppress=L6314W</code>.</li>
</ul>
</li>
</ul>
<div class="image">
<img src="Options-Linker.png" alt=""/>
<div class="caption">
Typical Linker Options Settings</div></div>
     </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
