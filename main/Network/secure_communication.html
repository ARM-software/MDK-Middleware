<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Network Component: Secure Communication</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">Network Component
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "Network Component");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">MDK Middleware for IPv4 and IPv6 Networking</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('secure_communication.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Secure Communication </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_src_secure_communication"></a> In today's world, <b>secure communication</b> is crucial for many applications to protect data transmission between two network nodes. The <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">Transport Layer Security (TLS)</a> protocol is a standardized technology for establishing a secure, encrypted and authenticated link between two parties over an insecure network. TLS is an industry standard and is used in millions of devices and websites.</p>
<p>The Network component offers two ways to secure communication in an application:</p><ol type="1">
<li><a class="el" href="secure_communication.html#use_mbed_tls">Using Mbed TLS</a></li>
<li><a class="el" href="secure_communication.html#use_secure_components">Using Secure Services</a></li>
</ol>
<h1><a class="anchor" id="use_mbed_tls"></a>
Using Mbed TLS</h1>
<p>Although the Network component does not offer encryption and secure communication on its own, you can use Arm's <a href="https://www.trustedfirmware.org/projects/mbed-tls/">mbed TLS</a> software component to achieve this.</p>
<div class="image">
<img src="secure_com_sw_stack.png" alt=""/>
<div class="caption">
Software stack for secure network communication</div></div>
    <p>From the bottom up:</p>
<ul>
<li>The <b>Cortex-M-based microcontroller</b> provides the processor core, storage, memory and network interface.</li>
<li>The <b>CMSIS-RTOS</b> compliant operating system provides standard services such as scheduling and thread-safety.</li>
<li>The <b>Network Component</b> provides services, sockets (TCP/IP) and the interface for network communication.</li>
<li>Building on top of the Network Component, <b>mbed TLS</b> provides an abstraction layer for secure communication.</li>
<li>The <b>application code</b> uses Mbed TLS to abstract the secure communication from itself.</li>
</ul>
<h2><a class="anchor" id="autotoc_md4"></a>
Why Mbed TLS?</h2>
<p>The Mbed TLS library is designed for ease-of-use. The library is documented and has examples so you can easily understand how to use it. In the Network Component, Mbed TLS is used under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>, enabling you to use it in both open source and closed source projects. Mbed TLS is a fully featured and standards compliant SSL library offering server and client functionality in one single package.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Difference between SSL/TLS</h2>
<p>The TLS protocol is the successor of the SSL protocol. Just like its predecessor, the TLS protocol provides communication security for connections over possibly untrusted networks, like the Internet. The main difference between TLS and SSL is the increased standardization of the workings of the protocol. SSL itself was designed and developed by Netscape. The newer TLS standard is defined in a number of <a class="el" href="group__RFC__list.html#mbed_rfcs">public RFCs</a> and is extended periodically to counter possible weaknesses or add much needed functionality.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Parts of an SSL/TLS Library</h2>
<p>In order to perform the SSL or TLS protocol, a number of supporting functionality is required. The SSL/TLS library:</p>
<ul>
<li>needs to perform symmetric cryptographic operations, such as <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a>, to encrypt the data over the connection.</li>
<li>uses asymmetric cryptographic operations, such as <a href="https://en.wikipedia.org/wiki/RSA_%28cryptosystem%29">RSA</a>, for identifying and authenticating the parties of the connection.</li>
<li>uses message digest operations, such as the <a href="https://en.wikipedia.org/wiki/SHA-2">SHA-256</a> hash algorithm, to protect the integrity of the information sent over the wire.</li>
<li>needs to be able to parse, understand and use <a href="https://en.wikipedia.org/wiki/X.509">X.509</a> certificates.</li>
<li>has to perform network operations to send and receive the protocol packets.</li>
</ul>
<p>All of this is hidden from most users and wrapped inside an SSL library, such as Mbed TLS, which developers can use to implement SSL or TLS in their applications.</p>
<p>For more information on Mbed TLS and how it works, visit the <a href="https://www.trustedfirmware.org/projects/mbed-tls/">high-level design</a> overview page.</p>
<h2><a class="anchor" id="add_mbedtls"></a>
Add the mbed TLS library to a project</h2>
<p>The <a class="el" href="examples.html">Examples</a> section carries two examples for secure communication over the IP network: SSL Server and SSL Client. To use the Mbed TLS library in your own projects, follow these steps:</p>
<ol type="1">
<li>Download the <b>ARM:mbedTLS</b> library from  <script>link_ext('SW-Pack');</script> or use  <script>link_ext('uv4_ca_packinstaller');</script></li>
<li>Open or create a project using the <b>Network Component</b>.</li>
<li>Configure the Network Component as required by your application (Ethernet settings, TCP/IP communication, etc.).</li>
<li>In the <b>Manage Run-Time Environment</b> window expand <b>Security</b> and enable <b>mbed TLS</b>: <img src="add_mbedTLS.png" alt="" class="inline" title="Add mbed TLS"/>    </li>
<li>Configure Mbed TLS using the <code>mbedTLS_config.h</code> file.</li>
<li>Use the <b>mbed TLS</b> API to secure your communication.</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>You can use the Mbed TLS API in parallel to any of the <a class="el" href="secure_communication.html#use_secure_components">secure services</a> that are part of the Network Component.</dd></dl>
<h1><a class="anchor" id="use_secure_components"></a>
Using Secure Services</h1>
<p>The Network Component offers secure software components that are using <a class="el" href="secure_communication.html#use_mbed_tls">Mbed TLS</a>. The user of the Network Component does not see the Mbed TLS API as it is hidden by the standard API of the secure component.</p>
<p>The following components are currently available in a secure variant:</p>
<ul>
<li><a class="el" href="secure_communication.html#https_server">HTTPS Server</a></li>
<li><a class="el" href="secure_communication.html#smtps_client">SMTPS Client</a></li>
</ul>
<p>To be able to communicate securely, you will need to generate appropriate certificates for the server. The section <a class="el" href="secure_communication.html#cert_creation">Creating your own certificates and keys</a> explains how to achieve this for the secure components by using additional tools that are part of the Network Component.</p>
<h2><a class="anchor" id="https_server"></a>
HTTPS Server</h2>
<p>The web server and the compact web server have secure variants available. The example <a class="el" href="HTTPS_Server_Example.html">HTTPS Server</a> implements the secure Web server.</p>
<blockquote class="doxtable">
<p>&zwj;<b>Note</b></p>
<ul>
<li>The first connection might take a while (a few seconds up to 10s) and depends on the browser and how many sockets/sessions it initially opens (differs in Edge, Chrome, Firefox, etc.). This delay is normal and due to the time required for asymmetric cryptography calculations on the target. After the initial delay, the HTTPS server works almost as fast the HTTP server.</li>
<li>Your browser will complain during the connection that the certificate has a problem or is not trusted. You will need to add the certificate to your browser's trusted certificate storage manually.</li>
<li>Do not use the test certificate in productive environments as it is not secret. Before shipping your product, make sure that you have added your <a class="el" href="secure_communication.html#cert_creation">own certificates and keys</a>. </li>
</ul>
</blockquote>
<h3><a class="anchor" id="cert_creation"></a>
Creating your own certificates and keys</h3>
<p>The Network Component's HTTPS service adds the file <code>Net_Security.c</code> to the project. This file contains generic test keys/certificates which enable the application to run out of the box. If you want to adapt the keys/certificates to your needs, you need utilities <code>gen_key</code> and <code>cert_write</code> which are available as part of the <a href="https://www.keil.arm.com/artifacts/#tools/arm/mdk-toolbox">Arm MDK-toolbox</a>.</p>
<p>The certificates and keys are generated using bash shell commands:</p>
<ul>
<li><p class="startli">Generate random CA and Server Private Keys</p>
<div class="fragment"><div class="line">gen_key \</div>
<div class="line">  type=rsa \</div>
<div class="line">  rsa_keysize=2048 \</div>
<div class="line">  format=pem \</div>
<div class="line">  filename=ca.key</div>
</div><!-- fragment --><div class="fragment"><div class="line">gen_key \</div>
<div class="line">  type=rsa \</div>
<div class="line">  rsa_keysize=2048 \</div>
<div class="line">  format=pem \</div>
<div class="line">  filename=server.key</div>
</div><!-- fragment --></li>
<li><p class="startli">Generate Self-signed CA Certificate</p>
<div class="fragment"><div class="line">cert_write \</div>
<div class="line">  selfsign=1 \</div>
<div class="line">  issuer_key=ca.key \</div>
<div class="line">  issuer_name=&quot;CN=Test CA,O=MyOrganization,C=US&quot; \</div>
<div class="line">  not_before=20200101000000 \</div>
<div class="line">  not_after=20301231235959 \</div>
<div class="line">  is_ca=1 \</div>
<div class="line">  output_file=ca.crt \</div>
<div class="line">  san=&quot;DNS:my_host&quot;</div>
</div><!-- fragment --></li>
<li><p class="startli">Generate Server Certificate</p>
<div class="fragment"><div class="line">cert_write \</div>
<div class="line">  subject_key=server.key \</div>
<div class="line">  subject_name=&quot;CN=my_host,O=MyOrganization,C=US&quot; \</div>
<div class="line">  issuer_key=ca.key \</div>
<div class="line">  issuer_crt=ca.crt \</div>
<div class="line">  serial=2 \</div>
<div class="line">  not_before=20200101000000 \</div>
<div class="line">  not_after=20301231235959 \</div>
<div class="line">  output_file=server.crt \</div>
<div class="line">  san=&quot;DNS:my_host&quot; </div>
</div><!-- fragment --></li>
</ul>
<p>The certificates and crypto keys are created and their contents must be copied to the file <code>Net_Security.c</code>:</p>
<ul>
<li><code>ca.crt</code> into the array <em>NetSecurity_ServerCA[]</em>, with a leading <code>"&lt;/tt&gt; and a trailing &lt;tt&gt;\\n"</code> inserted for each line.</li>
<li><code>server.crt</code> into the array <em>NetSecurity_ServerCert[]</em>, with a leading <code>"&lt;/tt&gt; and a trailing &lt;tt&gt;\\n"</code> inserted for each line.</li>
<li><code>server.key</code> into the array <em>NetSecurity_ServerKey[]</em>, with a leading <code>"&lt;/tt&gt; and a trailing &lt;tt&gt;\\n"</code> inserted for each line.</li>
</ul>
<p><b>Code Example</b></p>
<p><em>ca.crt</em></p>
<div class="fragment"><div class="line">-----BEGIN CERTIFICATE-----</div>
<div class="line">MIIDUjCCAjqgAwIBAgIBATANBgkqhkiG9w0BAQsFADA4MRAwDgYDVQQDDAdUZXN0</div>
<div class="line">IENBMRcwFQYDVQQKDA5NeU9yZ2FuaXphdGlvbjELMAkGA1UEBhMCVVMwHhcNMjAw</div>
<div class="line"> ...</div>
<div class="line">r3bk5HaVy8YUXog0H8mHTIp7x+i1Tq8QavMa/2bF3SOcNhvvEecG59zG9IfULqNv</div>
<div class="line">fdCx0rfQujoMEHnwZjwEzBq5NdpPZi7heMYJKXlqHbHo+0itw9w=</div>
<div class="line">-----END CERTIFICATE-----</div>
</div><!-- fragment --><p><em>Net_Security.c</em></p>
<div class="fragment"><div class="line"><span class="keyword">const</span> uint8_t NetSecurity_ServerCA[] =</div>
<div class="line"><span class="stringliteral">&quot;-----BEGIN CERTIFICATE-----\n&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;MIIDUjCCAjqgAwIBAgIBATANBgkqhkiG9w0BAQsFADA4MRAwDgYDVQQDDAdUZXN0\n&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;IENBMRcwFQYDVQQKDA5NeU9yZ2FuaXphdGlvbjELMAkGA1UEBhMCVVMwHhcNMjAw\n&quot;</span></div>
<div class="line"> ...</div>
<div class="line"><span class="stringliteral">&quot;r3bk5HaVy8YUXog0H8mHTIp7x+i1Tq8QavMa/2bF3SOcNhvvEecG59zG9IfULqNv\n&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;fdCx0rfQujoMEHnwZjwEzBq5NdpPZi7heMYJKXlqHbHo+0itw9w=\n&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;-----END CERTIFICATE-----\n&quot;</span></div>
</div><!-- fragment --><blockquote class="doxtable">
<p>&zwj;<b>Note for Windows users</b></p>
<ul>
<li>You must add the test CA certificate <code>ca.crt</code> to the Trusted Root Certificate store on your computer to avoid the <em>Your connection is not private</em> error in the Chrome or Microsoft Edge browser.</li>
<li>You need administrator rights for adding a certificate.</li>
<li>To install a <code>ca.crt</code> certificate on your computer, double-click on it and select <b>Install Certificate...</b>, then select <b>Local Machine</b> for the store location.</li>
<li>Select <b>Trusted Root Certification Authorities</b> as the location for the certificate. </li>
</ul>
</blockquote>
<h2><a class="anchor" id="smtps_client"></a>
SMTPS Client</h2>
<p>The e-mail client is available in a secure variant. The <a class="el" href="SMTPS_Client_Example.html">SMTPS Client</a> example implements the secure email client.</p>
<h3><a class="anchor" id="cert_adding"></a>
Adding server root CA certificate</h3>
<p>The SMTPS service of the Network Component adds the <code>Net_Security.c</code> file to the project. This file contains an empty section for the e-mail server root CA certificate, so you cannot initially build the application. You must provide a valid root CA certificate for the server that you use to send e-mail. The certificate must be provided in PEM-encoding. Copy the contents of the certificate into the NetSecurity_EmailServerCA structure in <code>Net_Security.c</code> and add a leading " and a trailing \n" to each line.</p>
<div class="fragment"><div class="line"><span class="comment">// Email Server root CA certificate</span></div>
<div class="line"><span class="keyword">const</span> uint8_t NetSecurity_EmailServerCA[] =</div>
<div class="line"><span class="stringliteral">&quot;-----BEGIN CERTIFICATE-----\n&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;... base64 data ...\n&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;-----END CERTIFICATE-----\n&quot;</span>;</div>
</div><!-- fragment --><p>Verifying the e-mail server is required by default to increase e-mail security. If you do not want to verify the server, you can disable server verification by defining the <b>SMTPS_SERVER_VERIFY_NONE</b> in your project (C/C++ define).</p>
<blockquote class="doxtable">
<p>&zwj;<b>Note</b> It is not necessary to create your own certificates or keys to send secure e-mail using SMTPS. </p>
</blockquote>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
