<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Network Component: AJAX Programming</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">Network Component
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "Network Component");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">MDK Middleware for IPv4 and IPv6 Networking</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__ws__ajax.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">AJAX Programming<div class="ingroups"><a class="el" href="group__netServices.html">Services</a> &raquo; <a class="el" href="group__netHTTP__Func.html">HTTP Server</a> &raquo; <a class="el" href="group__ws__web__technologies.html">Dynamic Web Content</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Using Asynchronous JavaScript and XML.  
</p>
<p>Using Asynchronous JavaScript and XML. </p>
<p><a href="https://en.wikipedia.org/wiki/Ajax_(programming)" target="_blank">Asynchronous JavaScript and XML (AJAX)</a> is a group of web development techniques used on the client-side to create interactive web applications. With AJAX, web applications can retrieve data from the server asynchronously in the background without interfering with the display and behavior of the existing page. AJAX is based on <a href="https://en.wikipedia.org/wiki/JavaScript" target="_blank">JavaScript</a> and <b>HTTP requests</b>. JavaScript is the most popular language for AJAX programming as it is widely supported in web browsers.</p>
<p>The <a href="https://en.wikipedia.org/wiki/XML" target="_blank">eXtensible Markup Language (XML)</a> is a simple and very flexible text format. It is a generic framework for storing any amount of any data whose structure can be represented as a <b>tree</b>. It allows the user to create the mark-up elements. XML has become the almost universally supported way of exchanging documents and data across applications and platforms. The benefits of using XML technology for web page update are obvious:</p><ul>
<li>Instead of several files, only <b>one small</b> XML file is transferred for web page update.</li>
<li>This allows <b>faster</b>, <b>flicker-free</b> screen updates.</li>
<li>The used LAN bandwidth is very small.</li>
<li>The web server can easily handle <b>more clients</b> at the same time.</li>
</ul>
<p>The components of XML file are <b>tagged</b>. You must use this format for generated XML responses. The object ID's and their values must be specified within XML body - enclosed with tags <b>&lt;form&gt;</b> and <b>&lt;/form&gt;</b>. The following objects are already defined:</p><ul>
<li><b>Text</b> object: <div class="fragment"><div class="line">&lt;text&gt;</div>
<div class="line">  &lt;<span class="keywordtype">id</span>&gt;text_id&lt;/<span class="keywordtype">id</span>&gt;</div>
<div class="line">  &lt;value&gt;text_value&lt;/value&gt;</div>
<div class="line">&lt;/text&gt;</div>
</div><!-- fragment --></li>
<li><b>Checkbox</b> object: <div class="fragment"><div class="line">&lt;checkbox&gt;</div>
<div class="line">  &lt;<span class="keywordtype">id</span>&gt;checkbox_id&lt;/<span class="keywordtype">id</span>&gt;</div>
<div class="line">  &lt;checked&gt;<span class="keyword">true</span>/<span class="keyword">false</span>&lt;/checked&gt;</div>
<div class="line">&lt;/checkbox&gt;</div>
</div><!-- fragment --></li>
<li><b>Select</b> object: <div class="fragment"><div class="line">&lt;<a class="code hl_function" href="group__using__network__sockets__bsd__func.html#ga2b756e98541d55081c99a70ef8f5ad43" title="Check the status of one or more sockets. [thread-safe].">select</a>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">id</span>&gt;option_id&lt;/<span class="keywordtype">id</span>&gt;</div>
<div class="line">  &lt;value&gt;<span class="keyword">true</span>/<span class="keyword">false</span>&lt;/value&gt;</div>
<div class="line">&lt;/<a class="code hl_function" href="group__using__network__sockets__bsd__func.html#ga2b756e98541d55081c99a70ef8f5ad43" title="Check the status of one or more sockets. [thread-safe].">select</a>&gt;</div>
</div><!-- fragment --></li>
<li><b>Radio</b> object: <div class="fragment"><div class="line">&lt;radio&gt;</div>
<div class="line">  &lt;<span class="keywordtype">id</span>&gt;radio_id&lt;/<span class="keywordtype">id</span>&gt;</div>
<div class="line">  &lt;value&gt;<span class="keyword">true</span>/<span class="keyword">false</span>&lt;/value&gt;</div>
<div class="line">&lt;/radio&gt;</div>
</div><!-- fragment --></li>
</ul>
<p>Other objects are optional. You can add them yourself.</p>
<h2><a class="anchor" id="autotoc_md57"></a>
How it works</h2>
<p>The browser sends a standard HTTP request to the HTTP server, such as <b>GET</b> or <b>POST</b>. The web server checks the file extension of the requested file. If the file extension is <b>cgx</b>, the requested file is an XML script file. This file is then processed by the internal script interpreter running on the HTTP server. As a result, an XML response is generated and sent back to the browser.</p>
<h2><a class="anchor" id="autotoc_md58"></a>
Application Example</h2>
<dl class="section note"><dt>Note</dt><dd><br  />
 The examples used in this section are based on the <a class="el" href="nw_examples.html#Compact_Web_Server_Example">HTTP Server</a> example. All file names mentioned in the sections can be found in this example.</dd></dl>
<p>Here is a an example of a typical data flow. It assumes that you have clicked on the link to the <b>AD</b> page. This calls the file <b>ad.cgi</b>: </p><div class="fragment"><div class="line">t &lt;html&gt;&lt;head&gt;&lt;title&gt;AD Input&lt;/title&gt;</div>
<div class="line">t &lt;script language=JavaScript type=<span class="stringliteral">&quot;text/javascript&quot;</span> src=<span class="stringliteral">&quot;xml_http.js&quot;</span>&gt;&lt;/script&gt;</div>
<div class="line">t &lt;script language=JavaScript type=<span class="stringliteral">&quot;text/javascript&quot;</span>&gt;</div>
<div class="line"><span class="preprocessor"># Define URL and refresh timeout</span></div>
<div class="line">t var formUpdate = <span class="keyword">new</span> periodicObj(<span class="stringliteral">&quot;ad.cgx&quot;</span>, 500);</div>
<div class="line">t function plotADGraph() {</div>
<div class="line">t  adVal = document.getElementById(<span class="stringliteral">&quot;ad_value&quot;</span>).value;</div>
<div class="line">t  numVal = parseInt(adVal, 16);</div>
<div class="line">t  voltsVal = (3.3*numVal)/4096;</div>
<div class="line">t  tableSize = (numVal*100/4096);</div>
<div class="line">t  document.getElementById(<span class="stringliteral">&quot;ad_table&quot;</span>).style.width = (tableSize + <span class="charliteral">&#39;%&#39;</span>);</div>
<div class="line">t  document.getElementById(<span class="stringliteral">&quot;ad_volts&quot;</span>).value = (voltsVal.toFixed(3) + <span class="stringliteral">&#39; V&#39;</span>);</div>
<div class="line">t }</div>
<div class="line">t function periodicUpdateAd() {</div>
<div class="line">t  <span class="keywordflow">if</span>(document.getElementById(<span class="stringliteral">&quot;adChkBox&quot;</span>).checked == <span class="keyword">true</span>) {</div>
<div class="line">t   updateMultiple(formUpdate,plotADGraph);</div>
<div class="line">t   ad_elTime = setTimeout(periodicUpdateAd, formUpdate.period);</div>
<div class="line">t  }</div>
<div class="line">t  <span class="keywordflow">else</span></div>
<div class="line">t   clearTimeout(ad_elTime);</div>
<div class="line">t }</div>
<div class="line">t &lt;/script&gt;&lt;/head&gt;</div>
<div class="line">i pg_header.inc</div>
<div class="line">t &lt;h2 align=<span class="stringliteral">&quot;center&quot;</span>&gt;&lt;br&gt;AD Converter Input&lt;/h2&gt;</div>
<div class="line">t &lt;p&gt;&lt;font size=<span class="stringliteral">&quot;2&quot;</span>&gt;This page allows you to monitor AD input value in numeric</div>
<div class="line">t  and graphics form. Periodic screen update is based on &lt;b&gt;xml&lt;/b&gt; technology.</div>
<div class="line">t  This results in smooth flicker-free screen update.&lt;br&gt;&lt;br&gt;</div>
<div class="line">t  Turn potentiometer on an evaluation board clockwise or counterclockwise</div>
<div class="line">t  and observe the change of AD value on the screen.&lt;/font&gt;&lt;/p&gt;</div>
<div class="line">t &lt;form action=<span class="stringliteral">&quot;ad.cgi&quot;</span> method=<span class="stringliteral">&quot;post&quot;</span> name=<span class="stringliteral">&quot;ad&quot;</span>&gt;</div>
<div class="line">t &lt;input type=<span class="stringliteral">&quot;hidden&quot;</span> value=<span class="stringliteral">&quot;ad&quot;</span> name=<span class="stringliteral">&quot;pg&quot;</span>&gt;</div>
<div class="line">t &lt;table border=0 width=99%&gt;&lt;font size=<span class="stringliteral">&quot;3&quot;</span>&gt;</div>
<div class="line">t &lt;tr style=<span class="stringliteral">&quot;background-color: #aaccff&quot;</span>&gt;</div>
<div class="line">t  &lt;th width=15%&gt;Item&lt;/th&gt;</div>
<div class="line">t  &lt;th width=15%&gt;Value&lt;/th&gt;</div>
<div class="line">t  &lt;th width=15%&gt;Volts&lt;/th&gt;</div>
<div class="line">t  &lt;th width=55%&gt;Bargraph&lt;/th&gt;&lt;/tr&gt;</div>
<div class="line">t &lt;tr&gt;&lt;td&gt;&lt;img src=<span class="stringliteral">&quot;pabb.gif&quot;</span>&gt;POT1:&lt;/td&gt;</div>
<div class="line">t   &lt;td align=<span class="stringliteral">&quot;center&quot;</span>&gt;</div>
<div class="line">t &lt;input type=<span class="stringliteral">&quot;text&quot;</span> readonly style=<span class="stringliteral">&quot;background-color: transparent; border: 0px&quot;</span></div>
<div class="line">c g 1  size=<span class="stringliteral">&quot;10&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;ad_value&quot;</span> value=<span class="stringliteral">&quot;0x%03X&quot;</span>&gt;&lt;/td&gt;</div>
<div class="line">t &lt;td align=<span class="stringliteral">&quot;center&quot;</span>&gt;&lt;input type=<span class="stringliteral">&quot;text&quot;</span> readonly style=<span class="stringliteral">&quot;background-color: transparent; border: 0px&quot;</span></div>
<div class="line">c g 2  size=<span class="stringliteral">&quot;10&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;ad_volts&quot;</span> value=<span class="stringliteral">&quot;%5.3f V&quot;</span>&gt;&lt;/td&gt;</div>
<div class="line">t &lt;td height=50&gt;&lt;table bgcolor=<span class="stringliteral">&quot;#FFFFFF&quot;</span> border=<span class="stringliteral">&quot;2&quot;</span> cellpadding=<span class="stringliteral">&quot;0&quot;</span> cellspacing=<span class="stringliteral">&quot;0&quot;</span> width=<span class="stringliteral">&quot;100%&quot;</span>&gt;&lt;tr&gt;</div>
<div class="line">c g 3 &lt;td&gt;&lt;table <span class="keywordtype">id</span>=<span class="stringliteral">&quot;ad_table&quot;</span> style=<span class="stringliteral">&quot;width: %d%%&quot;</span> border=<span class="stringliteral">&quot;0&quot;</span> cellpadding=<span class="stringliteral">&quot;0&quot;</span> cellspacing=<span class="stringliteral">&quot;0&quot;</span>&gt;</div>
<div class="line">t &lt;tr&gt;&lt;td bgcolor=<span class="stringliteral">&quot;#0000FF&quot;</span>&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;</div>
<div class="line">t &lt;/font&gt;&lt;/table&gt;</div>
<div class="line">t &lt;p align=center&gt;</div>
<div class="line">t &lt;input type=button value=<span class="stringliteral">&quot;Refresh&quot;</span> onclick=<span class="stringliteral">&quot;updateMultiple(formUpdate,plotADGraph)&quot;</span>&gt;</div>
<div class="line">t Periodic:&lt;input type=<span class="stringliteral">&quot;checkbox&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;adChkBox&quot;</span> onclick=<span class="stringliteral">&quot;periodicUpdateAd()&quot;</span>&gt;</div>
<div class="line">t &lt;/p&gt;&lt;/form&gt;</div>
<div class="line">i pg_footer.inc</div>
<div class="line">. End of script must be closed with period</div>
</div><!-- fragment --><p>which will then make the browser to send a standard HTTP GET request: </p><div class="fragment"><div class="line">GET /ad.cgx HTTP/1.1\r\n</div>
</div><!-- fragment --><p>The HTTP server processes the script <b>ad.cgx</b> file: </p><div class="fragment"><div class="line">t &lt;form&gt;</div>
<div class="line">t &lt;text&gt;</div>
<div class="line">t &lt;id&gt;ad_value&lt;/<span class="keywordtype">id</span>&gt;</div>
<div class="line">c x&lt;value&gt;0x%03X&lt;/value&gt;</div>
<div class="line">t &lt;/text&gt;</div>
<div class="line">t &lt;/form&gt;</div>
<div class="line">.</div>
</div><!-- fragment --><p>The <code>c</code> in the fourth line tells the HTTP server to call <a class="el" href="group__ws__cgi__script.html#ga5203e3a1a0f95a8b76fb83bec73e4be8">netCGI_Script</a>. The rest of the line will be passed as a parameter to this function. The function will check the meaning of <em>x:</em> </p><div class="fragment"><div class="line"><span class="keywordflow">switch</span> (env[0]) {</div>
<div class="line">...</div>
<div class="line">  <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:</div>
<div class="line">    <span class="comment">// AD Input from &#39;ad.cgx&#39;</span></div>
<div class="line">    adv = AD_in (0);</div>
<div class="line">    len = sprintf (buf, &amp;env[1], adv);</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
</div><!-- fragment --><p>This will lead to this (exemplary) XML response: </p><div class="fragment"><div class="line">&lt;form&gt;&lt;text&gt;&lt;<span class="keywordtype">id</span>&gt;ad_value&lt;/<span class="keywordtype">id</span>&gt;&lt;value&gt;0x06A&lt;/value&gt;&lt;/text&gt;&lt;/form&gt;</div>
</div><!-- fragment --><p>The JavaScript function <b>periodicUpdateAd()</b> activates the periodic time-outs for the page update. This function is specific for the AD page module and is included in the <b>ad.cgi</b> script file: </p><div class="fragment"><div class="line">function periodicUpdateAd() {</div>
<div class="line">  <span class="keywordflow">if</span>(document.getElementById(<span class="stringliteral">&quot;adChkBox&quot;</span>).checked == <span class="keyword">true</span>) {</div>
<div class="line">    updateMultiple(formUpdate,plotADGraph);</div>
<div class="line">    ad_elTime = setTimeout(periodicUpdateAd, formUpdate.period);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    clearTimeout(ad_elTime);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The update <b>interval</b> and <b>URL</b> are defined in the <b>formUpdate</b> object. When update interval expires, an XML response is requested from the URL specified in this JavaScript object. </p><div class="fragment"><div class="line">var formUpdate = <span class="keyword">new</span> periodicObj(<span class="stringliteral">&quot;ad.cgx&quot;</span>, 500);</div>
</div><!-- fragment --><p>The actual update of the analog bar and AD values on the web page is done by the JavaScript function <b>plotADGraph()</b>: </p><div class="fragment"><div class="line">function plotADGraph() {</div>
<div class="line">  adVal = document.getElementById(<span class="stringliteral">&quot;ad_value&quot;</span>).value;</div>
<div class="line">  numVal = parseInt(adVal, 16);</div>
<div class="line">  voltsVal = (3.3*numVal)/1024;</div>
<div class="line">  tableSize = (numVal*100/1024);</div>
<div class="line">  document.getElementById(<span class="stringliteral">&quot;ad_table&quot;</span>).style.width = (tableSize + <span class="charliteral">&#39;%&#39;</span>);</div>
<div class="line">  document.getElementById(<span class="stringliteral">&quot;ad_volts&quot;</span>).value = (voltsVal.toFixed(3) + <span class="stringliteral">&#39; V&#39;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p> This function is called as a callback function from the <b>updateMultiple()</b> JavaScript function.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The XML script files need to use the reserved filename extension <b>cgx</b>, for the HTTP server's script interpreter to recognize and process the files accordingly.</li>
<li>There must be <b>no spaces</b> or CR-LF characters between XML tags, or some web browsers might have problems when parsing the XML response.</li>
<li>The script line length is <b>limited to 120 characters</b>.</li>
</ul>
</dd></dl>
<p>This is how the generated web page looks like, with the dynamically generated items in the <b>Values</b> and <b>Volts</b> column:</p>
<div class="image">
<img src="xml_example_page.png" alt=""/>
</div>
 </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
