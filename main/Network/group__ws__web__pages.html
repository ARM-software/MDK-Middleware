<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Network Component: Delivering Web Pages</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">Network Component
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "Network Component");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">MDK Middleware for IPv4 and IPv6 Networking</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__ws__web__pages.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Delivering Web Pages<div class="ingroups"><a class="el" href="group__netServices.html">Services</a> &raquo; <a class="el" href="group__netHTTP__Func.html">HTTP Server</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>How web pages are stored on and delivered by the HTTP Server.  
</p>
<p>How web pages are stored on and delivered by the HTTP Server. </p>
<h1><a class="anchor" id="autotoc_md62"></a>
Creating and storing static web pages</h1>
<p>Static web pages for the HTTP server are created in the same way as web pages for any other web server. You can use any text editor to edit the HTML code. Here are a few guidelines:</p><ul>
<li>Design web pages in HTML code. You can add <b>images</b> and <a class="el" href="group__ws__ajax.html">JavaScript</a> functions as well.</li>
<li>If a web page needs to show dynamic values, code it using the <a class="el" href="group__ws__script__langugage.html">scripting language</a>. You must also update the CGI callback function, <a class="el" href="group__ws__cgi__script.html#ga5203e3a1a0f95a8b76fb83bec73e4be8">netCGI_Script</a>, accordingly. It is a good practice to program the script code and <a class="el" href="group__ws__cgi__script.html#ga5203e3a1a0f95a8b76fb83bec73e4be8">netCGI_Script</a> in parallel. Note that the module <b>HTTP_Server_CGI.c</b> must be included in your project.</li>
<li>Images on a web page can be of type GIF, BMP, JPEG, or PNG for example. A good choice is to select the image type with the best compression because these files are included in the code. Large image files might increase the application code size above average.</li>
<li>To keep track of the web content, be advised to create a sub-folder in the project called <b>Web</b> (for example). Add all files that the web server will deliver (HTML, images, etc.) as file type "Image File":</li>
</ul>
<div class="image">
<img src="image_file.png" alt=""/>
<div class="caption">
Add web content as Image File</div></div>
<ul>
<li>Compile all web files using the <a class="el" href="group__nw__sw__util__fcarm.html">FCARM File Converter</a> tool. To setup FCARM, go to <b>Project</b> -&gt; <b>Options</b> <b>for</b> <b>Target</b> and select the <b>Utilities</b> tab. At the bottom, you can configure how FCARM compiles the image files. Here's an example:</li>
</ul>
<div class="image">
<img src="fcarm_configuration.png" alt=""/>
<div class="caption">
Configure Image File Processing (FCARM) Dialog</div></div>
<h1><a class="anchor" id="autotoc_md63"></a>
Default Page</h1>
<p>When you type the HTTP Server's URL or IP address in the browser's address bar, the HTTP Server sends the content of the <b>index.htm</b> web page. This <b>default</b> <b>page</b> is opened, as long as no other filename is specified in the URL. If you enter a URL, including a filename (for example <a href="http://mcb1700/ad.htm">http://mcb1700/ad.htm</a>), the HTTP Server tries to open this page.</p>
<p>The default page <b>index.htm</b> is a static page. This means the content of this page is stored on the HTTP Server and sent unmodified to the web client on request. Usually, this page contains links to other static or <a class="el" href="group__ws__web__technologies.html">dynamic pages</a> on the server.</p>
<p>If required, you can have a dynamic page as the default web page. When a browser requests the default page, the HTTP Server tries to open <b>index.htm</b> as default web page. If this page does not exist, web server tries to open <b>index.cgi</b> instead. If this page is also not present, the web server responds with an <a class="el" href="group__ws__web__pages.html#ws_error_pages">Error 404 - Not Found</a>.</p>
<p>The process of finding the default dynamic page stored on the SD card is more complex. The HTTP Server first tries to open <b>index.htm</b> on the SD card. If this page does not exist, the web server tries to open <b>index.htm</b> stored in ROM (Web.c). If this page does not exist, the web server tries to open the <b>index.cgi</b> that is stored on the SD card. Finally, if this also fails, the web server tries to open the <b>index.cgi</b> stored in ROM. Because the default Web.c is in the Network library, it is used if you do not provide your own. The web server then falsely sends this page instead of <b>index.cgi</b>, which is stored on the SD card.</p>
<div class="image">
<img src="http_default_page.png" alt=""/>
<div class="caption">
Default Page (index.htm) from the Network library</div></div>
<p>To use the dynamic default page stored on the SD card, there must be <b>Web.c</b> in your project. It must contain an empty web page stored in a ROM. If you do not do this, the default Web.c from the network library will be used.</p>
<dl class="section note"><dt>Note</dt><dd>If you want to use a dynamic default page, then the file index.htm <b>must not exist</b> on the HTTP server.</dd></dl>
<p><a class="anchor" id="ws_error_pages"></a></p>
<h1><a class="anchor" id="autotoc_md64"></a>
Error Pages</h1>
<p>The HTTP server shows an error page when encountering error conditions. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Error Code   </th><th class="markdownTableHeadNone">Title   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">401   </td><td class="markdownTableBodyNone">Unauthorized Access   </td><td class="markdownTableBodyNone">You are not authorized to access this server    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">403   </td><td class="markdownTableBodyNone">Forbidden   </td><td class="markdownTableBodyNone">You don't have permission to access this resource    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">404   </td><td class="markdownTableBodyNone">Not Found   </td><td class="markdownTableBodyNone">The requested URL was not found on this server    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">501   </td><td class="markdownTableBodyNone">Not Implemented   </td><td class="markdownTableBodyNone">The requested method is not supported   </td></tr>
</table>
<p>These error pages are already included in the Network Component. If you want to modify them, you must copy the user code template <b>HTTP_Server_Error.c</b> to your project and customize it. To add it to your project, simply right-click on the Source group, select <b>Add New Item to Group</b>, then click on <b>User Code Template</b> and scroll in the template files list until you find the <b>HTTP Server Error Messages</b> template. Modified error pages must be small because they are sent in a single TCP packet.</p>
<p><b>Code Example</b> </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>net_http_error {</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *header;                   <span class="comment">///&lt; Common page header</span></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *footer;                   <span class="comment">///&lt; Common page footer</span></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *e401;                     <span class="comment">///&lt; 401 Unauthorized</span></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *e403;                     <span class="comment">///&lt; 403 Forbidden</span></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *e404;                     <span class="comment">///&lt; 404 Not Found</span></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *e501;                     <span class="comment">///&lt; 501 Not Implemented</span></div>
<div class="line">} <span class="keyword">const</span> NET_HTTP_ERROR;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Keep HTTP Error page size small</span></div>
<div class="line"><span class="keyword">extern</span> NET_HTTP_ERROR net_http_error;</div>
<div class="line">       NET_HTTP_ERROR net_http_error = {</div>
<div class="line">  <span class="comment">// HTTP Error page header</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;head&gt;&lt;title&gt;Server Error&lt;/title&gt;&lt;/head&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;body&gt;&quot;</span>,</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// HTTP Error page footer</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;hr&gt;&lt;br&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;i&gt;Keil Embedded WEB Server V2.30, 2024&lt;br&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;a href=https://www.keil.com&gt;www.keil.com&lt;/a&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot; - Embedded Development Tools&lt;/i&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;/body&gt;&quot;</span>,</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// HTTP Error 401 - Unauthorized access</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;h2&gt;Error 401 - Unauthorized Access&lt;/h2&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;You are not authorized to access this server.&quot;</span>,</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// HTTP Error 403 - Forbidden</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;h2&gt;Error 403 - Forbidden&lt;/h2&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;You don&#39;t have permission to access this resource.&quot;</span>,</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// HTTP Error 404 - Not Found</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;h2&gt;Error 404 - Not Found&lt;/h2&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;The requested URL was not found on this server.&quot;</span>,</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// HTTP Error 501 - Not Implemented</span></div>
<div class="line">  <span class="stringliteral">&quot;&lt;h2&gt;Error 501 - Not Implemented&lt;/h2&gt;&quot;</span></div>
<div class="line">  <span class="stringliteral">&quot;The requested Method is not supported.&quot;</span></div>
<div class="line">};</div>
</div><!-- fragment --><p><a class="anchor" id="ws_http_caching"></a></p>
<h1><a class="anchor" id="autotoc_md65"></a>
HTTP Caching</h1>
<p>The HTTP protocol supports <b>local caching</b> of static resources by the browser. Most web pages include resources that change infrequently, such as CSS/JavaScript files, images and so on. These resources take time to download over the network, which increases the time it takes to load a web page. HTTP caching allows these resources to be saved, or cached, by the browser. Once a resource is cached, the browser can refer to the locally cached copy instead of having to download it again on subsequent visits to the web page.</p>
<p>The advantage of caching is obvious:</p><ul>
<li>The page <b>load</b> <b>time</b> for subsequent user visits is reduced, eliminating numerous HTTP requests for the required resources.</li>
<li>The total <b>payload</b> <b>size</b> of the responses is reduced.</li>
</ul>
<p>The HTTP Server supports HTTP <b>local caching</b> by the browser. For static resources (basically everything except the scripts themselves), the server sends the HTTP header with the <b>last modified</b> date tag in the response.</p>
<h2><a class="anchor" id="autotoc_md66"></a>
Caching of web resources stored in ROM</h2>
<p>The internal web pages are included and compiled into the code. When the <a class="el" href="group__nw__sw__util__fcarm.html">FCARM File Converter</a> reformats the web files into a single C-file, a timestamp is also added: </p><div class="fragment"><div class="line"><span class="keyword">const</span> uint32_t imageLastModified = 1380695329;</div>
</div><!-- fragment --><p> This time is used by the web server as the <b>File</b> <b>Modification</b> <b>Date</b>. It is specified in UTF format. The web server uses this date in the HTTP responses.</p>
<p>File caching improves the web server performance a lot. The following table lists the times required to load the default page from an example: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">index.html not cached   </th><th class="markdownTableHeadCenter">index.html cached    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">447.5 ms   </td><td class="markdownTableBodyCenter">53.1 ms   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md67"></a>
Caching of externally stored web resources</h2>
<p>The HTTP Server also supports browser local caching of web pages stored on SD Card. In general, files on an SD Card are bigger, thus the performance gain is much better. The available space for internal web pages is limited to the size of the internal flash memory. Thus, all large images, JavaScript archives and other large web resources, have to be located on an externally attached SD Card.</p>
<h3><a class="anchor" id="autotoc_md68"></a>
Static Web Resources</h3>
<p>The static web resource files are copied to a SD Card when the application is built. They will not be modified later. You might use a SD Card Reader attached to your PC to copy the files. In this case, the file modification date is set correctly by the PC. If you use an embedded application to copy the files, the file modification date is most likely set to the File System's default time. However, this does not create any problems for browser local caching. Once the web is locally cached by the browser, the cache is always valid and is used in subsequent browser requests.</p>
<h3><a class="anchor" id="autotoc_md69"></a>
Using Web Update</h3>
<p>Files, which are updated later with one of the update options provided by the Network Component, are called dynamic web resource files. You must provide the file modification date and time to the File System. If this information is not available, the File System uses a default file modification time. This might create browser local caching problems.</p>
<p>If you upload an updated web page with a wrong file modification date to the server, the HTTP Server is not able to recognize the updated files. It always reports the same <b>last</b> <b>modified</b> date. The browser then uses the locally cached page instead. So the updated pages will never be used. You can force the browser to load the updated pages by manually clearing the browser cache and reloading the web page.</p>
<dl class="section note"><dt>Note</dt><dd>If the File System does not have access to Real Time Clock information, the HTTP Server will not work for updated web pages. </dd></dl>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
