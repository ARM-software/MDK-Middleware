<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Network Component: User Callbacks</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">Network Component
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "Network Component");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">MDK Middleware for IPv4 and IPv6 Networking</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__telnet__user__notification.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">User Callbacks<div class="ingroups"><a class="el" href="group__netServices.html">Services</a> &raquo; <a class="el" href="group__netTELNET__Func.html">Telnet Server</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Functions to notify the user application about events on the Telnet server.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gae28cb4a796ee5e59ad5e32dccc969c76" id="r_gae28cb4a796ee5e59ad5e32dccc969c76"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gae28cb4a796ee5e59ad5e32dccc969c76">netTELNETs_ProcessCommand</a> (const char *cmd, char *buf, uint32_t buf_len, uint32_t *pvar)</td></tr>
<tr class="memdesc:gae28cb4a796ee5e59ad5e32dccc969c76"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process and execute a command requested by the Telnet client. [<a class="el" href="group__function__categories.html#user-provided">user-provided</a>].  <br /></td></tr>
<tr class="separator:gae28cb4a796ee5e59ad5e32dccc969c76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga66dbef28a03b6885922151c38bf3b0e2" id="r_ga66dbef28a03b6885922151c38bf3b0e2"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga66dbef28a03b6885922151c38bf3b0e2">netTELNETs_ProcessMessage</a> (<a class="el" href="group__netTELNET__Enums.html#gacd10ba371e060beaf7b511848cb253c3">netTELNETs_Message</a> msg, char *buf, uint32_t buf_len)</td></tr>
<tr class="memdesc:ga66dbef28a03b6885922151c38bf3b0e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request a message for a Telnet server session. [<a class="el" href="group__function__categories.html#user-provided">user-provided</a>].  <br /></td></tr>
<tr class="separator:ga66dbef28a03b6885922151c38bf3b0e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Description</h2>
<p>Functions to notify the user application about events on the Telnet server. </p>
<p>The <a class="el" href="#gae28cb4a796ee5e59ad5e32dccc969c76">netTELNETs_ProcessCommand</a> function processes the Telnet command when it is received from a remote client. A command is any sequence of characters that is terminated by the CRLF sequence (the Enter key is pressed). The Telnet server assembles this command and passes it as an argument to the <a class="el" href="#gae28cb4a796ee5e59ad5e32dccc969c76">netTELNETs_ProcessCommand</a> function. This function then generates a reply message and sends it back to the user. It is part of the <b>Telnet_Server_UIF.c</b> template file.</p>
<p>When the reply message is short, the whole message can be sent in a <b>single TCP packet</b>. However, when long reports are generated, <b>multiple TCP packets</b> must be sent to transfer the whole message. For example, when the log files are displayed this is often the case. Both single and multiple packets are supported by the Embedded Telnet Server.</p>
<h2><a class="anchor" id="autotoc_md69"></a>
Short Reply</h2>
<p>In the following example, the Telnet command HELP is sent by the Telnet client: </p><div class="fragment"><div class="line">cmd&gt; HELP</div>
</div><!-- fragment --><p> This command is answered by the predefined help message <em class="arg">telnet_help</em>. This message is copied to the output buffer and sent to the remote Telnet client. The following code sends the reply message: </p><div class="fragment"><div class="line">uint32_t <a class="code hl_function" href="#gae28cb4a796ee5e59ad5e32dccc969c76" title="Process and execute a command requested by the Telnet client. [user-provided].">netTELNETs_ProcessCommand</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *buf, uint32_t buf_len, uint32_t *pvar) {</div>
<div class="line">   ..</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__telnet__user__api.html#ga6cd80391e20e12ed698f01e8a77f2e0f" title="Check command string for a command. [thread-safe].">netTELNETs_CheckCommand</a> (cmd, <span class="stringliteral">&quot;HELP&quot;</span>) == <span class="keyword">true</span>) {</div>
<div class="line">    <span class="comment">// HELP command, print help text</span></div>
<div class="line">    len = sprintf (buf, telnet_help);</div>
<div class="line">    <span class="keywordflow">return</span> (len);</div>
<div class="line">  }</div>
<div class="line">   ..</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md70"></a>
Long Reply</h2>
<p>A long reply message requires multiple calls to the function <a class="el" href="#gae28cb4a796ee5e59ad5e32dccc969c76">netTELNETs_ProcessCommand</a>. Each call to this function generates part of the reply message until the entire message is generated and sent. To distinguish between different calls to the function, the argument <em class="arg">pvar</em> is used. This argument is a pointer to a variable that is set to <span class="XML-Token">0</span> on the first call and not altered on each subsequent call to this function. The function's return value, which specifies the number of bytes in the reply message, cannot exceed <span class="XML-Token">1500</span>. Hence the high bits of the function's return value are used to store the flags:</p><ul>
<li><b>Repeat flag</b> - bit 31<br  />
 This flag tells the Telnet Server whether the function <a class="el" href="#gae28cb4a796ee5e59ad5e32dccc969c76">netTELNETs_ProcessCommand</a> must be called again or not (because the command processing is complete). The return value must be OR-ed with <span class="XML-Token">1u&lt;&lt;31</span> to call the function again.</li>
<li><b>Disconnect flag</b> - bit 30<br  />
 This flag tells the Telnet Server to disconnect the Telnet connection. If this flag is set, the Telnet Server disconnects the current Telnet session. The return value must be OR-ed with <span class="XML-Token">1u&lt;&lt;30</span> to disconnect.</li>
</ul>
<p>In the following example, the <b>MEAS</b> command is given by the user using the Telnet client. </p><div class="fragment"><div class="line">cmd&gt; MEAS</div>
</div><!-- fragment --><p> When a new Telnet command is received, the function <a class="el" href="#gae28cb4a796ee5e59ad5e32dccc969c76">netTELNETs_ProcessCommand</a> is called with the argument <em class="arg">pvar</em> set to <span class="XML-Token">0</span>. The command buffer <em class="arg">cmd</em> is checked to identify the command. </p><div class="fragment"><div class="line">uint32_t <a class="code hl_function" href="#gae28cb4a796ee5e59ad5e32dccc969c76" title="Process and execute a command requested by the Telnet client. [user-provided].">netTELNETs_ProcessCommand</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *buf, uint32_t buf_len, uint32_t *pvar) {</div>
<div class="line">  uint32_t len = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (MYBUF(pvar)-&gt;<span class="keywordtype">id</span>) {</div>
<div class="line">    <span class="keywordflow">case</span> 0:</div>
<div class="line">      <span class="comment">// First call to this function</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> 1:</div>
<div class="line">      <span class="comment">// Command MEAS, repeated call</span></div>
<div class="line">      ..</div>
<div class="line">      <span class="comment">// Set request for another callback</span></div>
<div class="line">      <span class="keywordflow">return</span> (len | (1u &lt;&lt; 31));</div>
<div class="line">  ..</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__telnet__user__api.html#ga6cd80391e20e12ed698f01e8a77f2e0f" title="Check command string for a command. [thread-safe].">netTELNETs_CheckCommand</a> (cmd, <span class="stringliteral">&quot;MEAS&quot;</span>) == <span class="keyword">true</span>) {</div>
<div class="line">    <span class="comment">// MEAS command given, monitor analog inputs</span></div>
<div class="line">    MYBUF(pvar)-&gt;id = 1;</div>
<div class="line">    <span class="keywordflow">if</span> (len &gt; 5) {</div>
<div class="line">      uint32_t nmax;</div>
<div class="line">      sscanf (&amp;cmd[5], <span class="stringliteral">&quot;%u&quot;</span>, &amp;nmax);</div>
<div class="line">      <span class="keywordflow">if</span> (nmax &gt; 255) nmax = 255;</div>
<div class="line">      MYBUF(pvar)-&gt;nmax = nmax;</div>
<div class="line">    }</div>
<div class="line">    len = sprintf (buf, meas_header);</div>
<div class="line">    <span class="keywordflow">if</span> (MYBUF(pvar)-&gt;nmax) {</div>
<div class="line">      <span class="comment">// Bit-31 is a repeat flag</span></div>
<div class="line">      len |= (1u &lt;&lt; 31);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (len);</div>
<div class="line">  }</div>
<div class="line">  ..</div>
<div class="line">}</div>
</div><!-- fragment --><p>The above example uses 3 bytes of a storage variable pointed by <em class="arg">pvar</em> pointer for the following structure: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">  uint8_t id;</div>
<div class="line">  uint8_t nmax;</div>
<div class="line">  uint8_t idx;</div>
<div class="line">} MY_BUF;</div>
<div class="line"><span class="preprocessor">#define MYBUF(p)        ((MY_BUF *)p)</span></div>
</div><!-- fragment --><p> When the call to <a class="el" href="#gae28cb4a796ee5e59ad5e32dccc969c76">netTELNETs_ProcessCommand</a> is repeated for the same command, the value of a storage variable pointed to by argument <em class="arg">pvar</em> is not altered any more. You can use the value of <em class="arg">pvar</em> to process the command differently. The <em class="arg">pvar</em> buffer now holds the private structure <code>MYBUF</code>, which is valid for the lifetime of processing the command. When the command processing is finished, this buffer is not used any more until the next command. </p><div class="fragment"><div class="line">uint32_t <a class="code hl_function" href="#gae28cb4a796ee5e59ad5e32dccc969c76" title="Process and execute a command requested by the Telnet client. [user-provided].">netTELNETs_ProcessCommand</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *buf, uint32_t buf_len, uint32_t *pvar) {</div>
<div class="line">  uint32_t len = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (MYBUF(pvar)-&gt;<span class="keywordtype">id</span>) {</div>
<div class="line">    <span class="keywordflow">case</span> 0:</div>
<div class="line">      <span class="comment">// First call to this function</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> 1:</div>
<div class="line">      <span class="comment">// Command MEAS, repeated call</span></div>
<div class="line">      <span class="keywordflow">while</span> (len &lt; buf_len-80) {</div>
<div class="line">        <span class="comment">// Let&#39;s use as much of the buffer as possible</span></div>
<div class="line">        len += sprintf (buf+len, <span class="stringliteral">&quot;\r\n%4d&quot;</span>, MYBUF(pvar)-&gt;idx);</div>
<div class="line">        <span class="keywordflow">for</span> (val = 0; val &lt; 8; val++) {</div>
<div class="line">          len += sprintf (buf+len, <span class="stringliteral">&quot;%7d&quot;</span>, AD_in(val));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (++MYBUF(pvar)-&gt;idx &gt;= MYBUF(pvar)-&gt;nmax) {</div>
<div class="line">          <span class="comment">// Requested number of measurements done</span></div>
<div class="line">          <span class="keywordflow">return</span> (len);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// Set request for another callback</span></div>
<div class="line">      <span class="keywordflow">return</span> (len | (1u &lt;&lt; 31));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> 2:</div>
<div class="line">      <span class="comment">// Repeated call, TCP status display</span></div>
<div class="line">      ..</div>
<div class="line">}</div>
</div><!-- fragment --><p> After giving a <code>meas</code> <code>4</code> command, the Telnet Client screen looks like this:</p>
<div class="image">
<img src="telnet_meas.png" alt=""/>
</div>
<dl class="section note"><dt>Note</dt><dd>You can check the <a class="el" href="Telnet_Server_Example.html">Telnet Server</a> to see how it works.</dd></dl>
<h2 class="groupheader">Function Documentation</h2>
<a id="gae28cb4a796ee5e59ad5e32dccc969c76" name="gae28cb4a796ee5e59ad5e32dccc969c76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae28cb4a796ee5e59ad5e32dccc969c76">&#9670;&#160;</a></span>netTELNETs_ProcessCommand()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t netTELNETs_ProcessCommand </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>cmd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>buf_len</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *</td>          <td class="paramname"><span class="paramname"><em>pvar</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Process and execute a command requested by the Telnet client. [<a class="el" href="group__function__categories.html#user-provided">user-provided</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cmd</td><td>pointer to command string from Telnet client. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buf</td><td>output buffer to write the return message to. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buf_len</td><td>length of the output buffer in bytes. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">pvar</td><td>pointer to a session's local buffer of 4 bytes.<ul>
<li>1st call = cleared to 0.</li>
<li>2nd call = not altered by the system.</li>
<li>3rd call = not altered by the system, etc. </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of bytes written to output buffer.<ul>
<li>return len | (1u&lt;&lt;31) = repeat flag, the system calls this function again for the same command.</li>
<li>return len | (1u&lt;&lt;30) = disconnect flag, the system disconnects the Telnet client.</li>
</ul>
</dd></dl>
<p>The callback function <b>netTELNETs_ProcessCommand</b> processes and executes the command requested by the Telnet client. The Network Component's Telnet server calls the function when it receives the consecutive Carriage Return (CR) and Line Feed (LF) character sequence from the Telnet client (this is usually produced by the user pressing Enter on the Telnet client terminal).</p>
<p>The argument <em class="arg">cmd</em> points to the message containing the command that is received from the Telnet client.</p>
<p>The argument <em class="arg">buf</em> points to the output buffer where the <b>netTELNETs_ProcessCommand</b> must write the message to be returned to the Telnet client.</p>
<p>The argument <em class="arg">buf_len</em> specifies the length of the output buffer in bytes.</p>
<p>The argument <em class="arg">pvar</em> is a pointer to a local session buffer with a length of 4 bytes. The Telnet Server clears the data in the <em class="arg">pvar</em> pointer to <span class="XML-Token">0</span> before the function is called for the first time in each session, and never changes it later. You can use <em class="arg">*pvar</em> as a repeat counter or simply to distinguish between different function calls.</p>
<dl class="section note"><dt>Note</dt><dd>The Telnet server does not automatically expand the CR character. The function must write the CR and LF characters into the buffer to indicate the end of each message.</dd></dl>
<p><b>Code</b> <b>Example</b> </p>
<p>The following example is available in the user code template file <b>Telnet_Server_UIF.c</b>. Customize it to the application's needs.</p>
<div class="fragment"><div class="line">uint32_t <a class="code hl_function" href="#gae28cb4a796ee5e59ad5e32dccc969c76" title="Process and execute a command requested by the Telnet client. [user-provided].">netTELNETs_ProcessCommand</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *buf, uint32_t buf_len, uint32_t *pvar) {</div>
<div class="line">  uint32_t len = 0;</div>
<div class="line">  ..</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__telnet__user__api.html#ga6cd80391e20e12ed698f01e8a77f2e0f" title="Check command string for a command. [thread-safe].">netTELNETs_CheckCommand</a> (cmd, <span class="stringliteral">&quot;LED0=ON&quot;</span>) == <span class="keyword">true</span>) {</div>
<div class="line">    <span class="comment">// Switch ON LED0</span></div>
<div class="line">    len = sprintf (buf,<span class="stringliteral">&quot; Ok&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> (len);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_function" href="group__telnet__user__api.html#ga6cd80391e20e12ed698f01e8a77f2e0f" title="Check command string for a command. [thread-safe].">netTELNETs_CheckCommand</a> (cmd, <span class="stringliteral">&quot;LED0=OFF&quot;</span>) == <span class="keyword">true</span>) {</div>
<div class="line">    <span class="comment">// Switch OFF LED0</span></div>
<div class="line">    len = sprintf (buf,<span class="stringliteral">&quot; Ok&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> (len);</div>
<div class="line">  }</div>
<div class="line">  ..</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a id="ga66dbef28a03b6885922151c38bf3b0e2" name="ga66dbef28a03b6885922151c38bf3b0e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga66dbef28a03b6885922151c38bf3b0e2">&#9670;&#160;</a></span>netTELNETs_ProcessMessage()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t netTELNETs_ProcessMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__netTELNET__Enums.html#gacd10ba371e060beaf7b511848cb253c3">netTELNETs_Message</a></td>          <td class="paramname"><span class="paramname"><em>msg</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>buf_len</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Request a message for a Telnet server session. [<a class="el" href="group__function__categories.html#user-provided">user-provided</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>code of requested message. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buf</td><td>output buffer to write the message to. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buf_len</td><td>length of the output buffer in bytes. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of bytes written to output buffer.</dd></dl>
<p>The callback function <b>netTELNETs_ProcessMessage</b> provides the connection and login messages to the Telnet server, when requested. The Telnet server sends these messages to the Telnet client.</p>
<p>The argument <em class="arg">msg</em> specifies the type of message that the Telnet server requires: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Message   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTELNETs_MessageWelcome</span>   </td><td class="markdownTableBodyNone">Initial welcome message    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTELNETs_MessageLogin</span>   </td><td class="markdownTableBodyNone">Login message, if authentication is enabled    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTELNETs_MessageUsername</span>   </td><td class="markdownTableBodyNone">Username request login message    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTELNETs_MessagePassword</span>   </td><td class="markdownTableBodyNone">Password request login message    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTELNETs_MessageLoginFailed</span>   </td><td class="markdownTableBodyNone">Incorrect login error message    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTELNETs_MessageLoginTimeout</span>   </td><td class="markdownTableBodyNone">Login timeout error message    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTELNETs_MessagePrompt</span>   </td><td class="markdownTableBodyNone">Prompt message    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTELNETs_MessageUnsolicited</span>   </td><td class="markdownTableBodyNone">Unsolicited message (triggered by <a class="el" href="group__telnet__user__api.html#ga6b3ea6abcd4f2ad5a2dfb0160c3059c2">netTELNETs_RequestMessage</a>)   </td></tr>
</table>
<p>The argument <em class="arg">buf</em> points to the output buffer where the <b>netTELNETs_ProcessMessage</b> must write the message.</p>
<p>The argument <em class="arg">buf_len</em> specifies the length of the output buffer in bytes.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The length of the output buffer (<em class="arg">buf_len</em>), might vary because buffer length is determined by the TCP socket Maximum Segment Size (MSS) negotiation. It is normally around 1400 bytes for local LAN. But this can be reduced to 500 bytes or even less.</li>
<li>If the <b>netTELNETs_ProcessMessage</b> function writes more bytes than <em class="arg">buf_len</em> into the output buffer, then a system crash resulting from corruption of memory link pointers is highly likely.</li>
<li>The Telnet server does not automatically expand the carriage return (CR) character. The <b>netTELNETs_ProcessMessage</b> function must write the carriage return and line feed (LF) characters into the buffer to indicate the end of each message.</li>
</ul>
</dd></dl>
<p><b>Code</b> <b>Example</b> </p>
<p>The following example is available in the user code template file <b>Telnet_Server_UIF.c</b>. Customize it to the application's needs.</p>
<div class="fragment"><div class="line">uint32_t <a class="code hl_function" href="#ga66dbef28a03b6885922151c38bf3b0e2" title="Request a message for a Telnet server session. [user-provided].">netTELNETs_ProcessMessage</a> (<a class="code hl_enumeration" href="group__netTELNET__Enums.html#gacd10ba371e060beaf7b511848cb253c3" title="Telnet Server Messages.">netTELNETs_Message</a> msg, <span class="keywordtype">char</span> *buf, uint32_t buf_len) {</div>
<div class="line">  uint32_t len = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (msg) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gacd10ba371e060beaf7b511848cb253c3a5a7e74d646d8ef4fdcc4b18da1da4189" title="Initial welcome message.">netTELNETs_MessageWelcome</a>:</div>
<div class="line">      <span class="comment">// Initial welcome message</span></div>
<div class="line">      len = sprintf (buf, <span class="stringliteral">&quot;\r\n&quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;Embedded Telnet Server\r\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gacd10ba371e060beaf7b511848cb253c3addad3635d3dc41b99b4afde3ba548ee4" title="Prompt message.">netTELNETs_MessagePrompt</a>:</div>
<div class="line">      <span class="comment">// Prompt message</span></div>
<div class="line">      len = sprintf (buf, <span class="stringliteral">&quot;\r\n&quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;Cmd&gt; &quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gacd10ba371e060beaf7b511848cb253c3a67fe01cd396a558e51be1ccd95590ec6" title="Login message, if authentication is enabled.">netTELNETs_MessageLogin</a>:</div>
<div class="line">      <span class="comment">// Login message, if authentication is enabled</span></div>
<div class="line">      len = sprintf (buf, <span class="stringliteral">&quot;\r\n&quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;Please login...&quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gacd10ba371e060beaf7b511848cb253c3add25ab6277e65c223453f361aae826e2" title="Username request login message.">netTELNETs_MessageUsername</a>:</div>
<div class="line">      <span class="comment">// Username request login message</span></div>
<div class="line">      len = sprintf (buf, <span class="stringliteral">&quot;\r\n&quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;Username: &quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gacd10ba371e060beaf7b511848cb253c3a4f72c9e7e4176bbbfcbc69896fa3ea48" title="Password request login message.">netTELNETs_MessagePassword</a>:</div>
<div class="line">      <span class="comment">// Password request login message</span></div>
<div class="line">      len = sprintf (buf, <span class="stringliteral">&quot;\r\n&quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;Password: &quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gacd10ba371e060beaf7b511848cb253c3a5d9169dd8e87cce845a490b3d56c586f" title="Incorrect login error message.">netTELNETs_MessageLoginFailed</a>:</div>
<div class="line">      <span class="comment">// Incorrect login error message</span></div>
<div class="line">      len = sprintf (buf, <span class="stringliteral">&quot;\r\n&quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;Login incorrect&quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gacd10ba371e060beaf7b511848cb253c3a57fbce1bc4cc4c7ea873002a848603b6" title="Login timeout error message.">netTELNETs_MessageLoginTimeout</a>:</div>
<div class="line">      <span class="comment">// Login timeout error message</span></div>
<div class="line">      len = sprintf (buf, <span class="stringliteral">&quot;\r\n&quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;Login timeout\r\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gacd10ba371e060beaf7b511848cb253c3a85f63bbc7f0ca7e27c63f5f353ebac1b" title="Unsolicited message (triggered by netTELNETs_RequestMessage)">netTELNETs_MessageUnsolicited</a>:</div>
<div class="line">      <span class="comment">// Unsolicited message (ie. from basic interpreter)</span></div>
<div class="line">      len = sprintf (buf, <span class="stringliteral">&quot;\r\n&quot;</span></div>
<div class="line">                          <span class="stringliteral">&quot;Unsolicited message\r\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> (len);</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
