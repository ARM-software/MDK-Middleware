<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>USB Component: Resource Requirements</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">USB Component
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "USB Component");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">MDK Middleware for USB Device and Host Communication</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('resource_requirements.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Resource Requirements </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_src_resource_requirements"></a> This section describes the resource requirements of the USB component.</p>
<h1><a class="anchor" id="usbd_res_req"></a>
USB Device Resource Requirements</h1>
<p>The following section documents the requirements for the <b>USB Device</b> component. The actual requirements depend on the components used in the application and the configuration of these components.</p>
<h2><a class="anchor" id="usbd_stack_req"></a>
Stack Requirements</h2>
<p>The USB Device Core receives events sent from the interrupt service routine (ISR) of the <b>USB Device Driver</b>. The stack requirements for the ISR are typically less than 512 Bytes. The total stack space required for ISR depends on the interrupt nesting and therefore on the priority settings of these ISR.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Option (under section Stack Configuration)   </th><th class="markdownTableHeadLeft">Increase Value by    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Stack Size (in Bytes)   </td><td class="markdownTableBodyLeft">+ 512 for USB Device Driver   </td></tr>
</table>
<p>Stack size for the ISRs is typically configured in the application <code>linker script</code> or device's <code>startup_device.s</code> file. The stack size for the ISRs configures only the stack space that is used by exception and interrupt service routines of the drivers. The stack size requirements depend on the maximum nesting of exception and ISR execution and therefore on the priority settings of the various interrupt and exception sources.</p>
<p>Stack size for threads is configured in the CMSIS-RTOS2 configuration file. The stack size of the thread that calls USB Device API functions should be at least 512 bytes large.</p>
<h2><a class="anchor" id="usbd_rtos_req"></a>
CMSIS-RTOS2 Requirements</h2>
<p>Currently, the USB Device component works in two different RTOS configurations:</p>
<ol type="1">
<li><b>CMSIS-RTOS2 RTX5</b>: This mode uses Keil RTX5 natively. In the Manage Run-Time Environment window, the component <b>CMSIS:RTOS2 (API):Keil RTX5</b> must be selected. The RTOS resources are static, configured by the system. There is <b>no need for additional user configuration</b>. This is the suggested option for new development.</li>
<li><b>CMSIS-RTOS2 with a generic RTOS</b>: this mode uses a generic RTOS (such as FreeRTOS). The RTOS resources (thread, mutex and semaphore control blocks and thread stacks) are dynamically allocated. The user needs to provide memory pools big enough for the allocations in the specific RTOS configuration.</li>
</ol>
<p>The USB Device component uses threads. Each instance of a component starts its own threads, for example two HID instances start two threads with the name: USBD_HID0_Thread, USBD_HID1_Thread. The thread execution starts with <a class="el" href="group__usbd__coreFunctions__api.html#ga65ba44a47e3fa46a15f70bab9917c8ca">USBD_Initialize</a>.</p>
<p>The following table lists the components, number of threads, thread name, default thread priority, default stack size and the configuration file with <b>OS Resource Settings</b> for stack size adjustments.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Component   </th><th class="markdownTableHeadLeft">Number of Threads   </th><th class="markdownTableHeadLeft">Thread Name   </th><th class="markdownTableHeadCenter">Default Priority   </th><th class="markdownTableHeadCenter">Default Stack Size   </th><th class="markdownTableHeadLeft">Configuration File    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>USB:Device</b>   </td><td class="markdownTableBodyLeft">1   </td><td class="markdownTableBodyLeft">USBDn_Core_Thread   </td><td class="markdownTableBodyCenter"><code>osPriorityAboveNormal</code>   </td><td class="markdownTableBodyCenter">1024 Bytes   </td><td class="markdownTableBodyLeft">USBD_Config_n.h    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>USB:Device:ADC</b>   </td><td class="markdownTableBodyLeft">1   </td><td class="markdownTableBodyLeft">USBD_ADCn_Thread   </td><td class="markdownTableBodyCenter"><code>osPriorityAboveNormal</code>   </td><td class="markdownTableBodyCenter">512 Bytes   </td><td class="markdownTableBodyLeft">USBD_Config_ADC_n.h    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>USB:Device:CDC</b>   </td><td class="markdownTableBodyLeft">2   </td><td class="markdownTableBodyLeft">USBD_CDCn_Bulk_Thread, USBD_CDCn_Int_Thread   </td><td class="markdownTableBodyCenter"><code>osPriorityAboveNormal</code>   </td><td class="markdownTableBodyCenter">512 Bytes   </td><td class="markdownTableBodyLeft">USBD_Config_CDC_n.h    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>USB:Device:Custom Class</b>   </td><td class="markdownTableBodyLeft">1...15   </td><td class="markdownTableBodyLeft">USBD_CustomClassn_EPm_Thread   </td><td class="markdownTableBodyCenter"><code>osPriorityAboveNormal</code>   </td><td class="markdownTableBodyCenter">512 Bytes   </td><td class="markdownTableBodyLeft">USBD_Config_CustomClass_n.h    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>USB:Device:HID</b>   </td><td class="markdownTableBodyLeft">1   </td><td class="markdownTableBodyLeft">USBD_HIDn_Thread   </td><td class="markdownTableBodyCenter"><code>osPriorityAboveNormal</code>   </td><td class="markdownTableBodyCenter">512 Bytes   </td><td class="markdownTableBodyLeft">USBD_Config_HID_n.h    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>USB:Device:MSC</b>   </td><td class="markdownTableBodyLeft">1   </td><td class="markdownTableBodyLeft">USBD_MSCn_Thread   </td><td class="markdownTableBodyCenter"><code>osPriorityAboveNormal</code>   </td><td class="markdownTableBodyCenter">512 Bytes   </td><td class="markdownTableBodyLeft">USBD_Config_MSC_n.h   </td></tr>
</table>
<p>n is the instance number, m is the endpoint number 1...15</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>For <b>USB:Device:Custom Class</b> each endpoint In/Out pair executes in a separate thread. The number of threads depends on the number of endpoints enabled in the configuration file USBD_Config_CustomClass_n.h.</li>
<li>The <b>Default Stack Size</b> in the table above can be changed in the USB configuration files (for example USBD_Config_n.h and USBD_Config_DeviceClass_n.h). At the end of each configuration file, you will find <b>OS Resource Settings</b> and below that the value for the <b>Thread stack size</b>.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="usbd_mem_req"></a>
Memory Requirements</h2>
<p>The following table shows the memory requirements for read-only (Flash) and read-write (RAM) memory. These numbers may be used to estimate the total size requirements of the application, but the actual numbers depend on compiler optimizations and target processor and may therefore slightly differ.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Component   </th><th class="markdownTableHeadCenter">RO Memory [Bytes]   </th><th class="markdownTableHeadLeft">RW Memory (Data) [Bytes]    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>USB:Core</b> (Device)   </td><td class="markdownTableBodyCenter">6.0 k   </td><td class="markdownTableBodyLeft">&lt; 470    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>USB:Device:ADC</b>   </td><td class="markdownTableBodyCenter">2.5 k   </td><td class="markdownTableBodyLeft">&lt; 110 + Audio Subframe Sizes * Buffer Sizes (configured in the USBD_Config_ADC_n.h)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>USB:Device:HID</b>   </td><td class="markdownTableBodyCenter">2.7 k   </td><td class="markdownTableBodyLeft">&lt; 130 + Maximum Report Sizes (configured in the USBD_Config_HID_n.h)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>USB:Device:MSC</b>   </td><td class="markdownTableBodyCenter">4.1 k   </td><td class="markdownTableBodyLeft">&lt; 160 + Maximum Bulk Buffer Size (configured in the USBD_Config_MSC_n.h)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>USB:Device:CDC ACM</b>   </td><td class="markdownTableBodyCenter">3.2 k   </td><td class="markdownTableBodyLeft">&lt; 220 + Maximum Send/Receive Buffer Sizes (configured in the USBD_Config_CDC_n.h)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>USB:Device:Custom Class</b>   </td><td class="markdownTableBodyCenter">2.0 k   </td><td class="markdownTableBodyLeft">&lt; 80    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>USB Device Driver</b>   </td><td class="markdownTableBodyCenter">1 .. 4 k   </td><td class="markdownTableBodyLeft">0.5 .. 4 k   </td></tr>
</table>
<h1><a class="anchor" id="usbh_res_req"></a>
USB Host Resource Requirements</h1>
<p>The following section documents the requirements for the <b>USB Host</b> component. The actual requirements depend on the components used in the application and the configuration of these components.</p>
<h2><a class="anchor" id="usbh_stack_req"></a>
Stack Requirements</h2>
<p>The USB Host Core receives events sent from the interrupt service routine (ISR) of the <b>USB Host Driver</b>. The stack requirements for the ISR are typically less than 512 Bytes. The total stack space required for ISR depends on the interrupt nesting and therefore on the priority settings of these ISR.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Option (under section Stack Configuration)   </th><th class="markdownTableHeadLeft">Increase Value by    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Stack Size (in Bytes)   </td><td class="markdownTableBodyLeft">+ 512 for USB Host Driver   </td></tr>
</table>
<p>Stack size for the ISRs is typically configured in the application <code>linker script</code> or device's <code>startup_device.s</code> file. The stack size for the ISRs configures only the stack space that is used by exception and interrupt service routines of the drivers. The stack size requirements depend on the maximum nesting of exception and ISR execution and therefore on the priority settings of the various interrupt and exception sources.</p>
<p>Stack size for threads is configured in the CMSIS-RTOS2 configuration file. The stack size of the thread that calls USB Host API functions should be at least 512 bytes large.</p>
<h2><a class="anchor" id="usbh_rtos_req"></a>
CMSIS-RTOS2 Requirements</h2>
<p>Currently, the USB Host component works in two different RTOS configurations:</p>
<ol type="1">
<li><b>CMSIS-RTOS2 RTX5</b>: This mode uses Keil RTX5 natively. In the Manage Run-Time Environment window, the component <b>CMSIS:RTOS2 (API):Keil RTX5</b> must be selected. The RTOS resources are static, configured by the system. There is <b>no need for additional user configuration</b>. This is the suggested option for new development.</li>
<li><b>CMSIS-RTOS2 with a generic RTOS</b>: this mode uses a generic RTOS (such as FreeRTOS). The RTOS resources (thread, mutex and semaphore control blocks and thread stacks) are dynamically allocated. The user needs to provide memory pools big enough for the allocations in the specific RTOS configuration.</li>
</ol>
<p>The USB Host component uses threads. Each USB Host instance starts its own thread (USBHn_Core_Thread). The thread execution starts with <a class="el" href="group__usbh__coreFunctions__api.html#ga4420c0add78ae79e8e7ce035227ef4c5">USBH_Initialize</a>. Additionally each instance of HID and CDC class also start their own thread (USBH_HIDn_IntIn_Thread or USBH_CDCn_IntIn_Thread) when HID or CDC device is connected.</p>
<p>The following table lists the components, number of threads, thread name, default thread priority, default stack size and the configuration file with <b>OS Resource Settings</b> for stack size adjustments.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Component   </th><th class="markdownTableHeadLeft">Number of Threads   </th><th class="markdownTableHeadLeft">Thread Name   </th><th class="markdownTableHeadCenter">Default Priority   </th><th class="markdownTableHeadCenter">Default Stack Size   </th><th class="markdownTableHeadLeft">Configuration File    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>USB:Host</b>   </td><td class="markdownTableBodyLeft">1   </td><td class="markdownTableBodyLeft">USBHn_Core_Thread   </td><td class="markdownTableBodyCenter"><code>osPriorityAboveNormal</code>   </td><td class="markdownTableBodyCenter">2048 Bytes   </td><td class="markdownTableBodyLeft">USBH_Config_n.h    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>USB:Host:CDC</b>   </td><td class="markdownTableBodyLeft">1   </td><td class="markdownTableBodyLeft">USBH_CDCn_IntIn_Thread   </td><td class="markdownTableBodyCenter"><code>osPriorityAboveNormal</code>   </td><td class="markdownTableBodyCenter">512 Bytes   </td><td class="markdownTableBodyLeft">USBH_Config_CDC.h    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>USB:Host:HID</b>   </td><td class="markdownTableBodyLeft">1   </td><td class="markdownTableBodyLeft">USBH_HIDn_IntIn_Thread   </td><td class="markdownTableBodyCenter"><code>osPriorityAboveNormal</code>   </td><td class="markdownTableBodyCenter">512 Bytes   </td><td class="markdownTableBodyLeft">USBH_Config_HID.h   </td></tr>
</table>
<p>n is the instance number</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The <b>Default Stack Size</b> in the table above can be changed in the USB configuration files (for example USBH_Config_n.h and USBH_Config_DeviceClass.h). At the end of each configuration file, you will find <b>OS Resource Settings</b> and below that the value for the <b>Thread stack size</b>.</li>
<li>If File System is used retargeted to USB Host Mass Storage the stack size for thread calling File System functions should be at least 2560 Bytes.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="usbh_mem_req"></a>
Memory Requirements</h2>
<p>The following table shows the memory requirements for read-only (Flash) and read-write (RAM) memory. These numbers may be used to estimate the total size requirements of the application, but the actual numbers depend on compiler optimizations and target processor and may therefore slightly differ.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Component   </th><th class="markdownTableHeadCenter">RO Memory [Bytes]   </th><th class="markdownTableHeadCenter">RW Memory (Data) [Bytes]    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>USB:Core</b> (Host)   </td><td class="markdownTableBodyCenter">&lt; 9.5 k   </td><td class="markdownTableBodyCenter">&lt; 370 + Memory Pool Size (configured in the USBH_Config_n.h)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>USB:Host:HID</b>   </td><td class="markdownTableBodyCenter">&lt; 1.3 k   </td><td class="markdownTableBodyCenter">&lt; 70    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>USB:Host:MSC</b>   </td><td class="markdownTableBodyCenter">&lt; 3.4 k   </td><td class="markdownTableBodyCenter">&lt; 40    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>USB:Host:CDC</b>   </td><td class="markdownTableBodyCenter">&lt; 1.0 k   </td><td class="markdownTableBodyCenter">&lt; 30    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>USB Host OHCI</b> support   </td><td class="markdownTableBodyCenter">&lt; 3.5 k   </td><td class="markdownTableBodyCenter">&lt; 0.5 k    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>USB Host EHCI</b> support   </td><td class="markdownTableBodyCenter">&lt; 5.0 k   </td><td class="markdownTableBodyCenter">&lt; 4.5 k   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
