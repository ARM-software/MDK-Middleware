<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Network Component: User API</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="armkeil_white_h.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">Network Component
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "Network Component");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">MDK Middleware for IPv4 and IPv6 Networking</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<script type="text/javascript">
  writeSubComponentTabs.call(this);
</script>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__tcp__user__api.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">User API<div class="ingroups"><a class="el" href="group__netSockets.html">Sockets</a> &raquo; <a class="el" href="group__netTCP__Func.html">TCP Socket</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>TCP Socket functions and communication flow.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="memitem:ga9c559a5589c9476028adde1f8e509624"><td class="memItemLeft" align="right" valign="top">typedef uint32_t(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#ga9c559a5589c9476028adde1f8e509624">netTCP_cb_t</a>) (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>, <a class="el" href="group__netTCP__Enums.html#gaecc5852a7c568a7569347007c289b8a5">netTCP_Event</a> event, const <a class="el" href="group__network__structs.html#structNET__ADDR">NET_ADDR</a> *addr, const uint8_t *buf, uint32_t len)</td></tr>
<tr class="memdesc:ga9c559a5589c9476028adde1f8e509624"><td class="mdescLeft">&#160;</td><td class="mdescRight">TCP Event callback function.  <br /></td></tr>
<tr class="separator:ga9c559a5589c9476028adde1f8e509624"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga19247901cf1062d474d767ac68277ed3"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a> (<a class="el" href="group__tcp__user__api.html#ga9c559a5589c9476028adde1f8e509624">netTCP_cb_t</a> cb_func)</td></tr>
<tr class="memdesc:ga19247901cf1062d474d767ac68277ed3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a free TCP socket. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:ga19247901cf1062d474d767ac68277ed3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga20a5311ac374ab89995165de6e1dbe1c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#ga20a5311ac374ab89995165de6e1dbe1c">netTCP_ReleaseSocket</a> (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>)</td></tr>
<tr class="memdesc:ga20a5311ac374ab89995165de6e1dbe1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release TCP socket and free resources. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:ga20a5311ac374ab89995165de6e1dbe1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac02a84a9dc999e80c5a8a1650e5d9674"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#gac02a84a9dc999e80c5a8a1650e5d9674">netTCP_Listen</a> (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>, uint16_t port)</td></tr>
<tr class="memdesc:gac02a84a9dc999e80c5a8a1650e5d9674"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open TCP socket for incoming connection. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:gac02a84a9dc999e80c5a8a1650e5d9674"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5dbbfc3def198bfe40ef51629dc55652"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#ga5dbbfc3def198bfe40ef51629dc55652">netTCP_Connect</a> (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>, const <a class="el" href="group__network__structs.html#structNET__ADDR">NET_ADDR</a> *addr, uint16_t local_port)</td></tr>
<tr class="memdesc:ga5dbbfc3def198bfe40ef51629dc55652"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initiate a TCP connection to a remote node. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:ga5dbbfc3def198bfe40ef51629dc55652"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad3b70b023f209cd7687f15f553219185"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#gad3b70b023f209cd7687f15f553219185">netTCP_Close</a> (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>)</td></tr>
<tr class="memdesc:gad3b70b023f209cd7687f15f553219185"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop TCP communication and start closing procedure. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:gad3b70b023f209cd7687f15f553219185"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga621b26f6da519678dd6a660fce012668"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#ga621b26f6da519678dd6a660fce012668">netTCP_Abort</a> (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>)</td></tr>
<tr class="memdesc:ga621b26f6da519678dd6a660fce012668"><td class="mdescLeft">&#160;</td><td class="mdescRight">Instantly stop TCP communication. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:ga621b26f6da519678dd6a660fce012668"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad8393d4e967564107799400710c94521"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#gad8393d4e967564107799400710c94521">netTCP_GetMaxSegmentSize</a> (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>)</td></tr>
<tr class="memdesc:gad8393d4e967564107799400710c94521"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determine maximum number of data bytes that can be sent in TCP packet. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:gad8393d4e967564107799400710c94521"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga361ee211c7cd20ca32c266aec90d60ff"><td class="memItemLeft" align="right" valign="top">uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#ga361ee211c7cd20ca32c266aec90d60ff">netTCP_GetBuffer</a> (uint32_t size)</td></tr>
<tr class="memdesc:ga361ee211c7cd20ca32c266aec90d60ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate memory for TCP send buffer. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:ga361ee211c7cd20ca32c266aec90d60ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5770081776ef5a657b984a9ee600c149"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#ga5770081776ef5a657b984a9ee600c149">netTCP_SendReady</a> (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>)</td></tr>
<tr class="memdesc:ga5770081776ef5a657b984a9ee600c149"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if TCP socket can send data. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:ga5770081776ef5a657b984a9ee600c149"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0b32a74e8fc2d3d3fcea041d3958f4e6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#ga0b32a74e8fc2d3d3fcea041d3958f4e6">netTCP_Send</a> (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>, uint8_t *buf, uint32_t len)</td></tr>
<tr class="memdesc:ga0b32a74e8fc2d3d3fcea041d3958f4e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a data packet to remote node. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:ga0b32a74e8fc2d3d3fcea041d3958f4e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga75abc5d6ad7b4007e2bc373a141e4e7c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__netTCP__Enums.html#gae7e975a8c916be95da5cf6279aee4909">netTCP_State</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#ga75abc5d6ad7b4007e2bc373a141e4e7c">netTCP_GetState</a> (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>)</td></tr>
<tr class="memdesc:ga75abc5d6ad7b4007e2bc373a141e4e7c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determine current state of a TCP socket. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:ga75abc5d6ad7b4007e2bc373a141e4e7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4bad195ba75c21a5e03a40d13adee3e7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#ga4bad195ba75c21a5e03a40d13adee3e7">netTCP_ResetReceiveWindow</a> (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>)</td></tr>
<tr class="memdesc:ga4bad195ba75c21a5e03a40d13adee3e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset TCP window size to a default value from the configuration. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:ga4bad195ba75c21a5e03a40d13adee3e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga574cc756d0ab2fb8e4719befd7c56913"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#ga574cc756d0ab2fb8e4719befd7c56913">netTCP_SetOption</a> (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>, <a class="el" href="group__netTCP__Enums.html#ga5866dd2ae379ba30a83a9ea1a0c82fdd">netTCP_Option</a> option, uint32_t val)</td></tr>
<tr class="memdesc:ga574cc756d0ab2fb8e4719befd7c56913"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set TCP socket IP option. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:ga574cc756d0ab2fb8e4719befd7c56913"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3ec61c1414074c811541e0181916e3ba"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#ga3ec61c1414074c811541e0181916e3ba">netTCP_GetLocalPort</a> (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>)</td></tr>
<tr class="memdesc:ga3ec61c1414074c811541e0181916e3ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve local port number of TCP socket. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:ga3ec61c1414074c811541e0181916e3ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga460f14a158190632b52c3c1686f390fe"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#ga460f14a158190632b52c3c1686f390fe">netTCP_GetPeer</a> (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>, <a class="el" href="group__network__structs.html#structNET__ADDR">NET_ADDR</a> *addr, uint32_t addr_len)</td></tr>
<tr class="memdesc:ga460f14a158190632b52c3c1686f390fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve IP address and port number of remote peer. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:ga460f14a158190632b52c3c1686f390fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0177787edfb88661613c15cd1d10947a"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tcp__user__api.html#ga0177787edfb88661613c15cd1d10947a">netTCP_GetTimer</a> (int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>)</td></tr>
<tr class="memdesc:ga0177787edfb88661613c15cd1d10947a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determine TCP socket connection timeout. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>].  <br /></td></tr>
<tr class="separator:ga0177787edfb88661613c15cd1d10947a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Description</h2>
<p>TCP Socket functions and communication flow. </p>
<p>TCP operations can be divided into three distinct phases (SYN, SYN-ACK, ACK). All connections must be properly established in this three-step handshake process before any data can be transfered. After the data transfer has finished, the connection termination closes established sockets and releases all allocated resources. The basic communication flow using TCP sockets is shown in this picture:</p>
<div class="image">
<img src="tcp_communication_flow.png" alt=""/>
<div class="caption">
Flow Diagram for TCP Sockets Communication</div></div>
<h2><a class="anchor" id="autotoc_md79"></a>
Connection Establishment</h2>
<p>For establishing a connection, TCP uses a three-way handshake. Before a client can connect to a server, the server must first open a socket for incoming connections (using <a class="el" href="group__tcp__user__api.html#gac02a84a9dc999e80c5a8a1650e5d9674">netTCP_Listen</a>): this is called a passive open. Once the passive open is established, a client may initiate an active open. To establish a connection, the three-way handshake takes place:</p>
<ol type="1">
<li>The active open is performed by the client sending a SYN to the server (using <a class="el" href="group__tcp__user__api.html#ga5dbbfc3def198bfe40ef51629dc55652">netTCP_Connect</a>).</li>
<li>In response, the server replies with an ACK and an own SYN.</li>
<li>Finally, the client sends an ACK back to the server.</li>
</ol>
<p>At this point, a full-duplex communication is established.</p>
<h2><a class="anchor" id="autotoc_md80"></a>
Connection Termination</h2>
<p>The connection can be terminated from each side independently. When an endpoint wishes to stop the connection (by calling <a class="el" href="group__tcp__user__api.html#gad3b70b023f209cd7687f15f553219185">netTCP_Close</a>), it transmits a FIN packet, which the other end acknowledges with an ACK. Therefore, a typical connection close requires a pair of FIN and ACK segments from each TCP endpoint and takes some time. After both FIN/ACK exchanges are concluded, the side that sent the first FIN before receiving one waits for a timeout before finally closing the connection, during which time the local port is unavailable for new connections; this prevents confusion due to delayed packets being delivered during subsequent connections.</p>
<h1><a class="anchor" id="autotoc_md81"></a>
Operation Modes</h1>
<p>The TCP Socket API distinguishes two operation modes: <a class="el" href="group__tcp__user__api.html#tcp_server">Server</a> and <a class="el" href="group__tcp__user__api.html#tcp_client">Client</a>. Both modes have distinct functions that can either be used in the respective mode only or are available for multiple operation modes.</p>
<p><a class="anchor" id="tcp_server"></a></p>
<h1><a class="anchor" id="autotoc_md82"></a>
TCP Server Mode</h1>
<p>The function <a class="el" href="group__tcp__user__api.html#gac02a84a9dc999e80c5a8a1650e5d9674">netTCP_Listen</a> opens a TCP socket on a local port for any incoming connection and starts <b>TCP Server Mode</b>. The next free socket can be allocated using the function <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. This function requires a callback function to be present that is called by the Network Core whenever a TCP event occurs. The TCP Server callback function is inside the module <b>TCP_Socket_Server.c</b>. To add the module to your project, simply right-click on the Source group, select <b>Add New Item to Group</b>, then click on <b>User Code Template</b> and scroll in the template files list until you find the <b>TCP Socket Server</b> template. Customize this module to the application's needs.</p>
<p>It is not allowed to call <a class="el" href="group__tcp__user__api.html#gac02a84a9dc999e80c5a8a1650e5d9674">netTCP_Listen</a> with a port number of <span class="XML-Token">0</span>, because this is a reserved port number. To determine the state of a TCP socket, use <a class="el" href="group__tcp__user__api.html#ga75abc5d6ad7b4007e2bc373a141e4e7c">netTCP_GetState</a>. The user application can monitor the progress when establishing or closing a connection with this function.</p>
<p>As soon as a client requests to connect, the socket/port combination is used for the data transfer. For that, the function <a class="el" href="group__tcp__user__api.html#gad8393d4e967564107799400710c94521">netTCP_GetMaxSegmentSize</a> helps to determine the maximum number of data bytes that can be sent in a TCP packet. Call this function after the remote client is connected. To retrieve information about the client that is connected to the server, use <a class="el" href="group__tcp__user__api.html#ga460f14a158190632b52c3c1686f390fe">netTCP_GetPeer</a> which returns the IP address and port of the connected remote client.</p>
<p>For the data transmission, the functions <a class="el" href="group__tcp__user__api.html#ga361ee211c7cd20ca32c266aec90d60ff">netTCP_GetBuffer</a>, <a class="el" href="group__tcp__user__api.html#ga5770081776ef5a657b984a9ee600c149">netTCP_SendReady</a>, and <a class="el" href="group__tcp__user__api.html#ga0b32a74e8fc2d3d3fcea041d3958f4e6">netTCP_Send</a> are used. The first one allocates memory for the TCP send buffer. The second one checks if the TCP socket is free for sending data, while the third one does the actual transmission.</p>
<p>To instantly stop TCP communication (even during data transmission), use <a class="el" href="group__tcp__user__api.html#ga621b26f6da519678dd6a660fce012668">netTCP_Abort</a>. Use this only for cases, where the transmission really needs to be aborted. Normally, TCP communication will be stopped using <a class="el" href="group__tcp__user__api.html#gad3b70b023f209cd7687f15f553219185">netTCP_Close</a>. In server mode, this does not close the socket, but only ends the active client connection. To fully close the listener socket as well, call <a class="el" href="group__tcp__user__api.html#gad3b70b023f209cd7687f15f553219185">netTCP_Close</a> a second time. In that case, call <a class="el" href="group__tcp__user__api.html#ga20a5311ac374ab89995165de6e1dbe1c">netTCP_ReleaseSocket</a> as well, as this function finally frees the memory used by the TCP socket.</p>
<p><b>Code</b> <b>Example</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rl__net_8h.html">rl_net.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Notify the user application about TCP socket events.</span></div>
<div class="line">uint32_t tcp_cb_func (int32_t <a class="code hl_function" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9" title="Create a communication endpoint called socket. [thread-safe].">socket</a>, <a class="code hl_enumeration" href="group__netTCP__Enums.html#gaecc5852a7c568a7569347007c289b8a5" title="TCP Socket Events.">netTCP_Event</a> event,</div>
<div class="line">                      <span class="keyword">const</span> <a class="code hl_struct" href="group__network__structs.html#structNET__ADDR" title="Network Address IPv4/IPv6 capable.">NET_ADDR</a> *addr, <span class="keyword">const</span> uint8_t *buf, uint32_t len) {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (event) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5ac57525854674d91bfab38bec4d4f5d39" title="Connect request received event.">netTCP_EventConnect</a>:</div>
<div class="line">      <span class="comment">// Connect request received in server mode</span></div>
<div class="line">      <span class="keywordflow">if</span> (addr-&gt;<a class="code hl_variable" href="group__network__structs.html#a0444de3555073772ebd025a838b9a911" title="IP address type: NET_ADDR_IP4 or NET_ADDR_IP6.">addr_type</a> == <a class="code hl_define" href="rl__net_8h.html#ab5ae61a54f36e338a8dc06cee088d89f" title="IPv4 Address.">NET_ADDR_IP4</a>) {</div>
<div class="line">        <span class="comment">// IPv4 client</span></div>
<div class="line">        <span class="keywordflow">if</span> (addr-&gt;<a class="code hl_variable" href="group__network__structs.html#a110c5dd7725b86823c9408661a3f854b" title="IPv4 or IPv6 address (array 16 bytes, MSB first)">addr</a>[0] == 192  &amp;&amp;</div>
<div class="line">            addr-&gt;<a class="code hl_variable" href="group__network__structs.html#a110c5dd7725b86823c9408661a3f854b" title="IPv4 or IPv6 address (array 16 bytes, MSB first)">addr</a>[1] == 168  &amp;&amp;</div>
<div class="line">            addr-&gt;<a class="code hl_variable" href="group__network__structs.html#a110c5dd7725b86823c9408661a3f854b" title="IPv4 or IPv6 address (array 16 bytes, MSB first)">addr</a>[2] == 0    &amp;&amp;</div>
<div class="line">            addr-&gt;<a class="code hl_variable" href="group__network__structs.html#a110c5dd7725b86823c9408661a3f854b" title="IPv4 or IPv6 address (array 16 bytes, MSB first)">addr</a>[3] == 1) {</div>
<div class="line">          <span class="comment">// Accept connection from client at 192.168.0.1</span></div>
<div class="line">          <span class="keywordflow">return</span> (1);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// IPv6 client</span></div>
<div class="line">        <span class="keyword">const</span> uint8_t ip6_addr[<a class="code hl_define" href="rl__net_8h.html#afc2dd6f6b5b737eae868a756d38ed846" title="IPv6 Address Length in bytes.">NET_ADDR_IP6_LEN</a>] = { </div>
<div class="line">                         0xfe, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</div>
<div class="line">                         0x1c, 0x30, 0x6c, 0xff, 0xfe, 0xa2, 0x45, 0x5e };</div>
<div class="line">        <span class="keywordflow">if</span> (memcmp (addr-&gt;<a class="code hl_variable" href="group__network__structs.html#a110c5dd7725b86823c9408661a3f854b" title="IPv4 or IPv6 address (array 16 bytes, MSB first)">addr</a>, ip6_addr, <a class="code hl_define" href="rl__net_8h.html#afc2dd6f6b5b737eae868a756d38ed846" title="IPv6 Address Length in bytes.">NET_ADDR_IP6_LEN</a>) == 0) {</div>
<div class="line">          <span class="comment">// Accept connection from client at [fe80::1c30:6cff:fea2:455e]</span></div>
<div class="line">          <span class="keywordflow">return</span> (1);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// Deny connection.</span></div>
<div class="line">      <span class="keywordflow">return</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a629ba02ae30aceb11ea7b38b165b8033" title="Connection established event.">netTCP_EventEstablished</a>:</div>
<div class="line">      <span class="comment">// Connection established</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5ad25af594ea1f3f94ade5f314eb64cc90" title="Connection was properly closed.">netTCP_EventClosed</a>:</div>
<div class="line">      <span class="comment">// Connection was properly closed</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a05a5eba2a00343b58c23b3b0385dd9e8" title="Connection is for some reason aborted.">netTCP_EventAborted</a>:</div>
<div class="line">      <span class="comment">// Connection is for some reason aborted</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a9827c18f45b65c79d6b2776a610a8af8" title="Previously send data acknowledged.">netTCP_EventACK</a>:</div>
<div class="line">      <span class="comment">// Previously sent data acknowledged</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a19e44f6dd6b1fd6f5f5668b1b050daed" title="Data received event.">netTCP_EventData</a>:</div>
<div class="line">      <span class="comment">// Data received</span></div>
<div class="line">      <span class="keywordflow">if</span> ((buf[0] == 0x01) &amp;&amp; (len == 2)) {</div>
<div class="line">        <span class="comment">// Switch LEDs on and off</span></div>
<div class="line">        <span class="comment">// LED_out (buf[1]);</span></div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Allocate and initialize the socket.</span></div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>) {</div>
<div class="line">  int32_t tcp_sock;</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="group__netSys__Func.html#ga0c68e74df79a37750413f72518f63f73" title="Initialize Network Component and interfaces. [not_thread-safe].">netInitialize</a> ();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Initialize TCP Socket and start listening on port 2000</span></div>
<div class="line">  tcp_sock = <a class="code hl_function" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3" title="Allocate a free TCP socket. [thread-safe].">netTCP_GetSocket</a> (tcp_cb_func);</div>
<div class="line">  <span class="keywordflow">if</span> (tcp_sock &gt;= 0) {</div>
<div class="line">    <a class="code hl_function" href="group__tcp__user__api.html#gac02a84a9dc999e80c5a8a1650e5d9674" title="Open TCP socket for incoming connection. [thread-safe].">netTCP_Listen</a> (tcp_sock, 2000);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="tcp_client"></a></p>
<h1><a class="anchor" id="autotoc_md83"></a>
TCP Client Mode</h1>
<p>The function <a class="el" href="group__tcp__user__api.html#ga5dbbfc3def198bfe40ef51629dc55652">netTCP_Connect</a> initiates a connection to a remote TCP server and starts <b>TCP Client Mode</b>. You need to specify the socket number, the IP address and port of the remote machine and the local port.</p>
<p>If <a class="el" href="group__tcp__user__api.html#ga5dbbfc3def198bfe40ef51629dc55652">netTCP_Connect</a> is called with a local port number of <span class="XML-Token">0</span>, the Network Core determines which port to use. Later, this information can be retrieved using the function <a class="el" href="group__tcp__user__api.html#ga3ec61c1414074c811541e0181916e3ba">netTCP_GetLocalPort</a>. To determine the state of a TCP socket, use <a class="el" href="group__tcp__user__api.html#ga75abc5d6ad7b4007e2bc373a141e4e7c">netTCP_GetState</a>. The user application can monitor the progress when establishing or closing a connection with this function.</p>
<p>As soon as a client requests to connect, the socket/port combination is used for the data transfer. For that, the function <a class="el" href="group__tcp__user__api.html#gad8393d4e967564107799400710c94521">netTCP_GetMaxSegmentSize</a> helps to determine the maximum number of data bytes that can be sent in a TCP packet. Call this function after the client is connected to remote server.</p>
<h2><a class="anchor" id="autotoc_md84"></a>
Sending Data</h2>
<p>To be able to successfully send data via TCP, you first need to request a buffer to be allocated using <a class="el" href="group__tcp__user__api.html#ga361ee211c7cd20ca32c266aec90d60ff">netTCP_GetBuffer</a>. Then, fill the buffer with the data to be sent and send it using <a class="el" href="group__tcp__user__api.html#ga0b32a74e8fc2d3d3fcea041d3958f4e6">netTCP_Send</a>. The buffer will be released by the Network Component automatically. If the buffer is not valid (not allocated with the <a class="el" href="group__tcp__user__api.html#ga361ee211c7cd20ca32c266aec90d60ff">netTCP_GetBuffer</a> function), the buffer is ignored.</p>
<p>The Network Component does not send 0-length packets. So it is possible to release a buffer that has been allocated, by simply calling <a class="el" href="group__tcp__user__api.html#ga0b32a74e8fc2d3d3fcea041d3958f4e6">netTCP_Send</a> with parameter <em>len</em> = 0.</p>
<p>The user code template <b>TCP_Socket_Client.c</b> contains an exemplary send function, called <b>send_data</b>. The send_data function must be implemented as a state machine. It opens an active TCP connection, sends data, and closes the TCP connection at the end. To add the template to your project, simply right-click on the Source group, select <b>Add New Item to Group</b>, then click on <b>User Code Template</b> and scroll in the template files list until you find the <b>TCP Socket Client</b> template. Adapt the <b>send_data</b> function to your application's needs.</p>
<h2><a class="anchor" id="autotoc_md85"></a>
Stopping TCP Communication</h2>
<p>To instantly stop TCP communication (even during data transmission), use <a class="el" href="group__tcp__user__api.html#ga621b26f6da519678dd6a660fce012668">netTCP_Abort</a>. Use this only for cases, where the transmission really needs to be aborted. In client mode, TCP communication will be stopped using <a class="el" href="group__tcp__user__api.html#gad3b70b023f209cd7687f15f553219185">netTCP_Close</a>. The TCP socket will be closed. Subsequently, call <a class="el" href="group__tcp__user__api.html#ga20a5311ac374ab89995165de6e1dbe1c">netTCP_ReleaseSocket</a> as well, as this function finally frees the memory used by the TCP socket.</p>
<p><b>Code</b> <b>Example</b> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rl__net_8h.html">rl_net.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line">int32_t tcp_sock;                       <span class="comment">// TCP socket handle</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Notify the user application about TCP socket events.</span></div>
<div class="line">uint32_t tcp_cb_client (int32_t <a class="code hl_function" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9" title="Create a communication endpoint called socket. [thread-safe].">socket</a>, <a class="code hl_enumeration" href="group__netTCP__Enums.html#gaecc5852a7c568a7569347007c289b8a5" title="TCP Socket Events.">netTCP_Event</a> event,</div>
<div class="line">                        <span class="keyword">const</span> <a class="code hl_struct" href="group__network__structs.html#structNET__ADDR" title="Network Address IPv4/IPv6 capable.">NET_ADDR</a> *addr, <span class="keyword">const</span> uint8_t *buf, uint32_t len) {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (event) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5ac57525854674d91bfab38bec4d4f5d39" title="Connect request received event.">netTCP_EventConnect</a>:</div>
<div class="line">      <span class="comment">// Connect request received in server mode</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a629ba02ae30aceb11ea7b38b165b8033" title="Connection established event.">netTCP_EventEstablished</a>:</div>
<div class="line">      <span class="comment">// Connection established</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5ad25af594ea1f3f94ade5f314eb64cc90" title="Connection was properly closed.">netTCP_EventClosed</a>:</div>
<div class="line">      <span class="comment">// Connection was properly closed</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a05a5eba2a00343b58c23b3b0385dd9e8" title="Connection is for some reason aborted.">netTCP_EventAborted</a>:</div>
<div class="line">      <span class="comment">// Connection is for some reason aborted</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a9827c18f45b65c79d6b2776a610a8af8" title="Previously send data acknowledged.">netTCP_EventACK</a>:</div>
<div class="line">      <span class="comment">// Previously sent data acknowledged</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a19e44f6dd6b1fd6f5f5668b1b050daed" title="Data received event.">netTCP_EventData</a>:</div>
<div class="line">      <span class="comment">// Data received</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Connect to TCP server and send data.</span></div>
<div class="line"><span class="keywordtype">void</span> send_data (<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="comment">// IPv4 address: 192.168.0.1</span></div>
<div class="line">  <a class="code hl_struct" href="group__network__structs.html#structNET__ADDR" title="Network Address IPv4/IPv6 capable.">NET_ADDR</a> addr = { <a class="code hl_define" href="rl__net_8h.html#ab5ae61a54f36e338a8dc06cee088d89f" title="IPv4 Address.">NET_ADDR_IP4</a>, 2000,</div>
<div class="line">                    192, 168, 0, 1 };</div>
<div class="line">  <span class="comment">// IPv6 address: [fe80::1c30:6cff:fea2:455e]</span></div>
<div class="line">  <span class="comment">//NET_ADDR addr = { NET_ADDR_IP6, 2000,</span></div>
<div class="line">  <span class="comment">//                  0xfe, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</span></div>
<div class="line">  <span class="comment">//                  0x1c, 0x30, 0x6c, 0xff, 0xfe, 0xa2, 0x45, 0x5e };</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (tcp_sock &gt;= 0) {</div>
<div class="line">    <span class="keywordflow">switch</span> (<a class="code hl_function" href="group__tcp__user__api.html#ga75abc5d6ad7b4007e2bc373a141e4e7c" title="Determine current state of a TCP socket. [thread-safe].">netTCP_GetState</a> (tcp_sock)) {</div>
<div class="line">      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gae7e975a8c916be95da5cf6279aee4909a3ea9242539eb17194404913082e5aa72" title="Entry is free and unused.">netTCP_StateUNUSED</a>:</div>
<div class="line">      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gae7e975a8c916be95da5cf6279aee4909a9ed355ca936cb40f9520e07109b382be" title="Entry allocated, socket still closed.">netTCP_StateCLOSED</a>:</div>
<div class="line">        <span class="comment">// Connect to TCP socket server on port 2000</span></div>
<div class="line">        <a class="code hl_function" href="group__tcp__user__api.html#ga5dbbfc3def198bfe40ef51629dc55652" title="Initiate a TCP connection to a remote node. [thread-safe].">netTCP_Connect</a> (tcp_sock, &amp;addr, 0);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gae7e975a8c916be95da5cf6279aee4909a7a6f6f71f812f05829226d3d771f77ed" title="TCP Connection established.">netTCP_StateESTABLISHED</a>:</div>
<div class="line">        <span class="comment">// Connected, send the data</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_function" href="group__tcp__user__api.html#ga5770081776ef5a657b984a9ee600c149" title="Check if TCP socket can send data. [thread-safe].">netTCP_SendReady</a> (tcp_sock) == <span class="keyword">true</span>) {</div>
<div class="line">          uint8_t *sendbuf;</div>
<div class="line"> </div>
<div class="line">          sendbuf = <a class="code hl_function" href="group__tcp__user__api.html#ga361ee211c7cd20ca32c266aec90d60ff" title="Allocate memory for TCP send buffer. [thread-safe].">netTCP_GetBuffer</a> (2);</div>
<div class="line">          sendbuf[0] = 0x01;</div>
<div class="line">          sendbuf[1] = 0x55;</div>
<div class="line"> </div>
<div class="line">          <a class="code hl_function" href="group__tcp__user__api.html#ga0b32a74e8fc2d3d3fcea041d3958f4e6" title="Send a data packet to remote node. [thread-safe].">netTCP_Send</a> (tcp_sock, sendbuf, 2);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Allocate and initialize the socket.</span></div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>) {</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="group__netSys__Func.html#ga0c68e74df79a37750413f72518f63f73" title="Initialize Network Component and interfaces. [not_thread-safe].">netInitialize</a> ();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Allocate a free TCP socket.</span></div>
<div class="line">  tcp_sock = <a class="code hl_function" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3" title="Allocate a free TCP socket. [thread-safe].">netTCP_GetSocket</a> (tcp_cb_client);</div>
<div class="line">}</div>
</div><!-- fragment --> <h2 class="groupheader">Typedef Documentation</h2>
<a id="ga9c559a5589c9476028adde1f8e509624" name="ga9c559a5589c9476028adde1f8e509624"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9c559a5589c9476028adde1f8e509624">&#9670;&#160;</a></span>netTCP_cb_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t(* netTCP_cb_t)(int32_t <a class="el" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9">socket</a>, <a class="el" href="group__netTCP__Enums.html#gaecc5852a7c568a7569347007c289b8a5">netTCP_Event</a> event, const <a class="el" href="group__network__structs.html#structNET__ADDR">NET_ADDR</a> *addr, const uint8_t *buf, uint32_t len)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>TCP Event callback function. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>TCP socket handle. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">event</td><td>Event type as shown in the table below (<a class="el" href="group__netTCP__Enums.html#gaecc5852a7c568a7569347007c289b8a5">netTCP_Event</a>). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">addr</td><td>Pointer to the structure containing the remote IP address and port number. <br  />
 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buf</td><td>Pointer to buffer containing the received data. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">len</td><td>Number of bytes in the received packet. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Integer Value used to decide whether to accept or reject an incoming connection (see details).<ul>
<li><b>1</b> - incoming connection accepted.</li>
<li><b>0</b> - incoming connection rejected.</li>
</ul>
</dd></dl>
<p>Is the type definition for the TCP callback function. The Network Core calls the callback function whenever a TCP event occurs.</p>
<p>The argument <em>socket</em> is the TCP socket handle of the local machine.</p>
<p>The argument <em>addr</em> is a pointer to the buffer containing the IP address and port of the remote machine.</p>
<p>The argument <em>event</em> specifies the type of event that occurred as shown in the table below or <a class="el" href="group__netTCP__Enums.html#gaecc5852a7c568a7569347007c289b8a5">netTCP_Event</a>.</p>
<p>The argument <em>buf</em> points to a buffer containing the received data.</p>
<p>The argument <em>len</em> specifies the number of received data bytes.</p>
<p>The Network Core uses the return value of the callback function only when the event is <span class="XML-Token">netTCP_EventConnect</span>. It uses the return value to decide whether to accept or reject an incoming connection when the TCP socket is listening. If the listener function returns <span class="XML-Token">1</span>, then it accepts the incoming connection. If the listener function returns <span class="XML-Token">0</span>, it rejects the incoming connection. Thus, you can define the listener function to selectively reject incoming connections from particular IP addresses.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Event Type   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_EventConnect</span>   </td><td class="markdownTableBodyNone">A Connect Request has been received from a remote client that wants to connect to the server    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_EventEstablished</span>   </td><td class="markdownTableBodyNone">The TCP socket has connected to the remote machine    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_EventClosed</span>   </td><td class="markdownTableBodyNone">The TCP connection has been properly closed    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_EventAbort</span>   </td><td class="markdownTableBodyNone">The TCP connection has been aborted    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_EventACK</span>   </td><td class="markdownTableBodyNone">Acknowledgment has been received from the remote host for the previously sent data    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_EventData</span>   </td><td class="markdownTableBodyNone">A TCP data packet has been received   </td></tr>
</table>
<p><b>Parameter for:</b></p><ul>
<li><a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a></li>
</ul>
<p><b>Code Example TCP Client</b> </p><div class="fragment"><div class="line">uint32_t tcp_cb_func (int32_t <a class="code hl_function" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9" title="Create a communication endpoint called socket. [thread-safe].">socket</a>, <a class="code hl_enumeration" href="group__netTCP__Enums.html#gaecc5852a7c568a7569347007c289b8a5" title="TCP Socket Events.">netTCP_Event</a> event,</div>
<div class="line">                      <span class="keyword">const</span> <a class="code hl_struct" href="group__network__structs.html#structNET__ADDR" title="Network Address IPv4/IPv6 capable.">NET_ADDR</a> *addr, <span class="keyword">const</span> uint8_t *buf, uint32_t len) {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (event) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5ac57525854674d91bfab38bec4d4f5d39" title="Connect request received event.">netTCP_EventConnect</a>:</div>
<div class="line">      <span class="comment">// Connect request received in server mode</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a629ba02ae30aceb11ea7b38b165b8033" title="Connection established event.">netTCP_EventEstablished</a>:</div>
<div class="line">      <span class="comment">// Connection established</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5ad25af594ea1f3f94ade5f314eb64cc90" title="Connection was properly closed.">netTCP_EventClosed</a>:</div>
<div class="line">      <span class="comment">// Connection was properly closed</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a05a5eba2a00343b58c23b3b0385dd9e8" title="Connection is for some reason aborted.">netTCP_EventAborted</a>:</div>
<div class="line">      <span class="comment">// Connection is for some reason aborted</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a9827c18f45b65c79d6b2776a610a8af8" title="Previously send data acknowledged.">netTCP_EventACK</a>:</div>
<div class="line">      <span class="comment">// Previously sent data acknowledged</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a19e44f6dd6b1fd6f5f5668b1b050daed" title="Data received event.">netTCP_EventData</a>:</div>
<div class="line">      <span class="comment">// Data received</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Code Example TCP Server</b> </p><div class="fragment"><div class="line">uint32_t tcp_cb_func (int32_t <a class="code hl_function" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9" title="Create a communication endpoint called socket. [thread-safe].">socket</a>, <a class="code hl_enumeration" href="group__netTCP__Enums.html#gaecc5852a7c568a7569347007c289b8a5" title="TCP Socket Events.">netTCP_Event</a> event,</div>
<div class="line">                      <span class="keyword">const</span> <a class="code hl_struct" href="group__network__structs.html#structNET__ADDR" title="Network Address IPv4/IPv6 capable.">NET_ADDR</a> *addr, <span class="keyword">const</span> uint8_t *buf, uint32_t len) {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (event) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5ac57525854674d91bfab38bec4d4f5d39" title="Connect request received event.">netTCP_EventConnect</a>:</div>
<div class="line">      <span class="comment">// Connect request received in server mode</span></div>
<div class="line">      <span class="keywordflow">if</span> (addr-&gt;<a class="code hl_variable" href="group__network__structs.html#a0444de3555073772ebd025a838b9a911" title="IP address type: NET_ADDR_IP4 or NET_ADDR_IP6.">addr_type</a> == <a class="code hl_define" href="rl__net_8h.html#ab5ae61a54f36e338a8dc06cee088d89f" title="IPv4 Address.">NET_ADDR_IP4</a>) {</div>
<div class="line">        <span class="comment">// IPv4 client</span></div>
<div class="line">        <span class="keywordflow">if</span> (addr-&gt;<a class="code hl_variable" href="group__network__structs.html#a110c5dd7725b86823c9408661a3f854b" title="IPv4 or IPv6 address (array 16 bytes, MSB first)">addr</a>[0] == 192  &amp;&amp;</div>
<div class="line">            addr-&gt;<a class="code hl_variable" href="group__network__structs.html#a110c5dd7725b86823c9408661a3f854b" title="IPv4 or IPv6 address (array 16 bytes, MSB first)">addr</a>[1] == 168  &amp;&amp;</div>
<div class="line">            addr-&gt;<a class="code hl_variable" href="group__network__structs.html#a110c5dd7725b86823c9408661a3f854b" title="IPv4 or IPv6 address (array 16 bytes, MSB first)">addr</a>[2] == 0    &amp;&amp;</div>
<div class="line">            addr-&gt;<a class="code hl_variable" href="group__network__structs.html#a110c5dd7725b86823c9408661a3f854b" title="IPv4 or IPv6 address (array 16 bytes, MSB first)">addr</a>[3] == 1) {</div>
<div class="line">          <span class="comment">// Accept connection from client at 192.168.0.1</span></div>
<div class="line">          <span class="keywordflow">return</span> (1);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// IPv6 client</span></div>
<div class="line">        <span class="keyword">const</span> uint8_t ip6_addr[<a class="code hl_define" href="rl__net_8h.html#afc2dd6f6b5b737eae868a756d38ed846" title="IPv6 Address Length in bytes.">NET_ADDR_IP6_LEN</a>] = { </div>
<div class="line">                         0xfe, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</div>
<div class="line">                         0x1c, 0x30, 0x6c, 0xff, 0xfe, 0xa2, 0x45, 0x5e };</div>
<div class="line">        <span class="keywordflow">if</span> (memcmp (addr-&gt;<a class="code hl_variable" href="group__network__structs.html#a110c5dd7725b86823c9408661a3f854b" title="IPv4 or IPv6 address (array 16 bytes, MSB first)">addr</a>, ip6_addr, <a class="code hl_define" href="rl__net_8h.html#afc2dd6f6b5b737eae868a756d38ed846" title="IPv6 Address Length in bytes.">NET_ADDR_IP6_LEN</a>) == 0) {</div>
<div class="line">          <span class="comment">// Accept connection from client at [fe80::1c30:6cff:fea2:455e]</span></div>
<div class="line">          <span class="keywordflow">return</span> (1);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// Deny connection.</span></div>
<div class="line">      <span class="keywordflow">return</span> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a629ba02ae30aceb11ea7b38b165b8033" title="Connection established event.">netTCP_EventEstablished</a>:</div>
<div class="line">      <span class="comment">// Connection established</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5ad25af594ea1f3f94ade5f314eb64cc90" title="Connection was properly closed.">netTCP_EventClosed</a>:</div>
<div class="line">      <span class="comment">// Connection was properly closed</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a05a5eba2a00343b58c23b3b0385dd9e8" title="Connection is for some reason aborted.">netTCP_EventAborted</a>:</div>
<div class="line">      <span class="comment">// Connection is for some reason aborted</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a9827c18f45b65c79d6b2776a610a8af8" title="Previously send data acknowledged.">netTCP_EventACK</a>:</div>
<div class="line">      <span class="comment">// Previously sent data acknowledged</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a19e44f6dd6b1fd6f5f5668b1b050daed" title="Data received event.">netTCP_EventData</a>:</div>
<div class="line">      <span class="comment">// Data received</span></div>
<div class="line">      <span class="keywordflow">if</span> ((buf[0] == 0x01) &amp;&amp; (len == 2)) {</div>
<div class="line">        <span class="comment">// Switch LEDs on and off</span></div>
<div class="line">        <span class="comment">// LED_SetOut (buf[1]);</span></div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga621b26f6da519678dd6a660fce012668" name="ga621b26f6da519678dd6a660fce012668"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga621b26f6da519678dd6a660fce012668">&#9670;&#160;</a></span>netTCP_Abort()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> netTCP_Abort </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Instantly stop TCP communication. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>socket handle obtained with <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status code that indicates the execution status of the function.</dd></dl>
<p>The function <b>netTCP_Abort</b> closes the TCP connection immediately by sending a TCP frame with the RESET flag set to the remote machine.</p>
<p>The argument <em>socket</em> specifies the handle of the socket.</p>
<p>The Network Core calls the listener callback function only when a remote peer has aborted the connection. If the aborted socket is initiated locally by calling <b>netTCP_Abort</b>, then the callback function is not called.</p>
<p>Possible <a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> return values:</p><ul>
<li><em>netOK:</em> Socket aborted successfully.</li>
<li><em>netInvalidParameter:</em> Invalid socket requested.</li>
<li><em>netWrongState:</em> Socket in invalid state.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>After calling <b>netTCP_Abort</b> you cannot use the socket to send or receive any data. The socket remains allocated until you release it.</dd></dl>
<p><b>Code</b> <b>Example</b> (see <a class="el" href="group__tcp__user__api.html#ga20a5311ac374ab89995165de6e1dbe1c">netTCP_ReleaseSocket</a>) </p>

</div>
</div>
<a id="gad3b70b023f209cd7687f15f553219185" name="gad3b70b023f209cd7687f15f553219185"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad3b70b023f209cd7687f15f553219185">&#9670;&#160;</a></span>netTCP_Close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> netTCP_Close </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stop TCP communication and start closing procedure. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>socket handle obtained with <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status code that indicates the execution status of the function.</dd></dl>
<p>The function <b>netTCP_Close</b> initiates the procedure to close the TCP connection. It might take some time to close the connection.</p>
<p>The argument <em>socket</em> specifies the socket handle.</p>
<p>The Network Core calls the listener callback function only when a remote peer has closed the connection. If the socket is closed locally by calling <b>netTCP_Close</b>, then the callback function is not called.</p>
<p>When a socket is used in the <a class="el" href="group__tcp__user__api.html#gac02a84a9dc999e80c5a8a1650e5d9674">netTCP_Listen</a> functions, the socket does not close by calling <b>netTCP_Close</b>. Only the active connection is closed, and the socket will be available for new incoming connection. To close such a socket, the function <b>netTCP_Close</b> needs to be called twice.</p>
<p>Possible <a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> return values:</p><ul>
<li><em>netOK:</em> Socket closing successfully started.</li>
<li><em>netInvalidParameter:</em> Invalid socket requested.</li>
<li><em>netWrongState:</em> Socket in invalid state.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>After calling <b>netTCP_Close</b> the socket still remains allocated until you release it.</dd></dl>
<p><b>Code</b> <b>Example</b> </p><div class="fragment"><div class="line"><a class="code hl_enumeration" href="group__netTCP__Enums.html#gae7e975a8c916be95da5cf6279aee4909" title="TCP Socket States.">netTCP_State</a> state;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This TCP connection is no longer needed</span></div>
<div class="line"><a class="code hl_function" href="group__tcp__user__api.html#gad3b70b023f209cd7687f15f553219185" title="Stop TCP communication and start closing procedure. [thread-safe].">netTCP_Close</a> (tcp_sock);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Wait for the socket to close</span></div>
<div class="line"><span class="keywordflow">for</span> (;;) {</div>
<div class="line">  state = <a class="code hl_function" href="group__tcp__user__api.html#ga75abc5d6ad7b4007e2bc373a141e4e7c" title="Determine current state of a TCP socket. [thread-safe].">netTCP_GetState</a> (tcp_sock);</div>
<div class="line">  <span class="keywordflow">if</span> (state &lt; <a class="code hl_enumvalue" href="rl__net_8h.html#gae7e975a8c916be95da5cf6279aee4909a1e118c11029f13d101341c36d7835a3a" title="Socket waiting for incoming connection.">netTCP_StateLISTEN</a>) {</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (state == <a class="code hl_enumvalue" href="rl__net_8h.html#gae7e975a8c916be95da5cf6279aee4909a1e118c11029f13d101341c36d7835a3a" title="Socket waiting for incoming connection.">netTCP_StateLISTEN</a>) [</div>
<div class="line">    <span class="comment">// Socket is in server mode, needs additional close request</span></div>
<div class="line">    <a class="code hl_function" href="group__tcp__user__api.html#gad3b70b023f209cd7687f15f553219185" title="Stop TCP communication and start closing procedure. [thread-safe].">netTCP_Close</a> (tcp_sock);</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">// Pass control to other threads</span></div>
<div class="line">  osDelay (10);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// A socket is in netTCP_StateCLOSED state now</span></div>
<div class="line"><a class="code hl_function" href="group__tcp__user__api.html#ga20a5311ac374ab89995165de6e1dbe1c" title="Release TCP socket and free resources. [thread-safe].">netTCP_ReleaseSocket</a> (tcp_sock);</div>
</div><!-- fragment --> 
</div>
</div>
<a id="ga5dbbfc3def198bfe40ef51629dc55652" name="ga5dbbfc3def198bfe40ef51629dc55652"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5dbbfc3def198bfe40ef51629dc55652">&#9670;&#160;</a></span>netTCP_Connect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> netTCP_Connect </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__network__structs.html#structNET__ADDR">NET_ADDR</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>local_port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initiate a TCP connection to a remote node. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>socket handle obtained with <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">addr</td><td>structure containing remote IP address and port. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">local_port</td><td>local port number.<ul>
<li>0 = system assigned local port. </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status code that indicates the execution status of the function.</dd></dl>
<p>The function <b>netTCP_Connect</b> initiates a connection to a remote server.</p>
<p>The argument <em>socket</em> is a socket handle on the local machine for communicating.</p>
<p>The argument <em>addr</em> points to the buffer containing the IP address and port of the remote socket server.</p>
<p>The argument <em>local_port</em> specifies the port on the local machine. If <em>local_port</em> is set to <span class="XML-Token">0</span>, then the Network Core allocates the first free TCP port automatically. If you need the port number later, use <a class="el" href="group__tcp__user__api.html#ga3ec61c1414074c811541e0181916e3ba">netTCP_GetLocalPort</a> to retrieve this information.</p>
<p>Possible <a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> return values:</p><ul>
<li><em>netOK:</em> Connection initiated successfully.</li>
<li><em>netInvalidParameter:</em> Invalid parameter provided.</li>
<li><em>netWrongState:</em> Socket not closed.</li>
</ul>
<p><b>Code</b> <b>Example</b> <b>IPv4</b> </p><div class="fragment"><div class="line"><span class="comment">// IPv4 address: 192.168.0.1</span></div>
<div class="line"><a class="code hl_struct" href="group__network__structs.html#structNET__ADDR4" title="Network Address IPv4 only.">NET_ADDR4</a> addr = { <a class="code hl_define" href="rl__net_8h.html#ab5ae61a54f36e338a8dc06cee088d89f" title="IPv4 Address.">NET_ADDR_IP4</a>, 2000, 192, 168, 0, 1 };</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__tcp__user__api.html#ga5dbbfc3def198bfe40ef51629dc55652" title="Initiate a TCP connection to a remote node. [thread-safe].">netTCP_Connect</a> (tcp_sock, (<a class="code hl_struct" href="group__network__structs.html#structNET__ADDR" title="Network Address IPv4/IPv6 capable.">NET_ADDR</a> *)&amp;addr, 0);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Wait for the socket to connect </span></div>
<div class="line"><span class="keywordflow">for</span> (;;) {</div>
<div class="line">  <span class="keywordflow">switch</span> (<a class="code hl_function" href="group__tcp__user__api.html#ga75abc5d6ad7b4007e2bc373a141e4e7c" title="Determine current state of a TCP socket. [thread-safe].">netTCP_GetState</a> (tcp_sock)) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gae7e975a8c916be95da5cf6279aee4909a3ea9242539eb17194404913082e5aa72" title="Entry is free and unused.">netTCP_StateUNUSED</a>:</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gae7e975a8c916be95da5cf6279aee4909a9ed355ca936cb40f9520e07109b382be" title="Entry allocated, socket still closed.">netTCP_StateCLOSED</a>:</div>
<div class="line">      <span class="comment">// Failed to connect to TCP socket server</span></div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gae7e975a8c916be95da5cf6279aee4909a7a6f6f71f812f05829226d3d771f77ed" title="TCP Connection established.">netTCP_StateESTABLISHED</a>:</div>
<div class="line">      <span class="comment">// Connected, socket is ready to send data</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">// Pass control to other threads</span></div>
<div class="line">  osDelay (10);</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Code</b> <b>Example</b> <b>IPv6</b> </p><div class="fragment"><div class="line"><span class="comment">// IPv6 address: [fe80::1c30:6cff:fea2:455e]</span></div>
<div class="line"><a class="code hl_struct" href="group__network__structs.html#structNET__ADDR" title="Network Address IPv4/IPv6 capable.">NET_ADDR</a> addr = { <a class="code hl_define" href="rl__net_8h.html#a5af8b5fa13b653a73d397cabe75ca4bb" title="IPv6 Address.">NET_ADDR_IP6</a>, 2000,</div>
<div class="line">                  0xfe, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</div>
<div class="line">                  0x1c, 0x30, 0x6c, 0xff, 0xfe, 0xa2, 0x45, 0x5e };</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__tcp__user__api.html#ga5dbbfc3def198bfe40ef51629dc55652" title="Initiate a TCP connection to a remote node. [thread-safe].">netTCP_Connect</a> (tcp_sock, &amp;addr, 0);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Wait for the socket to connect </span></div>
<div class="line"><span class="keywordflow">for</span> (;;) {</div>
<div class="line">  <span class="keywordflow">switch</span> (<a class="code hl_function" href="group__tcp__user__api.html#ga75abc5d6ad7b4007e2bc373a141e4e7c" title="Determine current state of a TCP socket. [thread-safe].">netTCP_GetState</a> (tcp_sock)) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gae7e975a8c916be95da5cf6279aee4909a3ea9242539eb17194404913082e5aa72" title="Entry is free and unused.">netTCP_StateUNUSED</a>:</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gae7e975a8c916be95da5cf6279aee4909a9ed355ca936cb40f9520e07109b382be" title="Entry allocated, socket still closed.">netTCP_StateCLOSED</a>:</div>
<div class="line">      <span class="comment">// Failed to connect to TCP socket server</span></div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gae7e975a8c916be95da5cf6279aee4909a7a6f6f71f812f05829226d3d771f77ed" title="TCP Connection established.">netTCP_StateESTABLISHED</a>:</div>
<div class="line">      <span class="comment">// Connected, socket is ready to send data</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">// Pass control to other threads</span></div>
<div class="line">  osDelay (10);</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a id="ga361ee211c7cd20ca32c266aec90d60ff" name="ga361ee211c7cd20ca32c266aec90d60ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga361ee211c7cd20ca32c266aec90d60ff">&#9670;&#160;</a></span>netTCP_GetBuffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t * netTCP_GetBuffer </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate memory for TCP send buffer. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>number of bytes to allocate. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to the allocated memory.<ul>
<li>NULL = out of memory.</li>
</ul>
</dd></dl>
<p>The function <b>netTCP_GetBuffer</b> allocates memory for the TCP send buffer into which your application can write the outgoing data packet.</p>
<p>The argument <em>size</em> specifies the number of data bytes that the application wants to send.</p>
<p>After the TCP frame has been sent and an acknowledgment has been received from the remote host, the Network Core automatically de-allocates the memory used by the send buffer in the <a class="el" href="group__tcp__user__api.html#ga0b32a74e8fc2d3d3fcea041d3958f4e6">netTCP_Send</a> function.</p>
<p>A default Maximum Segment Size (MSS) of 1440 bytes is defined at start-up. However, when establishing a connection with a remote machine, the Network Core might negotiate a different (smaller) value for MSS. Use <a class="el" href="group__tcp__user__api.html#gad8393d4e967564107799400710c94521">netTCP_GetMaxSegmentSize</a> to check the available MSS for the current connection.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Your application must call the <b>netTCP_GetBuffer</b> function each time it wants to send a TCP data packet.</li>
<li>The size of the allocated memory must not exceed the TCP Maximum Segment Size (1440 bytes).</li>
<li>Writing more data than the allocated <em>size</em> of the data buffer overwrites the Memory Manager Block links and causes the Network Core to crash.</li>
</ul>
</dd></dl>
<p><b>Code</b> <b>Example</b> (see <a class="el" href="group__tcp__user__api.html#ga0b32a74e8fc2d3d3fcea041d3958f4e6">netTCP_Send</a>) </p>

</div>
</div>
<a id="ga3ec61c1414074c811541e0181916e3ba" name="ga3ec61c1414074c811541e0181916e3ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3ec61c1414074c811541e0181916e3ba">&#9670;&#160;</a></span>netTCP_GetLocalPort()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t netTCP_GetLocalPort </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve local port number of TCP socket. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>socket handle obtained with <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>local port number.<ul>
<li>0 = socket invalid or in invalid state.</li>
</ul>
</dd></dl>
<p>The function <b>netTCP_GetLocalPort</b> returns the local TCP port that is used for a specific <em>socket</em>. This is useful if you have not specified a port in the function <a class="el" href="group__tcp__user__api.html#ga5dbbfc3def198bfe40ef51629dc55652">netTCP_Connect</a>, as the system sets the port automatically then.</p>
<p>The argument <em>socket</em> specifies the local socket handle that is to be used.</p>
<p><b>Code</b> <b>Example</b> </p><div class="fragment"><div class="line">int32_t tcp_sock;</div>
<div class="line"> </div>
<div class="line">tcp_sock = <a class="code hl_function" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3" title="Allocate a free TCP socket. [thread-safe].">netTCP_GetSocket</a> (tcp_cb_func);</div>
<div class="line"><span class="keywordflow">if</span> (tcp_sock &gt;= 0) {</div>
<div class="line">  <a class="code hl_function" href="group__tcp__user__api.html#ga5dbbfc3def198bfe40ef51629dc55652" title="Initiate a TCP connection to a remote node. [thread-safe].">netTCP_Connect</a> (tcp_sock, addr, 0);</div>
<div class="line">  printf (<span class="stringliteral">&quot;Local port is %d\n&quot;</span>, <a class="code hl_function" href="group__tcp__user__api.html#ga3ec61c1414074c811541e0181916e3ba" title="Retrieve local port number of TCP socket. [thread-safe].">netTCP_GetLocalPort</a> (tcp_sock));</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a id="gad8393d4e967564107799400710c94521" name="gad8393d4e967564107799400710c94521"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad8393d4e967564107799400710c94521">&#9670;&#160;</a></span>netTCP_GetMaxSegmentSize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t netTCP_GetMaxSegmentSize </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Determine maximum number of data bytes that can be sent in TCP packet. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>socket handle obtained with <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>maximum segment size in bytes.</dd></dl>
<p>The function <b>netTCP_GetMaxSegmentSize</b> determines the maximum number of bytes that can be sent in the TCP packet (Maximum Segment Size).</p>
<p>The argument <em>socket</em> specifies the handle of the TCP socket.</p>
<p>A default Maximum Segment Size (MSS) of 1440 bytes is defined at start-up. However, when establishing a connection with a remote machine, the Network Core might negotiate a different (smaller) value for MSS.</p>
<dl class="section note"><dt>Note</dt><dd>This function can only be called after establishing a connection using the functions <a class="el" href="group__tcp__user__api.html#gac02a84a9dc999e80c5a8a1650e5d9674">netTCP_Listen</a> or <a class="el" href="group__tcp__user__api.html#ga5dbbfc3def198bfe40ef51629dc55652">netTCP_Connect</a>.</dd></dl>
<p><b>Code</b> <b>Example</b> (see <a class="el" href="group__tcp__user__api.html#ga0b32a74e8fc2d3d3fcea041d3958f4e6">netTCP_Send</a>) </p>

</div>
</div>
<a id="ga460f14a158190632b52c3c1686f390fe" name="ga460f14a158190632b52c3c1686f390fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga460f14a158190632b52c3c1686f390fe">&#9670;&#160;</a></span>netTCP_GetPeer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> netTCP_GetPeer </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__network__structs.html#structNET__ADDR">NET_ADDR</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>addr_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve IP address and port number of remote peer. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>socket handle obtained with <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">addr</td><td>structure that will receive IP address and port number. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">addr_len</td><td>size of <a class="el" href="group__network__structs.html#structNET__ADDR" title="Network Address IPv4/IPv6 capable.">NET_ADDR</a> structure for remote peer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status code that indicates the execution status of the function.</dd></dl>
<p>The function <b>netTCP_GetPeer</b> provides the IP address and port of the remote client that is connected.</p>
<p>The argument <em>socket</em> specifies the local socket handle that is to be used.</p>
<p>The argument <em>addr</em> points to the buffer where the IP address and port of the remote machine will be stored.</p>
<p>The argument <em>addr_len</em> specifies the length of the <em>addr</em> structure. The Network Core checks the length, if the library can store the IP address of the remote peer into the structure. The IP address contains an IPv4 or IPv6 address.</p>
<p>Possible <a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> return values:</p><ul>
<li><em>netOK:</em> Operation completed successfully.</li>
<li><em>netInvalidParameter:</em> Invalid parameter provided.</li>
<li><em>netWrongState:</em> Socket connection not established.</li>
</ul>
<p><b>Code</b> <b>Example</b> </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__network__structs.html#structNET__ADDR" title="Network Address IPv4/IPv6 capable.">NET_ADDR</a> peer;</div>
<div class="line"><span class="keywordtype">char</span> ip_ascii[40];</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__tcp__user__api.html#ga460f14a158190632b52c3c1686f390fe" title="Retrieve IP address and port number of remote peer. [thread-safe].">netTCP_GetPeer</a> (tcp_sock, &amp;peer, <span class="keyword">sizeof</span>(peer));</div>
<div class="line"><a class="code hl_function" href="group__netGen__AddrConvFunc.html#ga546c7611025489af14f2b37dbda445c2" title="Convert IP address from binary to text form. [thread-safe].">netIP_ntoa</a> (peer.<a class="code hl_variable" href="group__network__structs.html#a0444de3555073772ebd025a838b9a911" title="IP address type: NET_ADDR_IP4 or NET_ADDR_IP6.">addr_type</a>, peer.<a class="code hl_variable" href="group__network__structs.html#a110c5dd7725b86823c9408661a3f854b" title="IPv4 or IPv6 address (array 16 bytes, MSB first)">addr</a>, ip_ascii, sizeof (ip_ascii));</div>
<div class="line">printf (<span class="stringliteral">&quot;Peer address: %s\n&quot;</span>, ip_ascii);</div>
<div class="line">printf (<span class="stringliteral">&quot;Peer port: %d\n&quot;</span>, peer.<a class="code hl_variable" href="group__network__structs.html#a8e0798404bf2cf5dabb84c5ba9a4f236" title="Internet socket port number.">port</a>);</div>
</div><!-- fragment --> 
</div>
</div>
<a id="ga19247901cf1062d474d767ac68277ed3" name="ga19247901cf1062d474d767ac68277ed3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga19247901cf1062d474d767ac68277ed3">&#9670;&#160;</a></span>netTCP_GetSocket()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t netTCP_GetSocket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__tcp__user__api.html#ga9c559a5589c9476028adde1f8e509624">netTCP_cb_t</a>&#160;</td>
          <td class="paramname"><em>cb_func</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate a free TCP socket. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cb_func</td><td>event listening callback function. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>socket handle number or execution status:<ul>
<li>value &gt;= 0: socket handle number.</li>
<li>value &lt; 0: error occurred, -value is execution status as defined with <a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a>.</li>
</ul>
</dd></dl>
<p>The function <b>netTCP_GetSocket</b> allocates a free TCP socket. The function initializes all the state variables of the TCP socket to the default state.</p>
<p>The argument <em>cb_func</em> is the event callback function of the TCP socket. The Network Core calls this function whenever a TCP event occurs. Refer to <a class="el" href="group__tcp__user__api.html#ga9c559a5589c9476028adde1f8e509624">netTCP_cb_t</a>.</p>
<p>Possible <a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> return values:</p><ul>
<li><em>netInvalidParameter:</em> Callback function not valid.</li>
<li><em>netError:</em> No free sockets available.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>You must call the <b>netTCP_GetSocket</b> function before any other function calls to the TCP socket.</li>
<li>You must define the listener function to use with the TCP socket.</li>
</ul>
</dd></dl>
<p><b>Code</b> <b>Example</b> </p><div class="fragment"><div class="line">int32_t tcp_sock;</div>
<div class="line"> </div>
<div class="line">uint32_t tcp_cb_func (int32_t <a class="code hl_function" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9" title="Create a communication endpoint called socket. [thread-safe].">socket</a>, <a class="code hl_enumeration" href="group__netTCP__Enums.html#gaecc5852a7c568a7569347007c289b8a5" title="TCP Socket Events.">netTCP_Event</a> event,</div>
<div class="line">                      <span class="keyword">const</span> <a class="code hl_struct" href="group__network__structs.html#structNET__ADDR" title="Network Address IPv4/IPv6 capable.">NET_ADDR</a> *addr, <span class="keyword">const</span> uint8_t *buf, uint32_t len) {</div>
<div class="line">   .. </div>
<div class="line">  <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Allocate a free TCP socket</span></div>
<div class="line">tcp_sock = <a class="code hl_function" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3" title="Allocate a free TCP socket. [thread-safe].">netTCP_GetSocket</a> (tcp_cb_func);</div>
<div class="line"><span class="keywordflow">if</span> (tcp_sock &lt; 0) {</div>
<div class="line">  printf (<span class="stringliteral">&quot;Get socket failed.\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a id="ga75abc5d6ad7b4007e2bc373a141e4e7c" name="ga75abc5d6ad7b4007e2bc373a141e4e7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga75abc5d6ad7b4007e2bc373a141e4e7c">&#9670;&#160;</a></span>netTCP_GetState()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__netTCP__Enums.html#gae7e975a8c916be95da5cf6279aee4909">netTCP_State</a> netTCP_GetState </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Determine current state of a TCP socket. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>socket handle obtained with <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>state information as defined with <a class="el" href="group__netTCP__Enums.html#gae7e975a8c916be95da5cf6279aee4909">netTCP_State</a>.</dd></dl>
<p>The function <b>netTCP_GetState</b> determines the current state of the TCP socket. The application can monitor the progress when establishing or closing a connection with this function. The most useful state values are <span class="XML-Token">netTCP_StateCLOSED</span>, <span class="XML-Token">netTCP_StateLISTEN</span>, and <span class="XML-Token">netTCP_StateESTABLISHED</span>.</p>
<p>The argument <em>socket</em> specifies the socket handle.</p>
<p>The <b>netTCP_GetState</b> function returns the current state of the TCP socket: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">State   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_StateINVALID</span>   </td><td class="markdownTableBodyNone">Socket is not available (not in the range of sockets specified in the <b>NET_Config_TCP.h</b> file).    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_StateUNUSED</span>   </td><td class="markdownTableBodyNone">Socket is free and not allocated yet. The function cannot return this value.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_StateCLOSED</span>   </td><td class="markdownTableBodyNone">Socket is allocated to an application but the connection is closed.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_StateLISTEN</span>   </td><td class="markdownTableBodyNone">Socket is listening for incoming connections.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_StateSYN_RECEIVED</span>   </td><td class="markdownTableBodyNone">Socket has received a TCP packet with the flag SYN set.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_StateSYN_SENT</span>   </td><td class="markdownTableBodyNone">Socket has sent a TCP packet with the flag SYN set.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_StateFIN_WAIT_1</span>   </td><td class="markdownTableBodyNone">Socket has sent a FIN packet, to start the closing of the connection.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_StateFIN_WAIT_2</span>   </td><td class="markdownTableBodyNone">Socket has received acknowledgment from the remote machine for the FIN packet it sent out from the local machine. Socket is now waiting for a FIN packet from the remote machine.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_StateCLOSING</span>   </td><td class="markdownTableBodyNone">Socket has received a FIN packet from the remote machine independently    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_StateLAST_ACK</span>   </td><td class="markdownTableBodyNone">Socket is waiting for the last ACK packet to the FIN packet it sent out.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_StateTIME_WAIT</span>   </td><td class="markdownTableBodyNone">Socket is waiting on a 2 MSS timeout before closing the connection.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_StateESTABLISHED</span>   </td><td class="markdownTableBodyNone">Socket has established a TCP connection. You can transfer data only in this state.   </td></tr>
</table>
<p><b>Code</b> <b>Example</b> (see <a class="el" href="group__tcp__user__api.html#ga5dbbfc3def198bfe40ef51629dc55652">netTCP_Connect</a>) </p>

</div>
</div>
<a id="ga0177787edfb88661613c15cd1d10947a" name="ga0177787edfb88661613c15cd1d10947a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0177787edfb88661613c15cd1d10947a">&#9670;&#160;</a></span>netTCP_GetTimer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t netTCP_GetTimer </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Determine TCP socket connection timeout. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>socket handle obtained with <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>connection timeout timer in seconds.<ul>
<li>0 = socket invalid or in invalid state.</li>
</ul>
</dd></dl>
<p>The function <b>netTCP_GetTimer</b> returns the timer value of a time out or the current keep alive value. When the time out expires, the Network Core will either close the <em>socket</em>, or send a keep-alive frame.</p>
<p>The argument <em>socket</em> specifies the local socket handle that is to be used.</p>
<p><b>Code</b> <b>Example</b> </p><div class="fragment"><div class="line">printf (<span class="stringliteral">&quot;Socket %d will close in %d seconds\n&quot;</span>, <a class="code hl_function" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9" title="Create a communication endpoint called socket. [thread-safe].">socket</a>, <a class="code hl_function" href="group__tcp__user__api.html#ga0177787edfb88661613c15cd1d10947a" title="Determine TCP socket connection timeout. [thread-safe].">netTCP_GetTimer</a> (<a class="code hl_function" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9" title="Create a communication endpoint called socket. [thread-safe].">socket</a>));</div>
</div><!-- fragment --> 
</div>
</div>
<a id="gac02a84a9dc999e80c5a8a1650e5d9674" name="gac02a84a9dc999e80c5a8a1650e5d9674"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac02a84a9dc999e80c5a8a1650e5d9674">&#9670;&#160;</a></span>netTCP_Listen()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> netTCP_Listen </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open TCP socket for incoming connection. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>socket handle obtained with <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">port</td><td>local port number. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status code that indicates the execution status of the function.</dd></dl>
<p>The function <b>netTCP_Listen</b> opens a socket for incoming connections by causing the socket to listen at a local TCP port.</p>
<p>The argument <em>socket</em> specifies the socket handle to listen on the local machine.</p>
<p>The argument <em>port</em> specifies the TCP port number to listen at. If the argument <em>port</em> is <span class="XML-Token">0</span>, the function returns error, because this port is reserved. If you need the port number later, use <a class="el" href="group__tcp__user__api.html#ga3ec61c1414074c811541e0181916e3ba">netTCP_GetLocalPort</a> to retrieve this information.</p>
<p>Possible <a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> return values:</p><ul>
<li><em>netOK:</em> Socket opened successfully.</li>
<li><em>netInvalidParameter:</em> Invalid parameter provided.</li>
<li><em>netWrongState:</em> Socket not closed.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Server applications (such as Telnet and HTTP server) must open a TCP socket for listening.</dd></dl>
<p><b>Code</b> <b>Example</b> </p><div class="fragment"><div class="line">int32_t tcp_sock;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize TCP Socket and start listening on port 2000</span></div>
<div class="line">tcp_sock = <a class="code hl_function" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3" title="Allocate a free TCP socket. [thread-safe].">netTCP_GetSocket</a> (tcp_cb_func);</div>
<div class="line"><span class="keywordflow">if</span> (tcp_sock &gt;= 0) {</div>
<div class="line">  <a class="code hl_function" href="group__tcp__user__api.html#gac02a84a9dc999e80c5a8a1650e5d9674" title="Open TCP socket for incoming connection. [thread-safe].">netTCP_Listen</a> (tcp_sock, 2000);</div>
<div class="line">}</div>
<div class="line"> ..</div>
</div><!-- fragment --> 
</div>
</div>
<a id="ga20a5311ac374ab89995165de6e1dbe1c" name="ga20a5311ac374ab89995165de6e1dbe1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga20a5311ac374ab89995165de6e1dbe1c">&#9670;&#160;</a></span>netTCP_ReleaseSocket()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> netTCP_ReleaseSocket </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release TCP socket and free resources. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>socket handle obtained with <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status code that indicates the execution status of the function.</dd></dl>
<p>The function <b>netTCP_ReleaseSocket</b> de-allocates the memory used by the TCP socket.</p>
<p>The argument <em>socket</em> specifies the handle of the socket to be released.</p>
<p>Possible <a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> return values:</p><ul>
<li><em>netOK:</em> Socket released successfully.</li>
<li><em>netInvalidParameter:</em> Invalid socket requested.</li>
<li><em>netWrongState:</em> Socket not closed.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>You must call the <b>netTCP_ReleaseSocket</b> function when you do not need the TCP socket any longer.</li>
<li>After calling <b>netTCP_ReleaseSocket</b> the socket is free to be used by another process.</li>
</ul>
</dd></dl>
<p><b>Code</b> <b>Example</b> </p><div class="fragment"><div class="line"><span class="comment">// This TCP connection needs to close immediately</span></div>
<div class="line"><a class="code hl_function" href="group__tcp__user__api.html#ga621b26f6da519678dd6a660fce012668" title="Instantly stop TCP communication. [thread-safe].">netTCP_Abort</a> (tcp_sock);</div>
<div class="line"><span class="comment">// Socket will not be needed any more</span></div>
<div class="line"><a class="code hl_function" href="group__tcp__user__api.html#ga20a5311ac374ab89995165de6e1dbe1c" title="Release TCP socket and free resources. [thread-safe].">netTCP_ReleaseSocket</a> (tcp_sock);</div>
</div><!-- fragment --> 
</div>
</div>
<a id="ga4bad195ba75c21a5e03a40d13adee3e7" name="ga4bad195ba75c21a5e03a40d13adee3e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4bad195ba75c21a5e03a40d13adee3e7">&#9670;&#160;</a></span>netTCP_ResetReceiveWindow()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> netTCP_ResetReceiveWindow </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset TCP window size to a default value from the configuration. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>socket handle obtained with <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status code that indicates the execution status of the function.</dd></dl>
<p>The function <b>netTCP_ResetReceiveWindow</b> resets the TCP window size to a default value defined with <code>TCP_RECEIVE_WIN_SIZE</code> macro in the <b>Net_Config_TCP.h</b> file.</p>
<p>The argument <em>socket</em> specifies the handle of the socket for which to reset the window size.</p>
<p>This function can only be used with sockets that have a TCP flow control enabled. Enable a TCP flow control for the socket by calling the <a class="el" href="group__tcp__user__api.html#ga574cc756d0ab2fb8e4719befd7c56913">netTCP_SetOption</a> function with the <span class="XML-Token">netTCP_OptionFlowControl</span> enabled. This socket option enables using a Sliding Window protocol in receive.</p>
<p>In Flow Control mode, each received data packet reduces the receiving Window Size by the number of data bytes received in the packet. Soon the window size becomes very small or 0. The remote host stops sending data and waits for a window update. As soon as the received data is processed, we can call a <b>netTCP_ResetReceiveWindow</b> function to reopen the receiver window for further incoming data.</p>
<p>Depending on the context from where this function was called, it performs the following actions:</p><ul>
<li>resets the window size of the socket and returns if called from the callback function. The window size is actually changed in the acknowledge packet generated by the Network Core when the callback function returns.</li>
<li>resets the window size and sends out a Window Update packet if called from the other part of the user application.</li>
<li>does nothing if the socket is not in <span class="XML-Token">netTCP_StateESTABLISHED</span> state and the <span class="XML-Token">netTCP_OptionFlowControl</span> option is not set.</li>
</ul>
<p>Possible <a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> return values:</p><ul>
<li><em>netOK:</em> Receive window reset successfully.</li>
<li><em>netInvalidParameter:</em> Invalid socket requested or flow control not enabled.</li>
<li><em>netWrongState:</em> Socket connection not established.</li>
</ul>
<p><b>Code</b> <b>Example</b> </p><div class="fragment"><div class="line">uint8_t uart_buf[TCP_RECEIVE_WIN_SIZE];</div>
<div class="line"> </div>
<div class="line">uint32_t tcp_cb_func (int32_t <a class="code hl_function" href="group__using__network__sockets__bsd__func.html#gac01ac0611ef0f7d743e0eb464e7786a9" title="Create a communication endpoint called socket. [thread-safe].">socket</a>, <a class="code hl_enumeration" href="group__netTCP__Enums.html#gaecc5852a7c568a7569347007c289b8a5" title="TCP Socket Events.">netTCP_Event</a> event,</div>
<div class="line">                      <span class="keyword">const</span> <a class="code hl_struct" href="group__network__structs.html#structNET__ADDR" title="Network Address IPv4/IPv6 capable.">NET_ADDR</a> *addr, <span class="keyword">const</span> uint8_t *buf, uint32_t len) {</div>
<div class="line">  <span class="keywordflow">switch</span> (event) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5ac57525854674d91bfab38bec4d4f5d39" title="Connect request received event.">netTCP_EventConnect</a>:</div>
<div class="line">      <span class="comment">// Connect request received in server mode</span></div>
<div class="line">      <span class="keywordflow">return</span> (1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="rl__net_8h.html#gaecc5852a7c568a7569347007c289b8a5a19e44f6dd6b1fd6f5f5668b1b050daed" title="Data received event.">netTCP_EventData</a>:</div>
<div class="line">      <span class="comment">// Data received</span></div>
<div class="line">      memcpy (&amp;uart_buf[head], buf, len);</div>
<div class="line">      head += len;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>) {</div>
<div class="line">  int32_t tcp_sock;</div>
<div class="line">  uint32_t head, tail;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Initialize the Network Core</span></div>
<div class="line">  <a class="code hl_function" href="group__netSys__Func.html#ga0c68e74df79a37750413f72518f63f73" title="Initialize Network Component and interfaces. [not_thread-safe].">netInitialize</a> ();</div>
<div class="line">  tcp_sock = <a class="code hl_function" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3" title="Allocate a free TCP socket. [thread-safe].">netTCP_GetSocket</a> (tcp_cb_func);</div>
<div class="line">  <span class="keywordflow">if</span> (tcp_sock &gt;= 0) {</div>
<div class="line">    <span class="comment">// Start listening on TCP port 8080 </span></div>
<div class="line">    <a class="code hl_function" href="group__tcp__user__api.html#gac02a84a9dc999e80c5a8a1650e5d9674" title="Open TCP socket for incoming connection. [thread-safe].">netTCP_Listen</a> (tcp_sock, 8080);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Ethernet to UART bridge</span></div>
<div class="line">  head = 0;</div>
<div class="line">  tail = 0;</div>
<div class="line">  <span class="keywordflow">while</span> (1) {</div>
<div class="line">    <span class="keywordflow">if</span> (uart_busy () || head == tail) {</div>
<div class="line">      <span class="comment">// UART is busy or buffer is empty, do nothing</span></div>
<div class="line">      <span class="keywordflow">continue</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// Send a byte to UART</span></div>
<div class="line">    send_uart (uart_buf[tail++]);</div>
<div class="line">    <span class="keywordflow">if</span> (tail == head) {</div>
<div class="line">      <span class="comment">// Buffer is empty, all bytes consumed</span></div>
<div class="line">      tail = 0;</div>
<div class="line">      head = 0;</div>
<div class="line">      <a class="code hl_function" href="group__tcp__user__api.html#ga4bad195ba75c21a5e03a40d13adee3e7" title="Reset TCP window size to a default value from the configuration. [thread-safe].">netTCP_ResetReceiveWindow</a> (tcp_sock);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a id="ga0b32a74e8fc2d3d3fcea041d3958f4e6" name="ga0b32a74e8fc2d3d3fcea041d3958f4e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0b32a74e8fc2d3d3fcea041d3958f4e6">&#9670;&#160;</a></span>netTCP_Send()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> netTCP_Send </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a data packet to remote node. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>socket handle obtained with <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buf</td><td>buffer containing the data. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">len</td><td>length of data in bytes. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status code that indicates the execution status of the function.</dd></dl>
<p>The function <b>netTCP_Send</b> sends the data packet to a remote machine.</p>
<p>The argument <em>socket</em> specifies the socket handle to use for communication on the local machine.</p>
<p>The argument <em>buf</em> points to the constructed TCP data packet.</p>
<p>The argument <em>len</em> specifies the number of bytes in the data packet.</p>
<p>If the <b>netTCP_Send</b> fails to send the data, it releases the memory buffer specified with the argument <em>buf</em> and returns with an error status. The function cannot send data if:</p><ul>
<li>the TCP connection is not established</li>
<li>previously sent data is not acknowledged from the remote machine.</li>
</ul>
<p>Possible <a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> return values:</p><ul>
<li><em>netOK:</em> Send data successful.</li>
<li><em>netInvalidParameter:</em> Invalid or not supported parameter provided.</li>
<li><em>netWrongState:</em> Socket not connected or closing.</li>
<li><em>netBusy:</em> Previously sent data not acknowledged.</li>
<li><em>netError:</em> Send data failed.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>You must allocate the memory using <a class="el" href="group__tcp__user__api.html#ga361ee211c7cd20ca32c266aec90d60ff">netTCP_GetBuffer</a> before calling <b>netTCP_Send</b>.</li>
<li>The buffer will be released, no matter if netTCP_Send is successful or not.</li>
<li>netTCP_Send does not send 0-length packets. It is possible to release a buffer that has been allocated, by simply calling netTCP_Send with parameter len = 0.</li>
<li>The socket must already be opened and connected for communication.</li>
<li>It is not allowed to call <b>netTCP_Send</b> from the callback function of the socket.</li>
</ul>
</dd></dl>
<p><b>Code</b> <b>Example</b> </p><div class="fragment"><div class="line">uint8_t *sendbuf;</div>
<div class="line">uint32_t maxlen;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code hl_function" href="group__tcp__user__api.html#ga5770081776ef5a657b984a9ee600c149" title="Check if TCP socket can send data. [thread-safe].">netTCP_SendReady</a> (tcp_sock)) {</div>
<div class="line">  <span class="comment">// The socket is ready to send the data</span></div>
<div class="line">  maxlen  = <a class="code hl_function" href="group__tcp__user__api.html#gad8393d4e967564107799400710c94521" title="Determine maximum number of data bytes that can be sent in TCP packet. [thread-safe].">netTCP_GetMaxSegmentSize</a> (tcp_sock);</div>
<div class="line">  sendbuf = <a class="code hl_function" href="group__tcp__user__api.html#ga361ee211c7cd20ca32c266aec90d60ff" title="Allocate memory for TCP send buffer. [thread-safe].">netTCP_GetBuffer</a> (maxlen);</div>
<div class="line">  memcpy (sendbuf, my_data_buf, maxlen);</div>
<div class="line">  <a class="code hl_function" href="group__tcp__user__api.html#ga0b32a74e8fc2d3d3fcea041d3958f4e6" title="Send a data packet to remote node. [thread-safe].">netTCP_Send</a> (tcp_sock, sendbuf, maxlen);</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a id="ga5770081776ef5a657b984a9ee600c149" name="ga5770081776ef5a657b984a9ee600c149"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5770081776ef5a657b984a9ee600c149">&#9670;&#160;</a></span>netTCP_SendReady()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool netTCP_SendReady </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if TCP socket can send data. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>socket handle obtained with <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>send status:<ul>
<li>true = Ready to send data.</li>
<li>false = Not ready.</li>
</ul>
</dd></dl>
<p>The function <b>netTCP_SendReady</b> determines whether the TCP socket can send data. It does this by checking whether the TCP connection has been established and whether the socket has received an acknowledgment from the remote machine for data sent previously.</p>
<p>The argument <em>socket</em> specifies the socket handle.</p>
<p><b>Code</b> <b>Example</b> (see <a class="el" href="group__tcp__user__api.html#ga0b32a74e8fc2d3d3fcea041d3958f4e6">netTCP_Send</a>) </p>

</div>
</div>
<a id="ga574cc756d0ab2fb8e4719befd7c56913" name="ga574cc756d0ab2fb8e4719befd7c56913"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga574cc756d0ab2fb8e4719befd7c56913">&#9670;&#160;</a></span>netTCP_SetOption()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> netTCP_SetOption </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__netTCP__Enums.html#ga5866dd2ae379ba30a83a9ea1a0c82fdd">netTCP_Option</a>&#160;</td>
          <td class="paramname"><em>option</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set TCP socket IP option. [<a class="el" href="group__function__categories.html#thread-safe">thread-safe</a>]. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">socket</td><td>socket handle obtained with <a class="el" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3">netTCP_GetSocket</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">option</td><td>option name as defined with <a class="el" href="group__netTCP__Enums.html#ga5866dd2ae379ba30a83a9ea1a0c82fdd">netTCP_Option</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">val</td><td>option value. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status code that indicates the execution status of the function.</dd></dl>
<p>The function <b>netTCP_SetOption</b> sets different options for a TCP socket identified by the argument <em>socket</em>.</p>
<p>The argument <em>option</em> specifies the TCP option that is to be set (see below).</p>
<p>The argument <em>val</em> carries the value of the TCP option that is to be set.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Value    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_OptionTOS</span>   </td><td class="markdownTableBodyNone">IPv4 Type of Service   </td><td class="markdownTableBodyNone">val=TOS    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_OptionTrafficClass</span>   </td><td class="markdownTableBodyNone">IPv6 Traffic Class   </td><td class="markdownTableBodyNone">val=TrafficClass    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_OptionTimeout</span>   </td><td class="markdownTableBodyNone">TCP Idle Timeout   </td><td class="markdownTableBodyNone">val=timeout (in seconds)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_OptionKeepAlive</span>   </td><td class="markdownTableBodyNone">TCP Keep Alive   </td><td class="markdownTableBodyNone">val: 0=disabled (default), 1=enabled    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_OptionFlowControl</span>   </td><td class="markdownTableBodyNone">TCP Flow Control   </td><td class="markdownTableBodyNone">val: 0=disabled (default), 1=enabled    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="XML-Token">netTCP_OptionDelayedACK</span>   </td><td class="markdownTableBodyNone">TCP Delayed Acknowledgment   </td><td class="markdownTableBodyNone">val: 0=disabled (default), 1=enabled   </td></tr>
</table>
<p>Possible <a class="el" href="group__netStatusErrorCodes.html#ga5675a3b88ee02986ae15ae3bb8135551">netStatus</a> return values:</p><ul>
<li><em>netOK:</em> Option successfully set.</li>
<li><em>netInvalidParameter:</em> Invalid parameter provided.</li>
<li><em>netWrongState:</em> Requested socket not allocated.</li>
</ul>
<p><b>Code</b> <b>Example</b> </p><div class="fragment"><div class="line">int32_t tcp_sock;</div>
<div class="line"> </div>
<div class="line">tcp_sock = <a class="code hl_function" href="group__tcp__user__api.html#ga19247901cf1062d474d767ac68277ed3" title="Allocate a free TCP socket. [thread-safe].">netTCP_GetSocket</a> (tcp_cb_func);</div>
<div class="line"><span class="keywordflow">if</span> (tcp_sock &gt;= 0) {</div>
<div class="line">  <span class="comment">// Set disconnect timeout to 30 seconds</span></div>
<div class="line">  <a class="code hl_function" href="group__tcp__user__api.html#ga574cc756d0ab2fb8e4719befd7c56913" title="Set TCP socket IP option. [thread-safe].">netTCP_SetOption</a> (tcp_sock, <a class="code hl_enumvalue" href="rl__net_8h.html#ga5866dd2ae379ba30a83a9ea1a0c82fdda0cad30d4ee5b7884adb46b5bdebd3e4d" title="TCP Idle Timeout; val=timeout (in seconds)">netTCP_OptionTimeout</a>, 30);</div>
<div class="line">  <span class="comment">// Enable Keep Alive</span></div>
<div class="line">  <a class="code hl_function" href="group__tcp__user__api.html#ga574cc756d0ab2fb8e4719befd7c56913" title="Set TCP socket IP option. [thread-safe].">netTCP_SetOption</a> (tcp_sock, <a class="code hl_enumvalue" href="rl__net_8h.html#ga5866dd2ae379ba30a83a9ea1a0c82fdda7f8b8c982fe5cc4b9dec2f586e7a58c7" title="TCP Keep Alive; val: 0=disabled (default), 1=enabled.">netTCP_OptionKeepAlive</a>, 1);</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
