# PC Utilities {#usbd_pc_utilities}

The USB Component comes with a set of software utilities that you can use as templates to create your own programs for a PC. The utilities are specific for the different USB Device Classes. These are the available utilities:

 - The \ref hid_client_app  can be used to interact with a USB HID Device. You can toggle LEDs on the development board and check the state of the on-board push-buttons.
\if WINUSB_APP
 - The \ref winusb_app can be used to test the connection between a PC and the USB Device. This application uses WinUSB driver on a PC and demonstrates the basics of using the Microsoft Foundation Classes and can be used as a starting point for writing your application.
\endif

## HID Client {#hid_client_app}

The **HID Client** utility is a graphical application for a PC (running Microsoft Windows) that can be used for testing the \ref usbd_example_hid implementation.
It is available as a part of [Keil MDK uVision](https://developer.arm.com/documentation/101407/latest/About-uVision/Installation)
and the executable file `HID_Client.exe` is available in the `<mdk_install_dir>/ARM/Utilities/HID_Client/Release` folder, where `<mdk_install_dir>`
refers to the Keil MDK uVision installation directory.
This program runs stand-alone without installation.

To check the **HID Client** utility with your board, do the following:

-# Download the \ref usbd_example_hid example application to your board.
-# Verify all jumper settings on the board.
-# Connect the board to a PC. The PC should recognize the HID device and install the correct driver automatically.
-# Run `HIDClient.exe` application.
-# Select the **Device** to establish the communication channel.
-# Test the application and HID device operation by pressing the buttons on your development board and watch **Inputs** change
   and/or check/un-check the check-boxes in the **Outputs** to see the LEDs on the board change state.

![HID Client app](hid_client_test.png)

### Source Code

The source code of the HID Client application is available in `<install_dir>/ARM/Utilities/HID_Client`.
A Visual Studio 2010 (or later) based solution named `HIDClient_VS2010.sln` is available.
The following is a summary of what you will find in each of the files that make up your **HID Client** application.

![HID Client app solution view](HIDClientSolutionExplorer.png)

**Header Files**

- `HID.h` includes the function declarations of the functions that are defined in `HID.cpp`.
- `HIDClient.h` is the main header file for the application. It includes other project specific headers (including Resource.h)
  and declares the `CHIDClientApp` application class.
- `HIDClientDlg.h` defines the behavior of the application's main dialog.

**Resource Files**

- `HIDClient.ico` is an icon file, which is used as the application's icon. This icon is included by the main resource file
  `HIDClient.rc`.
- `HIDClient.rc2` contains resources that are not edited by Microsoft Visual C++. You should place all resources not editable
  by the resource editor in this file.

**Source Files**

- `HID.cpp` contains the necessary functions that are used in this example application to communicate with an USB HID device.
  All available functions in Windows for HID interaction are explained here:
  [Introduction to HID Concepts](https://learn.microsoft.com/en-us/windows-hardware/drivers/hid/introduction-to-hid-concepts).
  The function:
  - `HID_Init` initializes the HID class to be used with the USB Host.
  - `HID_UnInit` de-initializes the HID class from the USB Host.
  - `HID_FindDevices` scans the USB Bus and lists all available HID devices for connection to the application. This
    information is obtained from the \ref USB_Device_Descriptor that is generated by the USB Component using the configuration files.
  - `HID_GetName` evaluates the \ref prod_string "Product String" of the device to be shown in the drop down box
    of the application.
  - `HID_GetInputReportSize` extracts the value of `USBD_HIDn_IN_REPORT_MAX_SZ` as specified in the
    \ref usbd_hidFunctions_conf "USBD_Config_HID_n.h" file.
  - `HID_GetOutputReportSize` extracts the value of `USBD_HIDn_OUT_REPORT_MAX_SZ` as specified in the
    \ref usbd_hidFunctions_conf "USBD_Config_HID_n.h" file.
  - `HID_GetFeatureReportSize` extracts the value of `USBD_HIDn_FEAT_REPORT_MAX_SZ` as specified in the
    \ref usbd_hidFunctions_conf "USBD_Config_HID_n.h" file.
  - `HID_Open` opens the device.
  - `HID_GetSelectedDevice` returns the selected device.
  - `HID_Close` closes the device.
  - `HID_Read` initiates a \ref USBD_HIDn_GetReport within the device to send data to the USB Host.
  - `HID_Write` triggers a \ref USBD_HIDn_SetReport within the device to read data sent from the USB Host.
  - `HID_GetFeature` and `HID_SetFeature` work on the USB HID Device's feature report (which is optional).
- `HIDClient.cpp` is the main application source file that contains the application class `CHIDClientApp`.
- `HIDClient.rc` is a listing of all of the Microsoft Windows resources that the program uses (located in the `res` subdirectory).
- `HIDClientDlg.cpp` implements the code of the client's dialog and calls the functions specified in `HID.cpp`. This is
  the actual place where the interaction between the USB Host and the USB Device is defined.

\if WINUSB_APP

## WinUSB Test {#winusb_app}

The **WinUSB Test** utility is a graphical application for a PC (running Microsoft Windows) that can be used for testing the USB Custom Class device implementation.
The executable file `WinUSB_Test.exe` is available in the `<CMSIS_PACK_ROOT>/ARM/PACK/Keil/MDK-Middleware/x.y.z/Utilities/WinUSB_Test/Release` folder (where `<CMSIS_PACK_ROOT>`
refers to the root directory of CMSIS Packs installation).
This program runs stand-alone without installation.

To check the **WinUSB Test** utility with your board, do the following:

-# Download the USB Device `WinUSB_Echo` example application to your board.
-# Verify all jumper settings on the board.
-# Connect the board to a PC. The PC should recognize the WinUSB device and install the correct driver automatically.
-# Run `WinUSB_Test.exe` application.
-# Select the **Device** to establish the communication channel.
-# Test the application and WinUSB device operation by executing following steps:
   - activate reception on the IN Endpoint (click on the **Start Reception to Buffer** button)
   - enter some data in hex format to data edit box for the OUT Transfer (for example **AA BB CC**)
   - send some data on the OUT Endpoint (click on the **Start Transmission from Buffer** button)
   - check if received data on the IN Endpoint is the same as data that was sent on the OUT Endpoint

![WinUSB Test app](WinUSB_Test_application.png)

### Source Code

The source code of the WinUSB Test application is available in `<CMSIS_PACK_ROOT>/ARM/PACK/Keil/MDK-Middleware/x.y.z/Utilities/WinUSB_Test`.
A Visual Studio 2010 (or later) based solution named `WinUSB_Test.sln` is available.
The following is a summary of what you will find in each of the files that make up your **WinUSB Test** application.

![WinUSB Test app solution view](WinUSB_test_sln.png)

**Header Files**

- `./USB/WinUsbIF.h` includes the function declarations of the functions that are defined in `./USB/WinUsbIF.cpp`.
- `./WinUSB_Test/WinUSB_Test.h` is the main header file for the application. It includes other project specific headers
  (including resource.h) and declares the `CWinUSB_TestApp` application class.
- `./WinUSB_Test/WinUSB_TestDlg.h` defines the behavior of the application's main dialog.

**Resource Files**

- `./WinUSB_Test/res/WinUSB_Test.ico` is an icon file, which is used as the application's icon. This icon is included
  by the main resource file `./WinUSB_Test/WinUSB_Test.rc`.
- `./WinUSB_Test/res/Refresh_grey.ico` is an icon file, which is used for the refresh button in the application.
- `./WinUSB_Test/res/WinUSB_Test.rc2` contains resources that are not edited by Microsoft Visual C++. You should
  place all resources not editable by the resource editor in this file.

**Source Files**

- `./USB/WinUsbIF.cpp` contains the necessary functions that are used in this example application to communicate with
  a USB device via the WinUSB interface. Refer to the
  <a href="https://learn.microsoft.com/en-us/windows/win32/api/winusb/" target=_blank>WinUSB Functions</a>
  documentation for an overview of the available functions.	The function:
  - `WinUsbIF_Initialize` initializes the WinUSB interface to be used with the USB Host.
  - `WinUsbIF_Uninitialize` de-initializes the WinUSB interface from the USB Host.
  - `WinUsbIF_SetGUID` sets the USB interface Globally Unique Identifier (GUID).
  - `WinUsbIF_GetGUID` retrieves the USB interface Globally Unique Identifier (GUID).
  - `WinUsbIF_FindDevices` scans the USB Bus and lists all available devices, containing interface with set GUID,
    for connection to the application.
  - `WinUsbIF_GetNumOfInterfaces` retrieves the number of interfaces available for a device.
  - `WinUsbIF_GetEndpointsMask` retrieves the endpoint mask of the selected device.
  - `WinUsbIF_GetName` evaluates the VID + PID + Serial Number or Unique ID of the device to be shown in the drop down box
    of the application.
  - `WinUsbIF_GetManufacturerString` retrieves the device's manufacturer string.
  - `WinUsbIF_GetProductString` retrieves the device's product string.
  - `WinUsbIF_GetSerialNumberString` retrieves the device's serial number string.
  - `WinUsbIF_GetInterfaceString` retrieves the device's interface string.
  - `WinUsbIF_GetVID` retrieves the device's vendor ID.
  - `WinUsbIF_GetPID` retrieves the device's product ID.
  - `WinUsbIF_OpenDevice` opens the device for USB communication.
  - `WinUsbIF_CloseDevice` closes the device from USB communication.
  - `WinUsbIF_ControlTransfer` executes a control transfer on the USB Bus.
  - `WinUsbIF_WritePipe` executes an USB OUT transfer on a selected pipe to a bulk or interrupt endpoint of the device.
  - `WinUsbIF_ReadPipe` executes an USB IN transfer on a selected pipe to a bulk or interrupt endpoint of the device.
  - `WinUsbIF_AbortPipe` aborts pending pipe transfers.
  - `WinUsbIF_FlushPipe` flushes the cached data of a pipe.
  - `WinUsbIF_ResetPipe` resets a pipe.
  - `WinUsbIF_GetOverlappedResult` retrieves the overlapped result.
- `./WinUSB_Test/WinUSB_Test.cpp` is the main application source file that contains the application class
  `CWinUSB_TestApp`.
- `./WinUSB_Test/WinUSB_Test.rc` is a listing of all of the Microsoft Windows resources that the program uses (located
  in the `./WinUSB_Test/res` subdirectory).
- `./WinUSB_Test/WinUSB_TestDlg.cpp` implements the code of the client's dialog and calls the functions specified in
  `./USB/WinUsbIF.cpp`. This is the actual place where the interaction between the USB Host and the USB Device is
  defined.

\endif
